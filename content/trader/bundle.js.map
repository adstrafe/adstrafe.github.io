{"version":3,"file":"bundle.js","sources":["../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/util.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/options.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/create-element.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/diff/props.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/component.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/create-context.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/constants.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/diff/children.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/diff/index.js","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/diff/catch-error.js","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/IntlError.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/utils/mapping.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/utils/placeholder.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/utils/validation.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/format/DateTimeFormat/parser.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/format/DateTimeFormat/DateTimeFormat.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/format/SelectFormat.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/format/VariableFormat.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/format/index.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/parser/ParseError.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/parser/parser.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/DefaultInterpreter.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/MappedFormatProvider.ts","../../.yarn/cache/@calmdownval-intl-npm-1.0.0-beta.2-6c3c8851c6-ee1614b7b9.zip/node_modules/@calmdownval/intl/src/CachedTranslationProvider.ts","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/hooks/src/index.js","../../.yarn/__virtual__/@calmdownval-intl-preact-virtual-15542aea21/0/cache/@calmdownval-intl-preact-npm-1.0.0-beta.2-1fa171d02c-b1104b3a70.zip/node_modules/@calmdownval/intl-preact/src/utils.ts","../../.yarn/__virtual__/@calmdownval-intl-preact-virtual-15542aea21/0/cache/@calmdownval-intl-preact-npm-1.0.0-beta.2-1fa171d02c-b1104b3a70.zip/node_modules/@calmdownval/intl-preact/src/IntlContext.ts","../../.yarn/__virtual__/@calmdownval-intl-preact-virtual-15542aea21/0/cache/@calmdownval-intl-preact-npm-1.0.0-beta.2-1fa171d02c-b1104b3a70.zip/node_modules/@calmdownval/intl-preact/src/IntlProvider.ts","../../src/utils/style.ts","../../src/components/Button/Button.ts","../../src/components/Menu/Menu.tsx","../../src/components/AppRouter/AppRouter.tsx","../../src/game/storage/LocalStorageBackend.ts","../../src/game/storage/ProxyStorageBackend.ts","../../src/game/storage/StateStorage.ts","../../src/game/Registry.ts","../../src/game/entities/Level.ts","../../src/game/constants.ts","../../src/game/entities/Crafter.ts","../../src/game/items/EquipmentSlot.ts","../../src/game/entities/Attributes.ts","../../src/utils/enum.ts","../../src/game/items/ItemKind.ts","../../src/utils/array.ts","../../src/utils/math.ts","../../src/game/items/LootTable.ts","../../src/game/quests/Quest.ts","../../src/game/entities/combat/Combatant.ts","../../src/game/entities/combat/Effect.ts","../../src/game/entities/combat/targeting.ts","../../src/game/entities/combat/Attack.ts","../../src/game/entities/combat/CombatEvent.ts","../../src/game/entities/Hero.ts","../../src/game/PlayerError.ts","../../src/game/entities/combat/CombatParticipant.ts","../../src/game/entities/combat/CombatSimulator.ts","../../src/game/storage/NoOpStorageBackend.ts","../../src/game/entities/Health.ts","../../src/game/entities/Enemy.ts","../../src/game/items/Inventory.ts","../../.yarn/cache/@calmdownval-signal-npm-4.2.1-5e0981d888-ea7fe9f6b1.zip/node_modules/@calmdownval/signal/src/backend/ArrayBackend.js","../../.yarn/cache/@calmdownval-signal-npm-4.2.1-5e0981d888-ea7fe9f6b1.zip/node_modules/@calmdownval/signal/src/backend/SetBackend.js","../../.yarn/cache/@calmdownval-signal-npm-4.2.1-5e0981d888-ea7fe9f6b1.zip/node_modules/@calmdownval/signal/src/dispatcher/asyncDispatcher.ts","../../.yarn/cache/@calmdownval-signal-npm-4.2.1-5e0981d888-ea7fe9f6b1.zip/node_modules/@calmdownval/signal/src/methods.ts","../../src/game/time/Clock.ts","../../.yarn/cache/@calmdownval-signal-npm-4.2.1-5e0981d888-ea7fe9f6b1.zip/node_modules/@calmdownval/signal/src/dispatcher/syncDispatcher.ts","../../src/game/time/Scheduler.ts","../../src/utils/order.ts","../../src/game/entities/crafters/herbalist.ts","../../src/game/entities/crafters/blacksmith.ts","../../src/game/entities/crafters/carver.ts","../../src/game/entities/enemies/gatheringBush.ts","../../src/game/entities/enemies/ironGolem.ts","../../src/game/entities/enemies/skeleton.ts","../../src/game/entities/enemies/stoner.ts","../../src/game/entities/enemies/treeGuy.ts","../../src/game/entities/enemies/cocaLeaves.ts","../../src/game/entities/heroes/mage.ts","../../src/game/entities/heroes/warrior.ts","../../src/game/quests/firstZone.ts","../../src/game/TraderGame.ts","../../src/routes.ts","../../src/components/FlatLayout/FlatLayout.tsx","../../src/components/Typography/Typography.tsx","../../src/hooks/useForceUpdate.ts","../../src/hooks/useScheduledUpdates.ts","../../src/components/Countdown/Countdown.tsx","../../src/hooks/usePeriodicUpdates.ts","../../src/components/Icon/Icon.tsx","../../src/components/EntryCard/EntryCard.tsx","../../src/components/ProgressBar/ProgressBar.tsx","../../src/screens/crafters/entries/index.ts","../../src/screens/crafters/entries/CrafterIdleEntryRenderer.tsx","../../src/screens/crafters/entries/CrafterCraftPendingEntryRenderer.tsx","../../src/screens/crafters/entries/CrafterCraftReadyEntryRenderer.tsx","../../src/screens/crafters/CraftersScreen.tsx","../../src/components/ButtonGroup/ButtonGroup.tsx","../../src/screens/crafting-end/CraftingEndScreen.tsx","../../src/screens/crafting-list/CraftingListScreen.tsx","../../src/screens/crafting-recipe/CraftingRecipeScreen.tsx","../../src/screens/hero-death/HeroDeathScreen.tsx","../../src/screens/hero-edit/HeroEditScreen.tsx","../../src/screens/hero-equip-item/HeroEquipItem.tsx","../../src/screens/hero-heal/HeroHealScreen.tsx","../../src/components/StickyLayout/StickyLayout.tsx","../../src/screens/hero-recruit/HeroRecruitScreen.tsx","../../src/screens/heroes/entries/index.ts","../../src/screens/heroes/entries/HeroDeadEntryRenderer.tsx","../../src/screens/heroes/entries/HeroIdleEntryRenderer.tsx","../../src/screens/heroes/entries/HeroQuestPendingEntryRenderer.tsx","../../src/screens/heroes/entries/HeroQuestReadyEntryRenderer.tsx","../../src/screens/heroes/HeroesScreen.tsx","../../src/components/ItemGrid/ItemGrid.tsx","../../src/screens/inventory/InventoryScreen.tsx","../../src/screens/quest-end/QuestEndScreen.tsx","../../src/screens/quest-select/QuestSelectScreen.tsx","../../src/components/EntityDetail/EntityDetail.tsx","../../src/screens/quest-start/QuestStartScreen.tsx","../../src/screens/shop/ShopScreen.tsx","../../src/App.tsx","../../.yarn/cache/preact-npm-10.12.1-fdb903e9a5-0de99f4775.zip/node_modules/preact/src/render.js","../../src/index.tsx"],"sourcesContent":["import { EMPTY_ARR } from \"./constants\";\n\n/**\n * Assign properties from `props` to `obj`\n * @template O, P The obj and props types\n * @param {O} obj The object to copy properties to\n * @param {P} props The object to copy properties from\n * @returns {O & P}\n */\nexport function assign(obj, props) {\n\t// @ts-ignore We change the type of `obj` to be `O & P`\n\tfor (let i in props) obj[i] = props[i];\n\treturn /** @type {O & P} */ (obj);\n}\n\n/**\n * Remove a child node from its parent if attached. This is a workaround for\n * IE11 which doesn't support `Element.prototype.remove()`. Using this function\n * is smaller than including a dedicated polyfill.\n * @param {Node} node The node to remove\n */\nexport function removeNode(node) {\n\tlet parentNode = node.parentNode;\n\tif (parentNode) parentNode.removeChild(node);\n}\n\nexport const slice = EMPTY_ARR.slice;\n","import { _catchError } from './diff/catch-error';\n\n/**\n * The `option` object can potentially contain callback functions\n * that are called during various stages of our renderer. This is the\n * foundation on which all our addons like `preact/debug`, `preact/compat`,\n * and `preact/hooks` are based on. See the `Options` type in `internal.d.ts`\n * for a full list of available option hooks (most editors/IDEs allow you to\n * ctrl+click or cmd+click on mac the type definition below).\n * @type {import('./internal').Options}\n */\nconst options = {\n\t_catchError\n};\n\nexport default options;\n","import { slice } from './util';\nimport options from './options';\n\nlet vnodeId = 0;\n\n/**\n * Create an virtual node (used for JSX)\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component\n * constructor for this virtual node\n * @param {object | null | undefined} [props] The properties of the virtual node\n * @param {Array<import('.').ComponentChildren>} [children] The children of the virtual node\n * @returns {import('./internal').VNode}\n */\nexport function createElement(type, props, children) {\n\tlet normalizedProps = {},\n\t\tkey,\n\t\tref,\n\t\ti;\n\tfor (i in props) {\n\t\tif (i == 'key') key = props[i];\n\t\telse if (i == 'ref') ref = props[i];\n\t\telse normalizedProps[i] = props[i];\n\t}\n\n\tif (arguments.length > 2) {\n\t\tnormalizedProps.children =\n\t\t\targuments.length > 3 ? slice.call(arguments, 2) : children;\n\t}\n\n\t// If a Component VNode, check for and apply defaultProps\n\t// Note: type may be undefined in development, must never error here.\n\tif (typeof type == 'function' && type.defaultProps != null) {\n\t\tfor (i in type.defaultProps) {\n\t\t\tif (normalizedProps[i] === undefined) {\n\t\t\t\tnormalizedProps[i] = type.defaultProps[i];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn createVNode(type, normalizedProps, key, ref, null);\n}\n\n/**\n * Create a VNode (used internally by Preact)\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component\n * Constructor for this virtual node\n * @param {object | string | number | null} props The properties of this virtual node.\n * If this virtual node represents a text node, this is the text of the node (string or number).\n * @param {string | number | null} key The key for this virtual node, used when\n * diffing it against its children\n * @param {import('./internal').VNode[\"ref\"]} ref The ref property that will\n * receive a reference to its created child\n * @returns {import('./internal').VNode}\n */\nexport function createVNode(type, props, key, ref, original) {\n\t// V8 seems to be better at detecting type shapes if the object is allocated from the same call site\n\t// Do not inline into createElement and coerceToVNode!\n\tconst vnode = {\n\t\ttype,\n\t\tprops,\n\t\tkey,\n\t\tref,\n\t\t_children: null,\n\t\t_parent: null,\n\t\t_depth: 0,\n\t\t_dom: null,\n\t\t// _nextDom must be initialized to undefined b/c it will eventually\n\t\t// be set to dom.nextSibling which can return `null` and it is important\n\t\t// to be able to distinguish between an uninitialized _nextDom and\n\t\t// a _nextDom that has been set to `null`\n\t\t_nextDom: undefined,\n\t\t_component: null,\n\t\t_hydrating: null,\n\t\tconstructor: undefined,\n\t\t_original: original == null ? ++vnodeId : original\n\t};\n\n\t// Only invoke the vnode hook if this was *not* a direct copy:\n\tif (original == null && options.vnode != null) options.vnode(vnode);\n\n\treturn vnode;\n}\n\nexport function createRef() {\n\treturn { current: null };\n}\n\nexport function Fragment(props) {\n\treturn props.children;\n}\n\n/**\n * Check if a the argument is a valid Preact VNode.\n * @param {*} vnode\n * @returns {vnode is import('./internal').VNode}\n */\nexport const isValidElement = vnode =>\n\tvnode != null && vnode.constructor === undefined;\n","import { IS_NON_DIMENSIONAL } from '../constants';\nimport options from '../options';\n\n/**\n * Diff the old and new properties of a VNode and apply changes to the DOM node\n * @param {import('../internal').PreactElement} dom The DOM node to apply\n * changes to\n * @param {object} newProps The new props\n * @param {object} oldProps The old props\n * @param {boolean} isSvg Whether or not this node is an SVG node\n * @param {boolean} hydrate Whether or not we are in hydration mode\n */\nexport function diffProps(dom, newProps, oldProps, isSvg, hydrate) {\n\tlet i;\n\n\tfor (i in oldProps) {\n\t\tif (i !== 'children' && i !== 'key' && !(i in newProps)) {\n\t\t\tsetProperty(dom, i, null, oldProps[i], isSvg);\n\t\t}\n\t}\n\n\tfor (i in newProps) {\n\t\tif (\n\t\t\t(!hydrate || typeof newProps[i] == 'function') &&\n\t\t\ti !== 'children' &&\n\t\t\ti !== 'key' &&\n\t\t\ti !== 'value' &&\n\t\t\ti !== 'checked' &&\n\t\t\toldProps[i] !== newProps[i]\n\t\t) {\n\t\t\tsetProperty(dom, i, newProps[i], oldProps[i], isSvg);\n\t\t}\n\t}\n}\n\nfunction setStyle(style, key, value) {\n\tif (key[0] === '-') {\n\t\tstyle.setProperty(key, value == null ? '' : value);\n\t} else if (value == null) {\n\t\tstyle[key] = '';\n\t} else if (typeof value != 'number' || IS_NON_DIMENSIONAL.test(key)) {\n\t\tstyle[key] = value;\n\t} else {\n\t\tstyle[key] = value + 'px';\n\t}\n}\n\n/**\n * Set a property value on a DOM node\n * @param {import('../internal').PreactElement} dom The DOM node to modify\n * @param {string} name The name of the property to set\n * @param {*} value The value to set the property to\n * @param {*} oldValue The old value the property had\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node or not\n */\nexport function setProperty(dom, name, value, oldValue, isSvg) {\n\tlet useCapture;\n\n\to: if (name === 'style') {\n\t\tif (typeof value == 'string') {\n\t\t\tdom.style.cssText = value;\n\t\t} else {\n\t\t\tif (typeof oldValue == 'string') {\n\t\t\t\tdom.style.cssText = oldValue = '';\n\t\t\t}\n\n\t\t\tif (oldValue) {\n\t\t\t\tfor (name in oldValue) {\n\t\t\t\t\tif (!(value && name in value)) {\n\t\t\t\t\t\tsetStyle(dom.style, name, '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (value) {\n\t\t\t\tfor (name in value) {\n\t\t\t\t\tif (!oldValue || value[name] !== oldValue[name]) {\n\t\t\t\t\t\tsetStyle(dom.style, name, value[name]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t// Benchmark for comparison: https://esbench.com/bench/574c954bdb965b9a00965ac6\n\telse if (name[0] === 'o' && name[1] === 'n') {\n\t\tuseCapture = name !== (name = name.replace(/Capture$/, ''));\n\n\t\t// Infer correct casing for DOM built-in events:\n\t\tif (name.toLowerCase() in dom) name = name.toLowerCase().slice(2);\n\t\telse name = name.slice(2);\n\n\t\tif (!dom._listeners) dom._listeners = {};\n\t\tdom._listeners[name + useCapture] = value;\n\n\t\tif (value) {\n\t\t\tif (!oldValue) {\n\t\t\t\tconst handler = useCapture ? eventProxyCapture : eventProxy;\n\t\t\t\tdom.addEventListener(name, handler, useCapture);\n\t\t\t}\n\t\t} else {\n\t\t\tconst handler = useCapture ? eventProxyCapture : eventProxy;\n\t\t\tdom.removeEventListener(name, handler, useCapture);\n\t\t}\n\t} else if (name !== 'dangerouslySetInnerHTML') {\n\t\tif (isSvg) {\n\t\t\t// Normalize incorrect prop usage for SVG:\n\t\t\t// - xlink:href / xlinkHref --> href (xlink:href was removed from SVG and isn't needed)\n\t\t\t// - className --> class\n\t\t\tname = name.replace(/xlink(H|:h)/, 'h').replace(/sName$/, 's');\n\t\t} else if (\n\t\t\tname !== 'width' &&\n\t\t\tname !== 'height' &&\n\t\t\tname !== 'href' &&\n\t\t\tname !== 'list' &&\n\t\t\tname !== 'form' &&\n\t\t\t// Default value in browsers is `-1` and an empty string is\n\t\t\t// cast to `0` instead\n\t\t\tname !== 'tabIndex' &&\n\t\t\tname !== 'download' &&\n\t\t\tname in dom\n\t\t) {\n\t\t\ttry {\n\t\t\t\tdom[name] = value == null ? '' : value;\n\t\t\t\t// labelled break is 1b smaller here than a return statement (sorry)\n\t\t\t\tbreak o;\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\t// ARIA-attributes have a different notion of boolean values.\n\t\t// The value `false` is different from the attribute not\n\t\t// existing on the DOM, so we can't remove it. For non-boolean\n\t\t// ARIA-attributes we could treat false as a removal, but the\n\t\t// amount of exceptions would cost us too many bytes. On top of\n\t\t// that other VDOM frameworks also always stringify `false`.\n\n\t\tif (typeof value === 'function') {\n\t\t\t// never serialize functions as attribute values\n\t\t} else if (value != null && (value !== false || name.indexOf('-') != -1)) {\n\t\t\tdom.setAttribute(name, value);\n\t\t} else {\n\t\t\tdom.removeAttribute(name);\n\t\t}\n\t}\n}\n\nexport let inEvent = false;\n\n/**\n * Proxy an event to hooked event handlers\n * @param {Event} e The event object from the browser\n * @private\n */\nfunction eventProxy(e) {\n\tinEvent = true;\n\ttry {\n\t\treturn this._listeners[e.type + false](\n\t\t\toptions.event ? options.event(e) : e\n\t\t);\n\t} finally {\n\t\tinEvent = false;\n\t}\n}\n\nfunction eventProxyCapture(e) {\n\tinEvent = true;\n\ttry {\n\t\treturn this._listeners[e.type + true](options.event ? options.event(e) : e);\n\t} finally {\n\t\tinEvent = false;\n\t}\n}\n","import { assign } from './util';\nimport { diff, commitRoot } from './diff/index';\nimport options from './options';\nimport { Fragment } from './create-element';\nimport { inEvent } from './diff/props';\n\n/**\n * Base Component class. Provides `setState()` and `forceUpdate()`, which\n * trigger rendering\n * @param {object} props The initial component props\n * @param {object} context The initial context from parent components'\n * getChildContext\n */\nexport function Component(props, context) {\n\tthis.props = props;\n\tthis.context = context;\n}\n\n/**\n * Update component state and schedule a re-render.\n * @this {import('./internal').Component}\n * @param {object | ((s: object, p: object) => object)} update A hash of state\n * properties to update with new values or a function that given the current\n * state and props returns a new partial state\n * @param {() => void} [callback] A function to be called once component state is\n * updated\n */\nComponent.prototype.setState = function(update, callback) {\n\t// only clone state when copying to nextState the first time.\n\tlet s;\n\tif (this._nextState != null && this._nextState !== this.state) {\n\t\ts = this._nextState;\n\t} else {\n\t\ts = this._nextState = assign({}, this.state);\n\t}\n\n\tif (typeof update == 'function') {\n\t\t// Some libraries like `immer` mark the current state as readonly,\n\t\t// preventing us from mutating it, so we need to clone it. See #2716\n\t\tupdate = update(assign({}, s), this.props);\n\t}\n\n\tif (update) {\n\t\tassign(s, update);\n\t}\n\n\t// Skip update if updater function returned null\n\tif (update == null) return;\n\n\tif (this._vnode) {\n\t\tif (callback) {\n\t\t\tthis._stateCallbacks.push(callback);\n\t\t}\n\t\tenqueueRender(this);\n\t}\n};\n\n/**\n * Immediately perform a synchronous re-render of the component\n * @this {import('./internal').Component}\n * @param {() => void} [callback] A function to be called after component is\n * re-rendered\n */\nComponent.prototype.forceUpdate = function(callback) {\n\tif (this._vnode) {\n\t\t// Set render mode so that we can differentiate where the render request\n\t\t// is coming from. We need this because forceUpdate should never call\n\t\t// shouldComponentUpdate\n\t\tthis._force = true;\n\t\tif (callback) this._renderCallbacks.push(callback);\n\t\tenqueueRender(this);\n\t}\n};\n\n/**\n * Accepts `props` and `state`, and returns a new Virtual DOM tree to build.\n * Virtual DOM is generally constructed via [JSX](http://jasonformat.com/wtf-is-jsx).\n * @param {object} props Props (eg: JSX attributes) received from parent\n * element/component\n * @param {object} state The component's current state\n * @param {object} context Context object, as returned by the nearest\n * ancestor's `getChildContext()`\n * @returns {import('./index').ComponentChildren | void}\n */\nComponent.prototype.render = Fragment;\n\n/**\n * @param {import('./internal').VNode} vnode\n * @param {number | null} [childIndex]\n */\nexport function getDomSibling(vnode, childIndex) {\n\tif (childIndex == null) {\n\t\t// Use childIndex==null as a signal to resume the search from the vnode's sibling\n\t\treturn vnode._parent\n\t\t\t? getDomSibling(vnode._parent, vnode._parent._children.indexOf(vnode) + 1)\n\t\t\t: null;\n\t}\n\n\tlet sibling;\n\tfor (; childIndex < vnode._children.length; childIndex++) {\n\t\tsibling = vnode._children[childIndex];\n\n\t\tif (sibling != null && sibling._dom != null) {\n\t\t\t// Since updateParentDomPointers keeps _dom pointer correct,\n\t\t\t// we can rely on _dom to tell us if this subtree contains a\n\t\t\t// rendered DOM node, and what the first rendered DOM node is\n\t\t\treturn sibling._dom;\n\t\t}\n\t}\n\n\t// If we get here, we have not found a DOM node in this vnode's children.\n\t// We must resume from this vnode's sibling (in it's parent _children array)\n\t// Only climb up and search the parent if we aren't searching through a DOM\n\t// VNode (meaning we reached the DOM parent of the original vnode that began\n\t// the search)\n\treturn typeof vnode.type == 'function' ? getDomSibling(vnode) : null;\n}\n\n/**\n * Trigger in-place re-rendering of a component.\n * @param {import('./internal').Component} component The component to rerender\n */\nfunction renderComponent(component) {\n\tlet vnode = component._vnode,\n\t\toldDom = vnode._dom,\n\t\tparentDom = component._parentDom;\n\n\tif (parentDom) {\n\t\tlet commitQueue = [];\n\t\tconst oldVNode = assign({}, vnode);\n\t\toldVNode._original = vnode._original + 1;\n\n\t\tdiff(\n\t\t\tparentDom,\n\t\t\tvnode,\n\t\t\toldVNode,\n\t\t\tcomponent._globalContext,\n\t\t\tparentDom.ownerSVGElement !== undefined,\n\t\t\tvnode._hydrating != null ? [oldDom] : null,\n\t\t\tcommitQueue,\n\t\t\toldDom == null ? getDomSibling(vnode) : oldDom,\n\t\t\tvnode._hydrating\n\t\t);\n\t\tcommitRoot(commitQueue, vnode);\n\n\t\tif (vnode._dom != oldDom) {\n\t\t\tupdateParentDomPointers(vnode);\n\t\t}\n\t}\n}\n\n/**\n * @param {import('./internal').VNode} vnode\n */\nfunction updateParentDomPointers(vnode) {\n\tif ((vnode = vnode._parent) != null && vnode._component != null) {\n\t\tvnode._dom = vnode._component.base = null;\n\t\tfor (let i = 0; i < vnode._children.length; i++) {\n\t\t\tlet child = vnode._children[i];\n\t\t\tif (child != null && child._dom != null) {\n\t\t\t\tvnode._dom = vnode._component.base = child._dom;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn updateParentDomPointers(vnode);\n\t}\n}\n\n/**\n * The render queue\n * @type {Array<import('./internal').Component>}\n */\nlet rerenderQueue = [];\n\n/*\n * The value of `Component.debounce` must asynchronously invoke the passed in callback. It is\n * important that contributors to Preact can consistently reason about what calls to `setState`, etc.\n * do, and when their effects will be applied. See the links below for some further reading on designing\n * asynchronous APIs.\n * * [Designing APIs for Asynchrony](https://blog.izs.me/2013/08/designing-apis-for-asynchrony)\n * * [Callbacks synchronous and asynchronous](https://blog.ometer.com/2011/07/24/callbacks-synchronous-and-asynchronous/)\n */\n\nlet prevDebounce;\n\nconst microTick =\n\ttypeof Promise == 'function'\n\t\t? Promise.prototype.then.bind(Promise.resolve())\n\t\t: setTimeout;\nfunction defer(cb) {\n\tif (inEvent) {\n\t\tsetTimeout(cb);\n\t} else {\n\t\tmicroTick(cb);\n\t}\n}\n\n/**\n * Enqueue a rerender of a component\n * @param {import('./internal').Component} c The component to rerender\n */\nexport function enqueueRender(c) {\n\tif (\n\t\t(!c._dirty &&\n\t\t\t(c._dirty = true) &&\n\t\t\trerenderQueue.push(c) &&\n\t\t\t!process._rerenderCount++) ||\n\t\tprevDebounce !== options.debounceRendering\n\t) {\n\t\tprevDebounce = options.debounceRendering;\n\t\t(prevDebounce || defer)(process);\n\t}\n}\n\n/** Flush the render queue by rerendering all queued components */\nfunction process() {\n\tlet c;\n\trerenderQueue.sort((a, b) => a._vnode._depth - b._vnode._depth);\n\t// Don't update `renderCount` yet. Keep its value non-zero to prevent unnecessary\n\t// process() calls from getting scheduled while `queue` is still being consumed.\n\twhile ((c = rerenderQueue.shift())) {\n\t\tif (c._dirty) {\n\t\t\tlet renderQueueLength = rerenderQueue.length;\n\t\t\trenderComponent(c);\n\t\t\tif (rerenderQueue.length > renderQueueLength) {\n\t\t\t\t// When i.e. rerendering a provider additional new items can be injected, we want to\n\t\t\t\t// keep the order from top to bottom with those new items so we can handle them in a\n\t\t\t\t// single pass\n\t\t\t\trerenderQueue.sort((a, b) => a._vnode._depth - b._vnode._depth);\n\t\t\t}\n\t\t}\n\t}\n\tprocess._rerenderCount = 0;\n}\n\nprocess._rerenderCount = 0;\n","import { enqueueRender } from './component';\n\nexport let i = 0;\n\nexport function createContext(defaultValue, contextId) {\n\tcontextId = '__cC' + i++;\n\n\tconst context = {\n\t\t_id: contextId,\n\t\t_defaultValue: defaultValue,\n\t\t/** @type {import('./internal').FunctionComponent} */\n\t\tConsumer(props, contextValue) {\n\t\t\t// return props.children(\n\t\t\t// \tcontext[contextId] ? context[contextId].props.value : defaultValue\n\t\t\t// );\n\t\t\treturn props.children(contextValue);\n\t\t},\n\t\t/** @type {import('./internal').FunctionComponent} */\n\t\tProvider(props) {\n\t\t\tif (!this.getChildContext) {\n\t\t\t\t/** @type {import('./internal').Component[]} */\n\t\t\t\tlet subs = [];\n\t\t\t\tlet ctx = {};\n\t\t\t\tctx[contextId] = this;\n\n\t\t\t\tthis.getChildContext = () => ctx;\n\n\t\t\t\tthis.shouldComponentUpdate = function(_props) {\n\t\t\t\t\tif (this.props.value !== _props.value) {\n\t\t\t\t\t\t// I think the forced value propagation here was only needed when `options.debounceRendering` was being bypassed:\n\t\t\t\t\t\t// https://github.com/preactjs/preact/commit/4d339fb803bea09e9f198abf38ca1bf8ea4b7771#diff-54682ce380935a717e41b8bfc54737f6R358\n\t\t\t\t\t\t// In those cases though, even with the value corrected, we're double-rendering all nodes.\n\t\t\t\t\t\t// It might be better to just tell folks not to use force-sync mode.\n\t\t\t\t\t\t// Currently, using `useContext()` in a class component will overwrite its `this.context` value.\n\t\t\t\t\t\t// subs.some(c => {\n\t\t\t\t\t\t// \tc.context = _props.value;\n\t\t\t\t\t\t// \tenqueueRender(c);\n\t\t\t\t\t\t// });\n\n\t\t\t\t\t\t// subs.some(c => {\n\t\t\t\t\t\t// \tc.context[contextId] = _props.value;\n\t\t\t\t\t\t// \tenqueueRender(c);\n\t\t\t\t\t\t// });\n\t\t\t\t\t\tsubs.some(c => {\n\t\t\t\t\t\t\tc._force = true;\n\t\t\t\t\t\t\tenqueueRender(c);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.sub = c => {\n\t\t\t\t\tsubs.push(c);\n\t\t\t\t\tlet old = c.componentWillUnmount;\n\t\t\t\t\tc.componentWillUnmount = () => {\n\t\t\t\t\t\tsubs.splice(subs.indexOf(c), 1);\n\t\t\t\t\t\tif (old) old.call(c);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn props.children;\n\t\t}\n\t};\n\n\t// Devtools needs access to the context object when it\n\t// encounters a Provider. This is necessary to support\n\t// setting `displayName` on the context object instead\n\t// of on the component itself. See:\n\t// https://reactjs.org/docs/context.html#contextdisplayname\n\n\treturn (context.Provider._contextRef = context.Consumer.contextType = context);\n}\n","export const EMPTY_OBJ = {};\nexport const EMPTY_ARR = [];\nexport const IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;\n","import { diff, unmount, applyRef } from './index';\nimport { createVNode, Fragment } from '../create-element';\nimport { EMPTY_OBJ, EMPTY_ARR } from '../constants';\nimport { getDomSibling } from '../component';\n\n/**\n * Diff the children of a virtual node\n * @param {import('../internal').PreactElement} parentDom The DOM element whose\n * children are being diffed\n * @param {import('../internal').ComponentChildren[]} renderResult\n * @param {import('../internal').VNode} newParentVNode The new virtual\n * node whose children should be diff'ed against oldParentVNode\n * @param {import('../internal').VNode} oldParentVNode The old virtual\n * node whose children should be diff'ed against newParentVNode\n * @param {object} globalContext The current context object - modified by getChildContext\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node\n * @param {Array<import('../internal').PreactElement>} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {import('../internal').PreactElement} oldDom The current attached DOM\n * element any new dom elements should be placed around. Likely `null` on first\n * render (except when hydrating). Can be a sibling DOM element when diffing\n * Fragments that have siblings. In most cases, it starts out as `oldChildren[0]._dom`.\n * @param {boolean} isHydrating Whether or not we are in hydration\n */\nexport function diffChildren(\n\tparentDom,\n\trenderResult,\n\tnewParentVNode,\n\toldParentVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\toldDom,\n\tisHydrating\n) {\n\tlet i, j, oldVNode, childVNode, newDom, firstChildDom, refs;\n\n\t// This is a compression of oldParentVNode!=null && oldParentVNode != EMPTY_OBJ && oldParentVNode._children || EMPTY_ARR\n\t// as EMPTY_OBJ._children should be `undefined`.\n\tlet oldChildren = (oldParentVNode && oldParentVNode._children) || EMPTY_ARR;\n\n\tlet oldChildrenLength = oldChildren.length;\n\n\tnewParentVNode._children = [];\n\tfor (i = 0; i < renderResult.length; i++) {\n\t\tchildVNode = renderResult[i];\n\n\t\tif (childVNode == null || typeof childVNode == 'boolean') {\n\t\t\tchildVNode = newParentVNode._children[i] = null;\n\t\t}\n\t\t// If this newVNode is being reused (e.g. <div>{reuse}{reuse}</div>) in the same diff,\n\t\t// or we are rendering a component (e.g. setState) copy the oldVNodes so it can have\n\t\t// it's own DOM & etc. pointers\n\t\telse if (\n\t\t\ttypeof childVNode == 'string' ||\n\t\t\ttypeof childVNode == 'number' ||\n\t\t\t// eslint-disable-next-line valid-typeof\n\t\t\ttypeof childVNode == 'bigint'\n\t\t) {\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tnull,\n\t\t\t\tchildVNode,\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\tchildVNode\n\t\t\t);\n\t\t} else if (Array.isArray(childVNode)) {\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tFragment,\n\t\t\t\t{ children: childVNode },\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\tnull\n\t\t\t);\n\t\t} else if (childVNode._depth > 0) {\n\t\t\t// VNode is already in use, clone it. This can happen in the following\n\t\t\t// scenario:\n\t\t\t//   const reuse = <div />\n\t\t\t//   <div>{reuse}<span />{reuse}</div>\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tchildVNode.type,\n\t\t\t\tchildVNode.props,\n\t\t\t\tchildVNode.key,\n\t\t\t\tchildVNode.ref ? childVNode.ref : null,\n\t\t\t\tchildVNode._original\n\t\t\t);\n\t\t} else {\n\t\t\tchildVNode = newParentVNode._children[i] = childVNode;\n\t\t}\n\n\t\t// Terser removes the `continue` here and wraps the loop body\n\t\t// in a `if (childVNode) { ... } condition\n\t\tif (childVNode == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tchildVNode._parent = newParentVNode;\n\t\tchildVNode._depth = newParentVNode._depth + 1;\n\n\t\t// Check if we find a corresponding element in oldChildren.\n\t\t// If found, delete the array item by setting to `undefined`.\n\t\t// We use `undefined`, as `null` is reserved for empty placeholders\n\t\t// (holes).\n\t\toldVNode = oldChildren[i];\n\n\t\tif (\n\t\t\toldVNode === null ||\n\t\t\t(oldVNode &&\n\t\t\t\tchildVNode.key == oldVNode.key &&\n\t\t\t\tchildVNode.type === oldVNode.type)\n\t\t) {\n\t\t\toldChildren[i] = undefined;\n\t\t} else {\n\t\t\t// Either oldVNode === undefined or oldChildrenLength > 0,\n\t\t\t// so after this loop oldVNode == null or oldVNode is a valid value.\n\t\t\tfor (j = 0; j < oldChildrenLength; j++) {\n\t\t\t\toldVNode = oldChildren[j];\n\t\t\t\t// If childVNode is unkeyed, we only match similarly unkeyed nodes, otherwise we match by key.\n\t\t\t\t// We always match by type (in either case).\n\t\t\t\tif (\n\t\t\t\t\toldVNode &&\n\t\t\t\t\tchildVNode.key == oldVNode.key &&\n\t\t\t\t\tchildVNode.type === oldVNode.type\n\t\t\t\t) {\n\t\t\t\t\toldChildren[j] = undefined;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\toldVNode = null;\n\t\t\t}\n\t\t}\n\n\t\toldVNode = oldVNode || EMPTY_OBJ;\n\n\t\t// Morph the old element into the new one, but don't append it to the dom yet\n\t\tdiff(\n\t\t\tparentDom,\n\t\t\tchildVNode,\n\t\t\toldVNode,\n\t\t\tglobalContext,\n\t\t\tisSvg,\n\t\t\texcessDomChildren,\n\t\t\tcommitQueue,\n\t\t\toldDom,\n\t\t\tisHydrating\n\t\t);\n\n\t\tnewDom = childVNode._dom;\n\n\t\tif ((j = childVNode.ref) && oldVNode.ref != j) {\n\t\t\tif (!refs) refs = [];\n\t\t\tif (oldVNode.ref) refs.push(oldVNode.ref, null, childVNode);\n\t\t\trefs.push(j, childVNode._component || newDom, childVNode);\n\t\t}\n\n\t\tif (newDom != null) {\n\t\t\tif (firstChildDom == null) {\n\t\t\t\tfirstChildDom = newDom;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof childVNode.type == 'function' &&\n\t\t\t\tchildVNode._children === oldVNode._children\n\t\t\t) {\n\t\t\t\tchildVNode._nextDom = oldDom = reorderChildren(\n\t\t\t\t\tchildVNode,\n\t\t\t\t\toldDom,\n\t\t\t\t\tparentDom\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\toldDom = placeChild(\n\t\t\t\t\tparentDom,\n\t\t\t\t\tchildVNode,\n\t\t\t\t\toldVNode,\n\t\t\t\t\toldChildren,\n\t\t\t\t\tnewDom,\n\t\t\t\t\toldDom\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (typeof newParentVNode.type == 'function') {\n\t\t\t\t// Because the newParentVNode is Fragment-like, we need to set it's\n\t\t\t\t// _nextDom property to the nextSibling of its last child DOM node.\n\t\t\t\t//\n\t\t\t\t// `oldDom` contains the correct value here because if the last child\n\t\t\t\t// is a Fragment-like, then oldDom has already been set to that child's _nextDom.\n\t\t\t\t// If the last child is a DOM VNode, then oldDom will be set to that DOM\n\t\t\t\t// node's nextSibling.\n\t\t\t\tnewParentVNode._nextDom = oldDom;\n\t\t\t}\n\t\t} else if (\n\t\t\toldDom &&\n\t\t\toldVNode._dom == oldDom &&\n\t\t\toldDom.parentNode != parentDom\n\t\t) {\n\t\t\t// The above condition is to handle null placeholders. See test in placeholder.test.js:\n\t\t\t// `efficiently replace null placeholders in parent rerenders`\n\t\t\toldDom = getDomSibling(oldVNode);\n\t\t}\n\t}\n\n\tnewParentVNode._dom = firstChildDom;\n\n\t// Remove remaining oldChildren if there are any.\n\tfor (i = oldChildrenLength; i--; ) {\n\t\tif (oldChildren[i] != null) {\n\t\t\tif (\n\t\t\t\ttypeof newParentVNode.type == 'function' &&\n\t\t\t\toldChildren[i]._dom != null &&\n\t\t\t\toldChildren[i]._dom == newParentVNode._nextDom\n\t\t\t) {\n\t\t\t\t// If the newParentVNode.__nextDom points to a dom node that is about to\n\t\t\t\t// be unmounted, then get the next sibling of that vnode and set\n\t\t\t\t// _nextDom to it\n\t\t\t\tnewParentVNode._nextDom = getLastDom(oldParentVNode).nextSibling;\n\t\t\t}\n\n\t\t\tunmount(oldChildren[i], oldChildren[i]);\n\t\t}\n\t}\n\n\t// Set refs only after unmount\n\tif (refs) {\n\t\tfor (i = 0; i < refs.length; i++) {\n\t\t\tapplyRef(refs[i], refs[++i], refs[++i]);\n\t\t}\n\t}\n}\n\nfunction reorderChildren(childVNode, oldDom, parentDom) {\n\t// Note: VNodes in nested suspended trees may be missing _children.\n\tlet c = childVNode._children;\n\tlet tmp = 0;\n\tfor (; c && tmp < c.length; tmp++) {\n\t\tlet vnode = c[tmp];\n\t\tif (vnode) {\n\t\t\t// We typically enter this code path on sCU bailout, where we copy\n\t\t\t// oldVNode._children to newVNode._children. If that is the case, we need\n\t\t\t// to update the old children's _parent pointer to point to the newVNode\n\t\t\t// (childVNode here).\n\t\t\tvnode._parent = childVNode;\n\n\t\t\tif (typeof vnode.type == 'function') {\n\t\t\t\toldDom = reorderChildren(vnode, oldDom, parentDom);\n\t\t\t} else {\n\t\t\t\toldDom = placeChild(parentDom, vnode, vnode, c, vnode._dom, oldDom);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn oldDom;\n}\n\n/**\n * Flatten and loop through the children of a virtual node\n * @param {import('../index').ComponentChildren} children The unflattened\n * children of a virtual node\n * @returns {import('../internal').VNode[]}\n */\nexport function toChildArray(children, out) {\n\tout = out || [];\n\tif (children == null || typeof children == 'boolean') {\n\t} else if (Array.isArray(children)) {\n\t\tchildren.some(child => {\n\t\t\ttoChildArray(child, out);\n\t\t});\n\t} else {\n\t\tout.push(children);\n\t}\n\treturn out;\n}\n\nfunction placeChild(\n\tparentDom,\n\tchildVNode,\n\toldVNode,\n\toldChildren,\n\tnewDom,\n\toldDom\n) {\n\tlet nextDom;\n\tif (childVNode._nextDom !== undefined) {\n\t\t// Only Fragments or components that return Fragment like VNodes will\n\t\t// have a non-undefined _nextDom. Continue the diff from the sibling\n\t\t// of last DOM child of this child VNode\n\t\tnextDom = childVNode._nextDom;\n\n\t\t// Eagerly cleanup _nextDom. We don't need to persist the value because\n\t\t// it is only used by `diffChildren` to determine where to resume the diff after\n\t\t// diffing Components and Fragments. Once we store it the nextDOM local var, we\n\t\t// can clean up the property\n\t\tchildVNode._nextDom = undefined;\n\t} else if (\n\t\toldVNode == null ||\n\t\tnewDom != oldDom ||\n\t\tnewDom.parentNode == null\n\t) {\n\t\touter: if (oldDom == null || oldDom.parentNode !== parentDom) {\n\t\t\tparentDom.appendChild(newDom);\n\t\t\tnextDom = null;\n\t\t} else {\n\t\t\t// `j<oldChildrenLength; j+=2` is an alternative to `j++<oldChildrenLength/2`\n\t\t\tfor (\n\t\t\t\tlet sibDom = oldDom, j = 0;\n\t\t\t\t(sibDom = sibDom.nextSibling) && j < oldChildren.length;\n\t\t\t\tj += 1\n\t\t\t) {\n\t\t\t\tif (sibDom == newDom) {\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t}\n\t\t\tparentDom.insertBefore(newDom, oldDom);\n\t\t\tnextDom = oldDom;\n\t\t}\n\t}\n\n\t// If we have pre-calculated the nextDOM node, use it. Else calculate it now\n\t// Strictly check for `undefined` here cuz `null` is a valid value of `nextDom`.\n\t// See more detail in create-element.js:createVNode\n\tif (nextDom !== undefined) {\n\t\toldDom = nextDom;\n\t} else {\n\t\toldDom = newDom.nextSibling;\n\t}\n\n\treturn oldDom;\n}\n\n/**\n * @param {import('../internal').VNode} vnode\n */\nfunction getLastDom(vnode) {\n\tif (vnode.type == null || typeof vnode.type === 'string') {\n\t\treturn vnode._dom;\n\t}\n\n\tif (vnode._children) {\n\t\tfor (let i = vnode._children.length - 1; i >= 0; i--) {\n\t\t\tlet child = vnode._children[i];\n\t\t\tif (child) {\n\t\t\t\tlet lastDom = getLastDom(child);\n\t\t\t\tif (lastDom) {\n\t\t\t\t\treturn lastDom;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n","import { EMPTY_OBJ } from '../constants';\nimport { Component, getDomSibling } from '../component';\nimport { Fragment } from '../create-element';\nimport { diffChildren } from './children';\nimport { diffProps, setProperty } from './props';\nimport { assign, removeNode, slice } from '../util';\nimport options from '../options';\n\n/**\n * Diff two virtual nodes and apply proper changes to the DOM\n * @param {import('../internal').PreactElement} parentDom The parent of the DOM element\n * @param {import('../internal').VNode} newVNode The new virtual node\n * @param {import('../internal').VNode} oldVNode The old virtual node\n * @param {object} globalContext The current context object. Modified by getChildContext\n * @param {boolean} isSvg Whether or not this element is an SVG node\n * @param {Array<import('../internal').PreactElement>} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {import('../internal').PreactElement} oldDom The current attached DOM\n * element any new dom elements should be placed around. Likely `null` on first\n * render (except when hydrating). Can be a sibling DOM element when diffing\n * Fragments that have siblings. In most cases, it starts out as `oldChildren[0]._dom`.\n * @param {boolean} [isHydrating] Whether or not we are in hydration\n */\nexport function diff(\n\tparentDom,\n\tnewVNode,\n\toldVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\toldDom,\n\tisHydrating\n) {\n\tlet tmp,\n\t\tnewType = newVNode.type;\n\n\t// When passing through createElement it assigns the object\n\t// constructor as undefined. This to prevent JSON-injection.\n\tif (newVNode.constructor !== undefined) return null;\n\n\t// If the previous diff bailed out, resume creating/hydrating.\n\tif (oldVNode._hydrating != null) {\n\t\tisHydrating = oldVNode._hydrating;\n\t\toldDom = newVNode._dom = oldVNode._dom;\n\t\t// if we resume, we want the tree to be \"unlocked\"\n\t\tnewVNode._hydrating = null;\n\t\texcessDomChildren = [oldDom];\n\t}\n\n\tif ((tmp = options._diff)) tmp(newVNode);\n\n\ttry {\n\t\touter: if (typeof newType == 'function') {\n\t\t\tlet c, isNew, oldProps, oldState, snapshot, clearProcessingException;\n\t\t\tlet newProps = newVNode.props;\n\n\t\t\t// Necessary for createContext api. Setting this property will pass\n\t\t\t// the context value as `this.context` just for this component.\n\t\t\ttmp = newType.contextType;\n\t\t\tlet provider = tmp && globalContext[tmp._id];\n\t\t\tlet componentContext = tmp\n\t\t\t\t? provider\n\t\t\t\t\t? provider.props.value\n\t\t\t\t\t: tmp._defaultValue\n\t\t\t\t: globalContext;\n\n\t\t\t// Get component and set it to `c`\n\t\t\tif (oldVNode._component) {\n\t\t\t\tc = newVNode._component = oldVNode._component;\n\t\t\t\tclearProcessingException = c._processingException = c._pendingError;\n\t\t\t} else {\n\t\t\t\t// Instantiate the new component\n\t\t\t\tif ('prototype' in newType && newType.prototype.render) {\n\t\t\t\t\t// @ts-ignore The check above verifies that newType is suppose to be constructed\n\t\t\t\t\tnewVNode._component = c = new newType(newProps, componentContext); // eslint-disable-line new-cap\n\t\t\t\t} else {\n\t\t\t\t\t// @ts-ignore Trust me, Component implements the interface we want\n\t\t\t\t\tnewVNode._component = c = new Component(newProps, componentContext);\n\t\t\t\t\tc.constructor = newType;\n\t\t\t\t\tc.render = doRender;\n\t\t\t\t}\n\t\t\t\tif (provider) provider.sub(c);\n\n\t\t\t\tc.props = newProps;\n\t\t\t\tif (!c.state) c.state = {};\n\t\t\t\tc.context = componentContext;\n\t\t\t\tc._globalContext = globalContext;\n\t\t\t\tisNew = c._dirty = true;\n\t\t\t\tc._renderCallbacks = [];\n\t\t\t\tc._stateCallbacks = [];\n\t\t\t}\n\n\t\t\t// Invoke getDerivedStateFromProps\n\t\t\tif (c._nextState == null) {\n\t\t\t\tc._nextState = c.state;\n\t\t\t}\n\n\t\t\tif (newType.getDerivedStateFromProps != null) {\n\t\t\t\tif (c._nextState == c.state) {\n\t\t\t\t\tc._nextState = assign({}, c._nextState);\n\t\t\t\t}\n\n\t\t\t\tassign(\n\t\t\t\t\tc._nextState,\n\t\t\t\t\tnewType.getDerivedStateFromProps(newProps, c._nextState)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\toldProps = c.props;\n\t\t\toldState = c.state;\n\t\t\tc._vnode = newVNode;\n\n\t\t\t// Invoke pre-render lifecycle methods\n\t\t\tif (isNew) {\n\t\t\t\tif (\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\n\t\t\t\t\tc.componentWillMount != null\n\t\t\t\t) {\n\t\t\t\t\tc.componentWillMount();\n\t\t\t\t}\n\n\t\t\t\tif (c.componentDidMount != null) {\n\t\t\t\t\tc._renderCallbacks.push(c.componentDidMount);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\n\t\t\t\t\tnewProps !== oldProps &&\n\t\t\t\t\tc.componentWillReceiveProps != null\n\t\t\t\t) {\n\t\t\t\t\tc.componentWillReceiveProps(newProps, componentContext);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t(!c._force &&\n\t\t\t\t\t\tc.shouldComponentUpdate != null &&\n\t\t\t\t\t\tc.shouldComponentUpdate(\n\t\t\t\t\t\t\tnewProps,\n\t\t\t\t\t\t\tc._nextState,\n\t\t\t\t\t\t\tcomponentContext\n\t\t\t\t\t\t) === false) ||\n\t\t\t\t\tnewVNode._original === oldVNode._original\n\t\t\t\t) {\n\t\t\t\t\t// More info about this here: https://gist.github.com/JoviDeCroock/bec5f2ce93544d2e6070ef8e0036e4e8\n\t\t\t\t\tif (newVNode._original !== oldVNode._original) {\n\t\t\t\t\t\t// When we are dealing with a bail because of sCU we have to update\n\t\t\t\t\t\t// the props, state and dirty-state.\n\t\t\t\t\t\t// when we are dealing with strict-equality we don't as the child could still\n\t\t\t\t\t\t// be dirtied see #3883\n\t\t\t\t\t\tc.props = newProps;\n\t\t\t\t\t\tc.state = c._nextState;\n\t\t\t\t\t\tc._dirty = false;\n\t\t\t\t\t}\n\t\t\t\t\tnewVNode._dom = oldVNode._dom;\n\t\t\t\t\tnewVNode._children = oldVNode._children;\n\t\t\t\t\tnewVNode._children.forEach(vnode => {\n\t\t\t\t\t\tif (vnode) vnode._parent = newVNode;\n\t\t\t\t\t});\n\n\t\t\t\t\tfor (let i = 0; i < c._stateCallbacks.length; i++) {\n\t\t\t\t\t\tc._renderCallbacks.push(c._stateCallbacks[i]);\n\t\t\t\t\t}\n\t\t\t\t\tc._stateCallbacks = [];\n\n\t\t\t\t\tif (c._renderCallbacks.length) {\n\t\t\t\t\t\tcommitQueue.push(c);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\n\t\t\t\tif (c.componentWillUpdate != null) {\n\t\t\t\t\tc.componentWillUpdate(newProps, c._nextState, componentContext);\n\t\t\t\t}\n\n\t\t\t\tif (c.componentDidUpdate != null) {\n\t\t\t\t\tc._renderCallbacks.push(() => {\n\t\t\t\t\t\tc.componentDidUpdate(oldProps, oldState, snapshot);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tc.context = componentContext;\n\t\t\tc.props = newProps;\n\t\t\tc._parentDom = parentDom;\n\n\t\t\tlet renderHook = options._render,\n\t\t\t\tcount = 0;\n\t\t\tif ('prototype' in newType && newType.prototype.render) {\n\t\t\t\tc.state = c._nextState;\n\t\t\t\tc._dirty = false;\n\n\t\t\t\tif (renderHook) renderHook(newVNode);\n\n\t\t\t\ttmp = c.render(c.props, c.state, c.context);\n\n\t\t\t\tfor (let i = 0; i < c._stateCallbacks.length; i++) {\n\t\t\t\t\tc._renderCallbacks.push(c._stateCallbacks[i]);\n\t\t\t\t}\n\t\t\t\tc._stateCallbacks = [];\n\t\t\t} else {\n\t\t\t\tdo {\n\t\t\t\t\tc._dirty = false;\n\t\t\t\t\tif (renderHook) renderHook(newVNode);\n\n\t\t\t\t\ttmp = c.render(c.props, c.state, c.context);\n\n\t\t\t\t\t// Handle setState called in render, see #2553\n\t\t\t\t\tc.state = c._nextState;\n\t\t\t\t} while (c._dirty && ++count < 25);\n\t\t\t}\n\n\t\t\t// Handle setState called in render, see #2553\n\t\t\tc.state = c._nextState;\n\n\t\t\tif (c.getChildContext != null) {\n\t\t\t\tglobalContext = assign(assign({}, globalContext), c.getChildContext());\n\t\t\t}\n\n\t\t\tif (!isNew && c.getSnapshotBeforeUpdate != null) {\n\t\t\t\tsnapshot = c.getSnapshotBeforeUpdate(oldProps, oldState);\n\t\t\t}\n\n\t\t\tlet isTopLevelFragment =\n\t\t\t\ttmp != null && tmp.type === Fragment && tmp.key == null;\n\t\t\tlet renderResult = isTopLevelFragment ? tmp.props.children : tmp;\n\n\t\t\tdiffChildren(\n\t\t\t\tparentDom,\n\t\t\t\tArray.isArray(renderResult) ? renderResult : [renderResult],\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tisSvg,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\toldDom,\n\t\t\t\tisHydrating\n\t\t\t);\n\n\t\t\tc.base = newVNode._dom;\n\n\t\t\t// We successfully rendered this VNode, unset any stored hydration/bailout state:\n\t\t\tnewVNode._hydrating = null;\n\n\t\t\tif (c._renderCallbacks.length) {\n\t\t\t\tcommitQueue.push(c);\n\t\t\t}\n\n\t\t\tif (clearProcessingException) {\n\t\t\t\tc._pendingError = c._processingException = null;\n\t\t\t}\n\n\t\t\tc._force = false;\n\t\t} else if (\n\t\t\texcessDomChildren == null &&\n\t\t\tnewVNode._original === oldVNode._original\n\t\t) {\n\t\t\tnewVNode._children = oldVNode._children;\n\t\t\tnewVNode._dom = oldVNode._dom;\n\t\t} else {\n\t\t\tnewVNode._dom = diffElementNodes(\n\t\t\t\toldVNode._dom,\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tisSvg,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\tisHydrating\n\t\t\t);\n\t\t}\n\n\t\tif ((tmp = options.diffed)) tmp(newVNode);\n\t} catch (e) {\n\t\tnewVNode._original = null;\n\t\t// if hydrating or creating initial tree, bailout preserves DOM:\n\t\tif (isHydrating || excessDomChildren != null) {\n\t\t\tnewVNode._dom = oldDom;\n\t\t\tnewVNode._hydrating = !!isHydrating;\n\t\t\texcessDomChildren[excessDomChildren.indexOf(oldDom)] = null;\n\t\t\t// ^ could possibly be simplified to:\n\t\t\t// excessDomChildren.length = 0;\n\t\t}\n\t\toptions._catchError(e, newVNode, oldVNode);\n\t}\n}\n\n/**\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {import('../internal').VNode} root\n */\nexport function commitRoot(commitQueue, root) {\n\tif (options._commit) options._commit(root, commitQueue);\n\n\tcommitQueue.some(c => {\n\t\ttry {\n\t\t\t// @ts-ignore Reuse the commitQueue variable here so the type changes\n\t\t\tcommitQueue = c._renderCallbacks;\n\t\t\tc._renderCallbacks = [];\n\t\t\tcommitQueue.some(cb => {\n\t\t\t\t// @ts-ignore See above ts-ignore on commitQueue\n\t\t\t\tcb.call(c);\n\t\t\t});\n\t\t} catch (e) {\n\t\t\toptions._catchError(e, c._vnode);\n\t\t}\n\t});\n}\n\n/**\n * Diff two virtual nodes representing DOM element\n * @param {import('../internal').PreactElement} dom The DOM element representing\n * the virtual nodes being diffed\n * @param {import('../internal').VNode} newVNode The new virtual node\n * @param {import('../internal').VNode} oldVNode The old virtual node\n * @param {object} globalContext The current context object\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node\n * @param {*} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {boolean} isHydrating Whether or not we are in hydration\n * @returns {import('../internal').PreactElement}\n */\nfunction diffElementNodes(\n\tdom,\n\tnewVNode,\n\toldVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\tisHydrating\n) {\n\tlet oldProps = oldVNode.props;\n\tlet newProps = newVNode.props;\n\tlet nodeType = newVNode.type;\n\tlet i = 0;\n\n\t// Tracks entering and exiting SVG namespace when descending through the tree.\n\tif (nodeType === 'svg') isSvg = true;\n\n\tif (excessDomChildren != null) {\n\t\tfor (; i < excessDomChildren.length; i++) {\n\t\t\tconst child = excessDomChildren[i];\n\n\t\t\t// if newVNode matches an element in excessDomChildren or the `dom`\n\t\t\t// argument matches an element in excessDomChildren, remove it from\n\t\t\t// excessDomChildren so it isn't later removed in diffChildren\n\t\t\tif (\n\t\t\t\tchild &&\n\t\t\t\t'setAttribute' in child === !!nodeType &&\n\t\t\t\t(nodeType ? child.localName === nodeType : child.nodeType === 3)\n\t\t\t) {\n\t\t\t\tdom = child;\n\t\t\t\texcessDomChildren[i] = null;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (dom == null) {\n\t\tif (nodeType === null) {\n\t\t\t// @ts-ignore createTextNode returns Text, we expect PreactElement\n\t\t\treturn document.createTextNode(newProps);\n\t\t}\n\n\t\tif (isSvg) {\n\t\t\tdom = document.createElementNS(\n\t\t\t\t'http://www.w3.org/2000/svg',\n\t\t\t\t// @ts-ignore We know `newVNode.type` is a string\n\t\t\t\tnodeType\n\t\t\t);\n\t\t} else {\n\t\t\tdom = document.createElement(\n\t\t\t\t// @ts-ignore We know `newVNode.type` is a string\n\t\t\t\tnodeType,\n\t\t\t\tnewProps.is && newProps\n\t\t\t);\n\t\t}\n\n\t\t// we created a new parent, so none of the previously attached children can be reused:\n\t\texcessDomChildren = null;\n\t\t// we are creating a new node, so we can assume this is a new subtree (in case we are hydrating), this deopts the hydrate\n\t\tisHydrating = false;\n\t}\n\n\tif (nodeType === null) {\n\t\t// During hydration, we still have to split merged text from SSR'd HTML.\n\t\tif (oldProps !== newProps && (!isHydrating || dom.data !== newProps)) {\n\t\t\tdom.data = newProps;\n\t\t}\n\t} else {\n\t\t// If excessDomChildren was not null, repopulate it with the current element's children:\n\t\texcessDomChildren = excessDomChildren && slice.call(dom.childNodes);\n\n\t\toldProps = oldVNode.props || EMPTY_OBJ;\n\n\t\tlet oldHtml = oldProps.dangerouslySetInnerHTML;\n\t\tlet newHtml = newProps.dangerouslySetInnerHTML;\n\n\t\t// During hydration, props are not diffed at all (including dangerouslySetInnerHTML)\n\t\t// @TODO we should warn in debug mode when props don't match here.\n\t\tif (!isHydrating) {\n\t\t\t// But, if we are in a situation where we are using existing DOM (e.g. replaceNode)\n\t\t\t// we should read the existing DOM attributes to diff them\n\t\t\tif (excessDomChildren != null) {\n\t\t\t\toldProps = {};\n\t\t\t\tfor (i = 0; i < dom.attributes.length; i++) {\n\t\t\t\t\toldProps[dom.attributes[i].name] = dom.attributes[i].value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (newHtml || oldHtml) {\n\t\t\t\t// Avoid re-applying the same '__html' if it did not changed between re-render\n\t\t\t\tif (\n\t\t\t\t\t!newHtml ||\n\t\t\t\t\t((!oldHtml || newHtml.__html != oldHtml.__html) &&\n\t\t\t\t\t\tnewHtml.__html !== dom.innerHTML)\n\t\t\t\t) {\n\t\t\t\t\tdom.innerHTML = (newHtml && newHtml.__html) || '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdiffProps(dom, newProps, oldProps, isSvg, isHydrating);\n\n\t\t// If the new vnode didn't have dangerouslySetInnerHTML, diff its children\n\t\tif (newHtml) {\n\t\t\tnewVNode._children = [];\n\t\t} else {\n\t\t\ti = newVNode.props.children;\n\t\t\tdiffChildren(\n\t\t\t\tdom,\n\t\t\t\tArray.isArray(i) ? i : [i],\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tisSvg && nodeType !== 'foreignObject',\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\texcessDomChildren\n\t\t\t\t\t? excessDomChildren[0]\n\t\t\t\t\t: oldVNode._children && getDomSibling(oldVNode, 0),\n\t\t\t\tisHydrating\n\t\t\t);\n\n\t\t\t// Remove children that are not part of any vnode.\n\t\t\tif (excessDomChildren != null) {\n\t\t\t\tfor (i = excessDomChildren.length; i--; ) {\n\t\t\t\t\tif (excessDomChildren[i] != null) removeNode(excessDomChildren[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// (as above, don't diff props during hydration)\n\t\tif (!isHydrating) {\n\t\t\tif (\n\t\t\t\t'value' in newProps &&\n\t\t\t\t(i = newProps.value) !== undefined &&\n\t\t\t\t// #2756 For the <progress>-element the initial value is 0,\n\t\t\t\t// despite the attribute not being present. When the attribute\n\t\t\t\t// is missing the progress bar is treated as indeterminate.\n\t\t\t\t// To fix that we'll always update it when it is 0 for progress elements\n\t\t\t\t(i !== dom.value ||\n\t\t\t\t\t(nodeType === 'progress' && !i) ||\n\t\t\t\t\t// This is only for IE 11 to fix <select> value not being updated.\n\t\t\t\t\t// To avoid a stale select value we need to set the option.value\n\t\t\t\t\t// again, which triggers IE11 to re-evaluate the select value\n\t\t\t\t\t(nodeType === 'option' && i !== oldProps.value))\n\t\t\t) {\n\t\t\t\tsetProperty(dom, 'value', i, oldProps.value, false);\n\t\t\t}\n\t\t\tif (\n\t\t\t\t'checked' in newProps &&\n\t\t\t\t(i = newProps.checked) !== undefined &&\n\t\t\t\ti !== dom.checked\n\t\t\t) {\n\t\t\t\tsetProperty(dom, 'checked', i, oldProps.checked, false);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn dom;\n}\n\n/**\n * Invoke or update a ref, depending on whether it is a function or object ref.\n * @param {object|function} ref\n * @param {any} value\n * @param {import('../internal').VNode} vnode\n */\nexport function applyRef(ref, value, vnode) {\n\ttry {\n\t\tif (typeof ref == 'function') ref(value);\n\t\telse ref.current = value;\n\t} catch (e) {\n\t\toptions._catchError(e, vnode);\n\t}\n}\n\n/**\n * Unmount a virtual node from the tree and apply DOM changes\n * @param {import('../internal').VNode} vnode The virtual node to unmount\n * @param {import('../internal').VNode} parentVNode The parent of the VNode that\n * initiated the unmount\n * @param {boolean} [skipRemove] Flag that indicates that a parent node of the\n * current element is already detached from the DOM.\n */\nexport function unmount(vnode, parentVNode, skipRemove) {\n\tlet r;\n\tif (options.unmount) options.unmount(vnode);\n\n\tif ((r = vnode.ref)) {\n\t\tif (!r.current || r.current === vnode._dom) {\n\t\t\tapplyRef(r, null, parentVNode);\n\t\t}\n\t}\n\n\tif ((r = vnode._component) != null) {\n\t\tif (r.componentWillUnmount) {\n\t\t\ttry {\n\t\t\t\tr.componentWillUnmount();\n\t\t\t} catch (e) {\n\t\t\t\toptions._catchError(e, parentVNode);\n\t\t\t}\n\t\t}\n\n\t\tr.base = r._parentDom = null;\n\t\tvnode._component = undefined;\n\t}\n\n\tif ((r = vnode._children)) {\n\t\tfor (let i = 0; i < r.length; i++) {\n\t\t\tif (r[i]) {\n\t\t\t\tunmount(\n\t\t\t\t\tr[i],\n\t\t\t\t\tparentVNode,\n\t\t\t\t\tskipRemove || typeof vnode.type !== 'function'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!skipRemove && vnode._dom != null) {\n\t\tremoveNode(vnode._dom);\n\t}\n\n\t// Must be set to `undefined` to properly clean up `_nextDom`\n\t// for which `null` is a valid value. See comment in `create-element.js`\n\tvnode._parent = vnode._dom = vnode._nextDom = undefined;\n}\n\n/** The `.render()` method for a PFC backing instance. */\nfunction doRender(props, state, context) {\n\treturn this.constructor(props, context);\n}\n","/**\n * Find the closest error boundary to a thrown error and call it\n * @param {object} error The thrown value\n * @param {import('../internal').VNode} vnode The vnode that threw\n * the error that was caught (except for unmounting when this parameter\n * is the highest parent that was being unmounted)\n * @param {import('../internal').VNode} [oldVNode]\n * @param {import('../internal').ErrorInfo} [errorInfo]\n */\nexport function _catchError(error, vnode, oldVNode, errorInfo) {\n\t/** @type {import('../internal').Component} */\n\tlet component, ctor, handled;\n\n\tfor (; (vnode = vnode._parent); ) {\n\t\tif ((component = vnode._component) && !component._processingException) {\n\t\t\ttry {\n\t\t\t\tctor = component.constructor;\n\n\t\t\t\tif (ctor && ctor.getDerivedStateFromError != null) {\n\t\t\t\t\tcomponent.setState(ctor.getDerivedStateFromError(error));\n\t\t\t\t\thandled = component._dirty;\n\t\t\t\t}\n\n\t\t\t\tif (component.componentDidCatch != null) {\n\t\t\t\t\tcomponent.componentDidCatch(error, errorInfo || {});\n\t\t\t\t\thandled = component._dirty;\n\t\t\t\t}\n\n\t\t\t\t// This is an error boundary. Mark it as having bailed out, and whether it was mid-hydration.\n\t\t\t\tif (handled) {\n\t\t\t\t\treturn (component._pendingError = component);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\terror = e;\n\t\t\t}\n\t\t}\n\t}\n\n\tthrow error;\n}\n","export class IntlError extends Error {\n\tprivate readonly isIntlError = true;\n\n\tpublic constructor(\n\t\tpublic readonly code: string,\n\t\tmessage: string\n\t) {\n\t\tsuper(`${code} ${message}`);\n\t}\n\n\tpublic static readonly FORMAT_UNAVAILABLE = 'FormatUnavailable';\n\tpublic static readonly INVALID_PARAMETER = 'InvalidParameter';\n\tpublic static readonly KEY_NOT_FOUND = 'KeyNotFound';\n\tpublic static readonly PARSE_ERROR = 'KeyNotFound';\n\n\tpublic static is(obj: unknown): obj is IntlError {\n\t\treturn (obj as IntlError | undefined)?.isIntlError === true;\n\t}\n}\n","import type { TranslationMap } from '~/types';\n\nfunction flattenTranslationMapInto(\n\tsource: TranslationMap,\n\tdestination: Record<string, string | undefined>,\n\tprefix: string\n) {\n\tfor (const key in source) {\n\t\tif (key.startsWith('$')) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst value = source[key];\n\t\tswitch (typeof value) {\n\t\t\tcase 'string':\n\t\t\t\tdestination[prefix + key] = value;\n\t\t\t\tbreak;\n\n\t\t\tcase 'object':\n\t\t\t\tif (value !== null) {\n\t\t\t\t\tflattenTranslationMapInto(value, destination, `${prefix}${key}.`);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn destination;\n}\n\nexport function flattenTranslationMap(map: TranslationMap): Record<string, string | undefined> {\n\treturn flattenTranslationMapInto(map, {}, '');\n}\n\nexport function mapObjectValuesNotNull<TKey extends keyof any, TIn, TOut>(source: Record<TKey, TIn>, callback: (value: TIn, key: TKey) => TOut) {\n\tconst result = {} as Record<TKey, NonNullable<TOut>>;\n\tfor (const key in source) {\n\t\tif (Object.prototype.hasOwnProperty.call(source, key)) {\n\t\t\tconst value = callback(source[key], key);\n\t\t\tif (value !== null && value !== undefined) {\n\t\t\t\tresult[key] = value;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result;\n}\n","import type { Placeholder } from '~/parser/parser';\nimport type { Vars } from '~/types';\n\nexport function getFormatName(placeholder: Placeholder) {\n\treturn placeholder[1] ?? 'variable';\n}\n\nexport function expand(placeholder: Placeholder, vars?: Vars) {\n\tconst varName = placeholder[0];\n\tif (vars === undefined || !Object.prototype.hasOwnProperty.call(vars, varName)) {\n\t\treturn varName;\n\t}\n\n\treturn '' + vars[varName];\n}\n","import { IntlError } from '~/IntlError';\nimport type { Attributes, Messages, Placeholder } from '~/parser/parser';\n\nimport { getFormatName } from './placeholder';\n\ntype Validator<T> = (value: unknown, type: string, index: number) => asserts value is T;\ntype ValidatedTypes<V extends readonly any[]> = { [I in keyof V]: V[I] extends Validator<infer T> ? T : never };\n\nexport function assertParamsValid<TValidators extends readonly Validator<any>[]>(\n\tplaceholder: readonly any[],\n\tvalidators: TValidators\n): asserts placeholder is [ string, string?, ...ValidatedTypes<TValidators> ] {\n\tconst { length } = validators;\n\tconst formatName = getFormatName(placeholder as Placeholder);\n\n\tif (placeholder.length - 2 > length) {\n\t\tthrow new IntlError(\n\t\t\tIntlError.INVALID_PARAMETER,\n\t\t\t`too many parameters for format '${formatName}'`\n\t\t);\n\t}\n\n\tfor (let paramIndex = 0; paramIndex < length; ++paramIndex) {\n\t\tvalidators[paramIndex].call(null, placeholder[2 + paramIndex], formatName, paramIndex);\n\t}\n}\n\n\nexport function assertIdentifier(value: unknown, formatName: string, paramIndex: number): asserts value is string {\n\tif (typeof value !== 'string') {\n\t\tfail('an identifier', formatName, paramIndex);\n\t}\n}\n\nexport function assertMessages(obj: unknown, formatName: string, paramIndex: number): asserts obj is Messages {\n\tif (!(isObject(obj) && Array.isArray(getAnyValue(obj)))) {\n\t\tfail('a map of messages', formatName, paramIndex);\n\t}\n}\n\nexport function assertAttributes(obj: unknown, formatName: string, paramIndex: number): asserts obj is Attributes {\n\tif (!(isObject(obj) && typeof getAnyValue(obj) === 'string')) {\n\t\tfail('a map of attributes', formatName, paramIndex);\n\t}\n}\n\nexport function optional<T>(validator: Validator<T>): Validator<T | undefined> {\n\treturn (value, format, index): asserts value is T | undefined => {\n\t\tif (value === null || value === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tvalidator(value, format, index);\n\t};\n}\n\n\nfunction isObject(value: unknown): value is {} {\n\treturn value !== null && typeof value === 'object';\n}\n\nfunction getAnyValue(obj: {}): unknown {\n\tfor (const key in obj) {\n\t\tif (Object.prototype.hasOwnProperty.call(obj, key)) {\n\t\t\treturn obj[key as never];\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\nfunction fail(expected: string, formatName: string, paramIndex: number) {\n\tthrow new IntlError(\n\t\tIntlError.INVALID_PARAMETER,\n\t\t`expected parameter ${paramIndex + 1} of format '${formatName}' to be ${expected}`\n\t);\n}\n","import { IntlError } from '~/IntlError';\n\nimport type { DateTimeFormatter, DateTimeTranslations } from './types';\n\ninterface PartFormatter {\n\t(date: Date, length: number, translations: DateTimeTranslations): string;\n}\n\nconst PARTS: Record<string, PartFormatter | undefined> = {\n\t/* eslint-disable @typescript-eslint/naming-convention */\n\t// years\n\ty(date, length) {\n\t\tlet y = date.getFullYear();\n\t\tif (length === 2) {\n\t\t\ty %= 100;\n\t\t}\n\n\t\treturn pad(y, length);\n\t},\n\n\t// months\n\tM(date, length, { monthsLong, monthsShort }) {\n\t\tconst m = date.getMonth();\n\t\tswitch (length) {\n\t\t\tcase 1:\n\t\t\tcase 2:\n\t\t\t\treturn pad(m + 1, length);\n\n\t\t\tcase 3:\n\t\t\t\tassertConfigured(monthsShort);\n\t\t\t\treturn monthsShort[m];\n\n\t\t\tcase 4:\n\t\t\t\tassertConfigured(monthsLong);\n\t\t\t\treturn monthsLong[m];\n\n\t\t\tdefault:\n\t\t\t\tthrow notSupported();\n\t\t}\n\t},\n\n\t// days, weekdays\n\td(date, length) {\n\t\treturn pad(date.getDate(), length);\n\t},\n\tE(date, length, { weekdaysLong, weekdaysShort }) {\n\t\tconst e = date.getDay();\n\t\tswitch (length) {\n\t\t\tcase 1:\n\t\t\tcase 2:\n\t\t\tcase 3:\n\t\t\t\tassertConfigured(weekdaysShort);\n\t\t\t\treturn weekdaysShort[e];\n\n\t\t\tcase 4:\n\t\t\t\tassertConfigured(weekdaysLong);\n\t\t\t\treturn weekdaysLong[e];\n\n\t\t\tdefault:\n\t\t\t\tthrow notSupported();\n\t\t}\n\t},\n\n\t// period\n\ta(date, _length, { dayPeriod }) {\n\t\tassertConfigured(dayPeriod);\n\t\treturn dayPeriod[date.getHours() >= 12 ? 1 : 0];\n\t},\n\n\t// hours\n\th(date, length) {\n\t\tconst h = date.getHours() % 12;\n\t\treturn pad(h === 0 ? 12 : h, length);\n\t},\n\tH(date, length) {\n\t\treturn pad(date.getHours(), length);\n\t},\n\n\t// minutes\n\tm(date, length) {\n\t\treturn pad(date.getMinutes(), length);\n\t},\n\n\t// seconds\n\ts(date, length) {\n\t\treturn pad(date.getSeconds(), length);\n\t},\n\n\t// timezone offset\n\tX(date, length) {\n\t\tconst z = date.getTimezoneOffset();\n\t\tif (z === 0) {\n\t\t\treturn 'Z';\n\t\t}\n\n\t\tconst h = Math.floor(Math.abs(z) / 60);\n\t\tconst m = Math.abs(z) % 60;\n\t\treturn (\n\t\t\t(z < 0 ? '-' : '+') +\n\t\t\tpad(h) +\n\t\t\t(m !== 0 || length > 1 ? (length > 2 ? ':' : '') + pad(m) : '')\n\t\t);\n\t}\n};\n\nfunction assertConfigured<T>(value: T | null | undefined): asserts value is T {\n\tif (value === null || value === undefined) {\n\t\tthrow new IntlError(\n\t\t\tIntlError.FORMAT_UNAVAILABLE,\n\t\t\t'Cannot use some DateTime formats; Required translations are missing.'\n\t\t);\n\t}\n}\n\nfunction notSupported() {\n\treturn new IntlError(\n\t\tIntlError.FORMAT_UNAVAILABLE,\n\t\t'DateTime format not supported.'\n\t);\n}\n\nfunction pad(n: number, length = 2) {\n\treturn ('' + n).padStart(length, '0');\n}\n\nfunction formatDateTime(sequence: readonly (PartFormatter | number | string)[], value: unknown, translations: DateTimeTranslations) {\n\tlet date: Date;\n\tswitch (typeof value) {\n\t\tcase 'number':\n\t\tcase 'string':\n\t\t\tdate = new Date(value);\n\t\t\tbreak;\n\n\t\tcase 'object':\n\t\t\tif (value !== null && value instanceof Date) {\n\t\t\t\tdate = value;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// fall through otherwise\n\n\t\tdefault:\n\t\t\tthrow new IntlError(IntlError.INVALID_PARAMETER, 'invalid date');\n\t}\n\n\tlet result = '';\n\tlet part;\n\tlet i = 0;\n\n\twhile (i < sequence.length) {\n\t\tpart = sequence[i++];\n\t\tresult += typeof part === 'function' ? part(date, sequence[i++] as number, translations) : part;\n\t}\n\n\treturn result;\n}\n\nconst CC_QUOTE = 39;\nconst CC_UCA = 65;\nconst CC_UCZ = 90;\nconst CC_LCA = 97;\nconst CC_LCZ = 122;\n\nexport function parseDateTimeFormat(pattern: string): DateTimeFormatter {\n\tconst sequence: (PartFormatter | number | string)[] = [];\n\tconst { length } = pattern;\n\tif (length === 0) {\n\t\treturn () => '';\n\t}\n\n\tlet index = 0;\n\tlet anchor = 0;\n\tlet isEscaped = false;\n\tlet cc = pattern.charCodeAt(0);\n\n\tconst addLiteral = (str: string) => {\n\t\tconst i = sequence.length - 1;\n\t\tif (i >= 0 && typeof sequence[i] === 'string') {\n\t\t\tsequence[i] += str;\n\t\t}\n\t\telse {\n\t\t\tsequence.push(str);\n\t\t}\n\t};\n\n\tconst commit = () => {\n\t\tconst part = pattern.slice(anchor, index);\n\t\tif (isEscaped) {\n\t\t\taddLiteral(part || '\\'');\n\t\t}\n\t\telse if ((cc >= CC_UCA && cc <= CC_UCZ) || (cc >= CC_LCA && cc <= CC_LCZ)) {\n\t\t\tconst formatter = PARTS[part[0]];\n\t\t\tif (formatter) {\n\t\t\t\tsequence.push(formatter, part.length);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\taddLiteral(part);\n\t\t}\n\n\t\tanchor = index;\n\t};\n\n\twhile (index < length) {\n\t\tconst next = pattern.charCodeAt(index);\n\t\tif (next === CC_QUOTE) {\n\t\t\tcommit();\n\n\t\t\tif (pattern.charCodeAt(index + 1) === CC_QUOTE) {\n\t\t\t\taddLiteral('\\'');\n\t\t\t\tanchor += 2;\n\t\t\t\t++index;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tisEscaped = !isEscaped;\n\t\t\t\t++anchor;\n\t\t\t}\n\t\t}\n\t\telse if (!isEscaped && next !== cc) {\n\t\t\tcommit();\n\t\t}\n\n\t\tcc = next;\n\t\t++index;\n\t}\n\n\tcommit();\n\treturn formatDateTime.bind(null, sequence);\n}\n","import { IntlError } from '~/IntlError';\nimport type { Format } from '~/types';\nimport { mapObjectValuesNotNull } from '~/utils/mapping';\nimport { expand } from '~/utils/placeholder';\nimport { assertIdentifier, assertParamsValid } from '~/utils/validation';\n\nimport { parseDateTimeFormat } from './parser';\nimport { DateTimeFormatter, DateTimeTranslations } from './types';\n\nconst paramTypes = [ assertIdentifier ] as const;\n\nexport interface TimeFormatConfig extends DateTimeTranslations {\n\t/**\n\t * Any formats (e.g. 'long', 'short') used within translation phrases must\n\t * be defined here.\n\t */\n\tformats: Record<string, string>;\n}\n\nexport const DateTimeFormat: Format<TimeFormatConfig> = config => {\n\tconst formats: Record<string, DateTimeFormatter | undefined> = mapObjectValuesNotNull(config.formats, parseDateTimeFormat);\n\treturn placeholder => {\n\t\tassertParamsValid(placeholder, paramTypes);\n\n\t\tconst format = formats[placeholder[2]];\n\t\tif (!format) {\n\t\t\tthrow new IntlError(\n\t\t\t\tIntlError.INVALID_PARAMETER,\n\t\t\t\t`DateTime format '${placeholder[2]}' is not configured.`\n\t\t\t);\n\t\t}\n\n\t\treturn vars => format(expand(placeholder, vars), config);\n\t};\n};\n","import { IntlError } from '~/IntlError';\nimport type { Format, PlaceholderExpansion } from '~/types';\nimport { expand, getFormatName } from '~/utils/placeholder';\nimport { assertMessages, assertParamsValid } from '~/utils/validation';\n\nconst paramTypes = [ assertMessages ] as const;\n\nexport const SelectFormat: Format = () => (placeholder, interpreter) => {\n\tassertParamsValid(placeholder, paramTypes);\n\n\tconst optionsAST = placeholder[2];\n\tif (!optionsAST.other) {\n\t\tthrow new IntlError(\n\t\t\tIntlError.INVALID_PARAMETER,\n\t\t\t`messages of format '${getFormatName(placeholder)}' must contain the key 'other'`\n\t\t);\n\t}\n\n\tconst options: Record<string, PlaceholderExpansion | undefined> = {};\n\tfor (const key in optionsAST) {\n\t\toptions[key] = interpreter.interpret(optionsAST[key]!);\n\t}\n\n\treturn vars => (options[expand(placeholder, vars)] ?? options.other!)(vars);\n};\n","import type { Format } from '~/types';\nimport { expand } from '~/utils/placeholder';\nimport { assertParamsValid } from '~/utils/validation';\n\nconst paramTypes = [] as const;\n\nexport const VariableFormat: Format = () => placeholder => {\n\tassertParamsValid(placeholder, paramTypes);\n\treturn vars => expand(placeholder, vars);\n};\n","import { DateTimeFormat } from './DateTimeFormat/DateTimeFormat';\nimport { SelectFormat } from './SelectFormat';\nimport { VariableFormat } from './VariableFormat';\n\nexport * from './DateTimeFormat/DateTimeFormat';\nexport * from './SelectFormat';\nexport * from './VariableFormat';\n\nexport const BUILTIN_FORMATS = {\n\tselect: SelectFormat,\n\tvariable: VariableFormat,\n\tdate: DateTimeFormat,\n\ttime: DateTimeFormat\n};\n","import { IntlError } from '~/IntlError';\n\nexport class ParseError extends IntlError {\n\tpublic constructor(\n\t\tmessage: string,\n\t\tpublic readonly input: string,\n\t\tpublic readonly at: number\n\t) {\n\t\tsuper(IntlError.PARSE_ERROR, message);\n\t}\n\n\tpublic toString() {\n\t\tconst trimStart = Math.max(this.input.lastIndexOf('\\n', this.at - 1), 0) + 1;\n\n\t\tlet trimEnd = this.input.indexOf('\\n', this.at + 1);\n\t\tif (trimEnd === -1) {\n\t\t\ttrimEnd = this.input.length;\n\t\t}\n\t\telse if (this.input[trimEnd - 1] === '\\r') {\n\t\t\t// prevent slicing through CRLF pairs\n\t\t\t--trimEnd;\n\t\t}\n\n\t\tconst snippet = `${this.input.slice(trimStart, trimEnd)}\\n${' '.repeat(this.at - trimStart)}^`;\n\t\treturn `${this.message} at pos ${this.at}:\\n\\n${snippet}\\n\\n${this.stack}`;\n\t}\n}\n","/* eslint-disable max-depth */\nimport { ParseError } from './ParseError';\n\nexport interface Messages {\n\t[name: string]: AST | undefined;\n}\n\nexport interface Attributes {\n\t[name: string]: string | undefined;\n}\n\nexport type Placeholder = [ varName: string, formatName?: string, ...params: (string | Messages | Attributes)[] ];\nexport type Element = string | Placeholder;\nexport type AST = Element[];\n\nconst C_ATTRIBUTE = ':';\nconst C_ESCAPE = \"'\";\nconst C_OCTOTHORPE = '#';\nconst C_PLACEHOLDER_OPEN = '{';\nconst C_PLACEHOLDER_CLOSE = '}';\nconst C_SEPARATOR = ',';\n\nfunction isWhitespace(code: number) {\n\treturn (\n\t\tcode === 0x20 ||\n\t\t(code >= 0x09 && code <= 0x0D) ||\n\t\tcode === 0x85 ||\n\t\tcode === 0xA0 ||\n\t\tcode === 0x180E ||\n\t\t(code >= 0x2000 && code <= 0x200D) ||\n\t\tcode === 0x2028 ||\n\t\tcode === 0x2029 ||\n\t\tcode === 0x202F ||\n\t\tcode === 0x205F ||\n\t\tcode === 0x2060 ||\n\t\tcode === 0x3000 ||\n\t\tcode === 0xFEFF\n\t);\n}\n\nfunction skipWhitespace(input: string, offset: number) {\n\tconst { length } = input;\n\n\tlet index = offset;\n\twhile (index < length && isWhitespace(input.charCodeAt(index))) {\n\t\t++index;\n\t}\n\n\treturn index;\n}\n\nfunction parseIdentifier(input: string, offset: number) {\n\tconst { length } = input;\n\n\tlet index = offset;\n\tlet char;\n\n\twhile (index < length) {\n\t\tchar = input[index];\n\t\tif (\n\t\t\tchar === C_PLACEHOLDER_OPEN ||\n\t\t\tchar === C_PLACEHOLDER_CLOSE ||\n\t\t\tchar === C_SEPARATOR ||\n\t\t\tchar === C_OCTOTHORPE ||\n\t\t\tchar === C_ESCAPE ||\n\t\t\tchar === C_ATTRIBUTE ||\n\t\t\tisWhitespace(char.charCodeAt(0))\n\t\t) {\n\t\t\tbreak;\n\t\t}\n\n\t\t++index;\n\t}\n\n\tif (offset === index) {\n\t\tthrow new ParseError(`expected an identifier but ${char ? `saw '${char}'` : 'saw the end of pattern'} instead`, input, offset);\n\t}\n\n\treturn input.slice(offset, index);\n}\n\nfunction parseText(input: string, offset: number, isWithinPlaceholder: boolean) {\n\tconst { length } = input;\n\n\tlet anchor = offset;\n\tlet index = offset;\n\tlet char;\n\tlet text = '';\n\n\twhile (index < length) {\n\t\tchar = input[index];\n\t\tif (\n\t\t\tchar === C_PLACEHOLDER_OPEN ||\n\t\t\tchar === C_PLACEHOLDER_CLOSE ||\n\t\t\t(isWithinPlaceholder && char === C_OCTOTHORPE)\n\t\t) {\n\t\t\tbreak;\n\t\t}\n\n\t\tif (char === C_ESCAPE) {\n\t\t\tchar = input[++index];\n\n\t\t\t// double escape is always transformed into a single char\n\t\t\tif (char === C_ESCAPE) {\n\t\t\t\ttext += input.slice(anchor, index);\n\t\t\t\tanchor = index + 1;\n\t\t\t}\n\n\t\t\t// an escape sequence is only started when directly followed by a special\n\t\t\telse if (\n\t\t\t\tchar === C_PLACEHOLDER_OPEN ||\n\t\t\t\tchar === C_PLACEHOLDER_CLOSE ||\n\t\t\t\t(isWithinPlaceholder && char === C_OCTOTHORPE)\n\t\t\t) {\n\t\t\t\ttext += input.slice(anchor, index - 1);\n\t\t\t\tanchor = index;\n\n\t\t\t\twhile (++index < length) {\n\t\t\t\t\tchar = input[index];\n\t\t\t\t\tif (char === C_ESCAPE) {\n\t\t\t\t\t\tchar = input[index + 1];\n\t\t\t\t\t\tif (char === C_ESCAPE) {\n\t\t\t\t\t\t\ttext += input.slice(anchor, ++index);\n\t\t\t\t\t\t\tanchor = index + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttext += input.slice(anchor, index);\n\t\t\t\tanchor = ++index;\n\t\t\t}\n\t\t}\n\n\t\t++index;\n\t}\n\n\ttext += input.slice(anchor, index);\n\treturn text;\n}\n\nfunction parseMessages(input: string, offset: number, placeholder: Placeholder, firstKey: string) {\n\tconst { length } = input;\n\tconst messages: Messages = {};\n\tplaceholder.push(messages);\n\n\tlet key = firstKey;\n\tlet char;\n\tlet ast: AST = [];\n\tlet index = parseAST(input, offset, ast, true);\n\tmessages[key] = ast;\n\n\twhile (index < length) {\n\t\tindex = skipWhitespace(input, index);\n\t\tchar = input[index];\n\t\tif (char === C_SEPARATOR || char === C_PLACEHOLDER_CLOSE) {\n\t\t\tbreak;\n\t\t}\n\n\t\tkey = parseIdentifier(input, index);\n\t\tindex = skipWhitespace(input, index + key.length);\n\n\t\tchar = input[index];\n\t\tif (char !== C_PLACEHOLDER_OPEN) {\n\t\t\tthrow new ParseError(`expected '${C_PLACEHOLDER_OPEN}'`, input, index);\n\t\t}\n\n\t\tast = [];\n\t\tindex = parseAST(input, index + 1, ast, true);\n\t\tmessages[key] = ast;\n\t}\n\n\treturn index;\n}\n\nfunction parseMessagesWithAttributes(input: string, offset: number, placeholder: Placeholder, firstKey: string) {\n\tconst { length } = input;\n\tconst attributes: Attributes = {};\n\tplaceholder.push(attributes);\n\n\tlet key = firstKey;\n\tlet char;\n\tlet index = skipWhitespace(input, offset);\n\tlet value = parseIdentifier(input, index);\n\tindex += value.length;\n\tattributes[key] = value;\n\n\twhile (index < length) {\n\t\tindex = skipWhitespace(input, index);\n\t\tchar = input[index];\n\t\tif (char === C_SEPARATOR || char === C_PLACEHOLDER_CLOSE) {\n\t\t\tbreak;\n\t\t}\n\n\t\tkey = parseIdentifier(input, index);\n\t\tindex = skipWhitespace(input, index + key.length);\n\n\t\tchar = input[index];\n\t\tif (char === C_PLACEHOLDER_OPEN) {\n\t\t\treturn parseMessages(input, index + 1, placeholder, key);\n\t\t}\n\n\t\tif (char !== C_ATTRIBUTE) {\n\t\t\tthrow new ParseError(`expected '${C_ATTRIBUTE}' or '${C_PLACEHOLDER_OPEN}'`, input, index);\n\t\t}\n\n\t\tindex = skipWhitespace(input, index + 1);\n\t\tvalue = parseIdentifier(input, index);\n\t\tindex += value.length;\n\n\t\tattributes[key] = value;\n\t}\n\n\treturn index;\n}\n\nfunction parsePlaceholder(input: string, offset: number, placeholder: Placeholder) {\n\tlet index = offset;\n\tlet char = input[index];\n\n\tif (char === C_OCTOTHORPE) {\n\t\tplaceholder.push('#');\n\t\treturn index + 1;\n\t}\n\n\tif (char !== C_PLACEHOLDER_OPEN) {\n\t\tthrow new ParseError(`expected '${C_OCTOTHORPE}' or '${C_PLACEHOLDER_OPEN}'`, input, index);\n\t}\n\n\tconst { length } = input;\n\n\tdo {\n\t\tindex = skipWhitespace(input, index + 1);\n\t\tconst id = parseIdentifier(input, index);\n\t\tindex = skipWhitespace(input, index + id.length);\n\n\t\tchar = input[index];\n\t\tswitch (char) {\n\t\t\tcase C_SEPARATOR:\n\t\t\tcase C_PLACEHOLDER_CLOSE:\n\t\t\t\tplaceholder.push(id);\n\t\t\t\tbreak;\n\n\t\t\tcase C_PLACEHOLDER_OPEN:\n\t\t\t\tif (placeholder.length < 2) {\n\t\t\t\t\tthrow new ParseError('expected an identifier but saw a message instead', input, index);\n\t\t\t\t}\n\n\t\t\t\tindex = parseMessages(input, index + 1, placeholder, id);\n\t\t\t\tchar = input[index];\n\t\t\t\tbreak;\n\n\t\t\tcase C_ATTRIBUTE:\n\t\t\t\tif (placeholder.length < 2) {\n\t\t\t\t\tthrow new ParseError('expected an identifier but saw an attribute instead', input, index);\n\t\t\t\t}\n\n\t\t\t\tindex = parseMessagesWithAttributes(input, index + 1, placeholder, id);\n\t\t\t\tchar = input[index];\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new ParseError(`unexpected character '${char}'`, input, index);\n\t\t}\n\t}\n\twhile (index < length && char !== C_PLACEHOLDER_CLOSE);\n\n\treturn index + 1;\n}\n\nfunction parseAST(input: string, offset: number, ast: AST, isWithinPlaceholder: boolean) {\n\tlet char;\n\tlet index = offset;\n\tlet text = parseText(input, index, isWithinPlaceholder);\n\n\tif (text) {\n\t\tast.push(text);\n\t\tindex += text.length;\n\t}\n\n\tconst { length } = input;\n\twhile (index < length) {\n\t\tchar = input[index];\n\t\tif (char === C_PLACEHOLDER_CLOSE) {\n\t\t\tif (!isWithinPlaceholder) {\n\t\t\t\tthrow new ParseError(`unexpected '${C_PLACEHOLDER_CLOSE}'`, input, index);\n\t\t\t}\n\n\t\t\t++index;\n\t\t\tbreak;\n\t\t}\n\n\t\tconst placeholder: any = [];\n\t\tindex = parsePlaceholder(input, index, placeholder);\n\t\tast.push(placeholder);\n\n\t\ttext = parseText(input, index, isWithinPlaceholder);\n\t\tif (text) {\n\t\t\tast.push(text);\n\t\t\tindex += text.length;\n\t\t}\n\t}\n\n\treturn index;\n}\n\nexport function parse(input: string) {\n\tconst ast: AST = [];\n\tparseAST(input, 0, ast, false);\n\treturn ast;\n}\n","import type { AST, Element } from './parser/parser';\nimport type { FormatProvider, Interpreter, Vars, PlaceholderExpansion } from './types';\n\nexport class DefaultInterpreter implements Interpreter {\n\tpublic constructor(\n\t\tprivate readonly formatProvider: FormatProvider\n\t) {}\n\n\tpublic interpret(ast: AST, octothorpeParam?: string): PlaceholderExpansion {\n\t\tconst { length } = ast;\n\t\tif (length === 1) {\n\t\t\treturn this.interpretElement(ast[0], octothorpeParam);\n\t\t}\n\n\t\tconst placeholders = new Array<PlaceholderExpansion>(length);\n\t\tfor (let i = 0; i < length; ++i) {\n\t\t\tplaceholders[i] = this.interpretElement(ast[i], octothorpeParam);\n\t\t}\n\n\t\treturn formatAndJoin.bind(null, placeholders);\n\t}\n\n\tprivate interpretElement(element: Element, octothorpeParam?: string) {\n\t\tif (typeof element === 'string') {\n\t\t\treturn () => element;\n\t\t}\n\n\t\tlet placeholder = element;\n\t\tif (placeholder.length === 1 && placeholder[0] === '#') {\n\t\t\tif (octothorpeParam === undefined) {\n\t\t\t\treturn () => '#';\n\t\t\t}\n\n\t\t\tplaceholder = [ octothorpeParam ];\n\t\t}\n\n\t\treturn this.formatProvider.getFormat(placeholder)(placeholder, this);\n\t}\n}\n\nfunction formatAndJoin(placeholders: readonly PlaceholderExpansion[], vars?: Vars) {\n\tlet str = '';\n\tfor (let i = 0; i < placeholders.length; ++i) {\n\t\tstr += placeholders[i](vars);\n\t}\n\n\treturn str;\n}\n","import { IntlError } from './IntlError';\nimport type { Placeholder } from './parser/parser';\nimport type { FormatCallback, FormatProvider } from './types';\nimport { getFormatName } from './utils/placeholder';\n\nexport class MappedFormatProvider implements FormatProvider {\n\tpublic constructor(\n\t\tprivate readonly formatMap: Record<string, FormatCallback | undefined>\n\t) {}\n\n\tpublic getFormat(placeholder: Placeholder): FormatCallback {\n\t\tconst name = getFormatName(placeholder);\n\t\tconst format = this.formatMap[name];\n\t\tif (!format) {\n\t\t\tthrow new IntlError(IntlError.FORMAT_UNAVAILABLE, name);\n\t\t}\n\n\t\treturn format;\n\t}\n}\n","import { DefaultInterpreter } from './DefaultInterpreter';\nimport { BUILTIN_FORMATS } from './format';\nimport { IntlError } from './IntlError';\nimport { MappedFormatProvider } from './MappedFormatProvider';\nimport { parse } from './parser/parser';\nimport type { Format, Interpreter, Locale, PlaceholderExpansion, TranslationMap, TranslationProvider, Vars } from './types';\nimport { flattenTranslationMap, mapObjectValuesNotNull } from './utils/mapping';\n\nexport enum CacheMode {\n\t/**\n\t * All phrases are interpreted and cached immediately upon construction.\n\t *\n\t * Useful to detect any syntax errors right away and avoid parsing during\n\t * app runtime.\n\t */\n\tEager,\n\n\t/**\n\t * Phrases are interpreted on-demand, then cached. This is a balanced\n\t * compromise between the `Eager` and `Off` suitable for most apps.\n\t *\n\t * This is the default mode.\n\t */\n\tLazy,\n\n\t/**\n\t * Each time a translation is requested, it is (re-)interpreted; No caching\n\t * takes place.\n\t *\n\t * Useful to lower memory usage when individual phrases are only used\n\t * scarcely.\n\t */\n\tOff\n}\n\nexport interface CachedTranslationProviderArgs {\n\tcacheMode?: CacheMode;\n\tinterpreter: Interpreter;\n\ttranslations: TranslationMap;\n}\n\nexport class CachedTranslationProvider implements TranslationProvider {\n\tprivate readonly cacheMode: CacheMode;\n\tprivate readonly expansions: Record<string, PlaceholderExpansion | string | undefined>;\n\tprivate readonly interpreter: Interpreter;\n\n\tpublic constructor({ cacheMode, interpreter, translations }: CachedTranslationProviderArgs) {\n\t\tthis.cacheMode = cacheMode ?? CacheMode.Lazy;\n\t\tthis.interpreter = interpreter;\n\t\tthis.expansions = flattenTranslationMap(translations);\n\n\t\tif (cacheMode === CacheMode.Eager) {\n\t\t\tthis.expansions = mapObjectValuesNotNull(this.expansions, phrase => interpreter.interpret(parse(phrase as string)));\n\t\t}\n\t}\n\n\tpublic expand(key: string, vars?: Vars) {\n\t\tlet expand = this.expansions[key];\n\t\tif (expand === undefined) {\n\t\t\tthrow new IntlError(IntlError.KEY_NOT_FOUND, key);\n\t\t}\n\n\t\tif (typeof expand === 'string') {\n\t\t\texpand = this.interpreter.interpret(parse(expand));\n\t\t\tif (this.cacheMode !== CacheMode.Off) {\n\t\t\t\tthis.expansions[key] = expand;\n\t\t\t}\n\t\t}\n\n\t\treturn expand(vars);\n\t}\n\n\tpublic static fromLocale(locale: Locale, formats: Record<string, Format<any>> = BUILTIN_FORMATS) {\n\t\tconst formatMap = mapObjectValuesNotNull(formats, (factory, formatName) => {\n\t\t\tconst config = locale.$format?.[formatName];\n\t\t\tif (!config && factory.length > 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn factory(locale.$format?.[formatName]);\n\t\t});\n\n\t\tconst formatProvider = new MappedFormatProvider(formatMap);\n\t\treturn new CachedTranslationProvider({\n\t\t\tcacheMode: CacheMode.Lazy,\n\t\t\tinterpreter: new DefaultInterpreter(formatProvider),\n\t\t\ttranslations: locale\n\t\t});\n\t}\n}\n","import { options } from 'preact';\n\n/** @type {number} */\nlet currentIndex;\n\n/** @type {import('./internal').Component} */\nlet currentComponent;\n\n/** @type {import('./internal').Component} */\nlet previousComponent;\n\n/** @type {number} */\nlet currentHook = 0;\n\n/** @type {Array<import('./internal').Component>} */\nlet afterPaintEffects = [];\n\nlet EMPTY = [];\n\nlet oldBeforeDiff = options._diff;\nlet oldBeforeRender = options._render;\nlet oldAfterDiff = options.diffed;\nlet oldCommit = options._commit;\nlet oldBeforeUnmount = options.unmount;\n\nconst RAF_TIMEOUT = 100;\nlet prevRaf;\n\noptions._diff = vnode => {\n\tcurrentComponent = null;\n\tif (oldBeforeDiff) oldBeforeDiff(vnode);\n};\n\noptions._render = vnode => {\n\tif (oldBeforeRender) oldBeforeRender(vnode);\n\n\tcurrentComponent = vnode._component;\n\tcurrentIndex = 0;\n\n\tconst hooks = currentComponent.__hooks;\n\tif (hooks) {\n\t\tif (previousComponent === currentComponent) {\n\t\t\thooks._pendingEffects = [];\n\t\t\tcurrentComponent._renderCallbacks = [];\n\t\t\thooks._list.forEach(hookItem => {\n\t\t\t\tif (hookItem._nextValue) {\n\t\t\t\t\thookItem._value = hookItem._nextValue;\n\t\t\t\t}\n\t\t\t\thookItem._pendingValue = EMPTY;\n\t\t\t\thookItem._nextValue = hookItem._pendingArgs = undefined;\n\t\t\t});\n\t\t} else {\n\t\t\thooks._pendingEffects.forEach(invokeCleanup);\n\t\t\thooks._pendingEffects.forEach(invokeEffect);\n\t\t\thooks._pendingEffects = [];\n\t\t}\n\t}\n\tpreviousComponent = currentComponent;\n};\n\noptions.diffed = vnode => {\n\tif (oldAfterDiff) oldAfterDiff(vnode);\n\n\tconst c = vnode._component;\n\tif (c && c.__hooks) {\n\t\tif (c.__hooks._pendingEffects.length) afterPaint(afterPaintEffects.push(c));\n\t\tc.__hooks._list.forEach(hookItem => {\n\t\t\tif (hookItem._pendingArgs) {\n\t\t\t\thookItem._args = hookItem._pendingArgs;\n\t\t\t}\n\t\t\tif (hookItem._pendingValue !== EMPTY) {\n\t\t\t\thookItem._value = hookItem._pendingValue;\n\t\t\t}\n\t\t\thookItem._pendingArgs = undefined;\n\t\t\thookItem._pendingValue = EMPTY;\n\t\t});\n\t}\n\tpreviousComponent = currentComponent = null;\n};\n\noptions._commit = (vnode, commitQueue) => {\n\tcommitQueue.some(component => {\n\t\ttry {\n\t\t\tcomponent._renderCallbacks.forEach(invokeCleanup);\n\t\t\tcomponent._renderCallbacks = component._renderCallbacks.filter(cb =>\n\t\t\t\tcb._value ? invokeEffect(cb) : true\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tcommitQueue.some(c => {\n\t\t\t\tif (c._renderCallbacks) c._renderCallbacks = [];\n\t\t\t});\n\t\t\tcommitQueue = [];\n\t\t\toptions._catchError(e, component._vnode);\n\t\t}\n\t});\n\n\tif (oldCommit) oldCommit(vnode, commitQueue);\n};\n\noptions.unmount = vnode => {\n\tif (oldBeforeUnmount) oldBeforeUnmount(vnode);\n\n\tconst c = vnode._component;\n\tif (c && c.__hooks) {\n\t\tlet hasErrored;\n\t\tc.__hooks._list.forEach(s => {\n\t\t\ttry {\n\t\t\t\tinvokeCleanup(s);\n\t\t\t} catch (e) {\n\t\t\t\thasErrored = e;\n\t\t\t}\n\t\t});\n\t\tc.__hooks = undefined;\n\t\tif (hasErrored) options._catchError(hasErrored, c._vnode);\n\t}\n};\n\n/**\n * Get a hook's state from the currentComponent\n * @param {number} index The index of the hook to get\n * @param {number} type The index of the hook to get\n * @returns {any}\n */\nfunction getHookState(index, type) {\n\tif (options._hook) {\n\t\toptions._hook(currentComponent, index, currentHook || type);\n\t}\n\tcurrentHook = 0;\n\n\t// Largely inspired by:\n\t// * https://github.com/michael-klein/funcy.js/blob/f6be73468e6ec46b0ff5aa3cc4c9baf72a29025a/src/hooks/core_hooks.mjs\n\t// * https://github.com/michael-klein/funcy.js/blob/650beaa58c43c33a74820a3c98b3c7079cf2e333/src/renderer.mjs\n\t// Other implementations to look at:\n\t// * https://codesandbox.io/s/mnox05qp8\n\tconst hooks =\n\t\tcurrentComponent.__hooks ||\n\t\t(currentComponent.__hooks = {\n\t\t\t_list: [],\n\t\t\t_pendingEffects: []\n\t\t});\n\n\tif (index >= hooks._list.length) {\n\t\thooks._list.push({ _pendingValue: EMPTY });\n\t}\n\treturn hooks._list[index];\n}\n\n/**\n * @param {import('./index').StateUpdater<any>} [initialState]\n */\nexport function useState(initialState) {\n\tcurrentHook = 1;\n\treturn useReducer(invokeOrReturn, initialState);\n}\n\n/**\n * @param {import('./index').Reducer<any, any>} reducer\n * @param {import('./index').StateUpdater<any>} initialState\n * @param {(initialState: any) => void} [init]\n * @returns {[ any, (state: any) => void ]}\n */\nexport function useReducer(reducer, initialState, init) {\n\t/** @type {import('./internal').ReducerHookState} */\n\tconst hookState = getHookState(currentIndex++, 2);\n\thookState._reducer = reducer;\n\tif (!hookState._component) {\n\t\thookState._value = [\n\t\t\t!init ? invokeOrReturn(undefined, initialState) : init(initialState),\n\n\t\t\taction => {\n\t\t\t\tconst currentValue = hookState._nextValue\n\t\t\t\t\t? hookState._nextValue[0]\n\t\t\t\t\t: hookState._value[0];\n\t\t\t\tconst nextValue = hookState._reducer(currentValue, action);\n\n\t\t\t\tif (currentValue !== nextValue) {\n\t\t\t\t\thookState._nextValue = [nextValue, hookState._value[1]];\n\t\t\t\t\thookState._component.setState({});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\thookState._component = currentComponent;\n\n\t\tif (!currentComponent._hasScuFromHooks) {\n\t\t\tcurrentComponent._hasScuFromHooks = true;\n\t\t\tconst prevScu = currentComponent.shouldComponentUpdate;\n\n\t\t\t// This SCU has the purpose of bailing out after repeated updates\n\t\t\t// to stateful hooks.\n\t\t\t// we store the next value in _nextValue[0] and keep doing that for all\n\t\t\t// state setters, if we have next states and\n\t\t\t// all next states within a component end up being equal to their original state\n\t\t\t// we are safe to bail out for this specific component.\n\t\t\tcurrentComponent.shouldComponentUpdate = function(p, s, c) {\n\t\t\t\tif (!hookState._component.__hooks) return true;\n\n\t\t\t\tconst stateHooks = hookState._component.__hooks._list.filter(\n\t\t\t\t\tx => x._component\n\t\t\t\t);\n\t\t\t\tconst allHooksEmpty = stateHooks.every(x => !x._nextValue);\n\t\t\t\t// When we have no updated hooks in the component we invoke the previous SCU or\n\t\t\t\t// traverse the VDOM tree further.\n\t\t\t\tif (allHooksEmpty) {\n\t\t\t\t\treturn prevScu ? prevScu.call(this, p, s, c) : true;\n\t\t\t\t}\n\n\t\t\t\t// We check whether we have components with a nextValue set that\n\t\t\t\t// have values that aren't equal to one another this pushes\n\t\t\t\t// us to update further down the tree\n\t\t\t\tlet shouldUpdate = false;\n\t\t\t\tstateHooks.forEach(hookItem => {\n\t\t\t\t\tif (hookItem._nextValue) {\n\t\t\t\t\t\tconst currentValue = hookItem._value[0];\n\t\t\t\t\t\thookItem._value = hookItem._nextValue;\n\t\t\t\t\t\thookItem._nextValue = undefined;\n\t\t\t\t\t\tif (currentValue !== hookItem._value[0]) shouldUpdate = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn shouldUpdate || hookState._component.props !== p\n\t\t\t\t\t? prevScu\n\t\t\t\t\t\t? prevScu.call(this, p, s, c)\n\t\t\t\t\t\t: true\n\t\t\t\t\t: false;\n\t\t\t};\n\t\t}\n\t}\n\n\treturn hookState._nextValue || hookState._value;\n}\n\n/**\n * @param {import('./internal').Effect} callback\n * @param {any[]} args\n */\nexport function useEffect(callback, args) {\n\t/** @type {import('./internal').EffectHookState} */\n\tconst state = getHookState(currentIndex++, 3);\n\tif (!options._skipEffects && argsChanged(state._args, args)) {\n\t\tstate._value = callback;\n\t\tstate._pendingArgs = args;\n\n\t\tcurrentComponent.__hooks._pendingEffects.push(state);\n\t}\n}\n\n/**\n * @param {import('./internal').Effect} callback\n * @param {any[]} args\n */\nexport function useLayoutEffect(callback, args) {\n\t/** @type {import('./internal').EffectHookState} */\n\tconst state = getHookState(currentIndex++, 4);\n\tif (!options._skipEffects && argsChanged(state._args, args)) {\n\t\tstate._value = callback;\n\t\tstate._pendingArgs = args;\n\n\t\tcurrentComponent._renderCallbacks.push(state);\n\t}\n}\n\nexport function useRef(initialValue) {\n\tcurrentHook = 5;\n\treturn useMemo(() => ({ current: initialValue }), []);\n}\n\n/**\n * @param {object} ref\n * @param {() => object} createHandle\n * @param {any[]} args\n */\nexport function useImperativeHandle(ref, createHandle, args) {\n\tcurrentHook = 6;\n\tuseLayoutEffect(\n\t\t() => {\n\t\t\tif (typeof ref == 'function') {\n\t\t\t\tref(createHandle());\n\t\t\t\treturn () => ref(null);\n\t\t\t} else if (ref) {\n\t\t\t\tref.current = createHandle();\n\t\t\t\treturn () => (ref.current = null);\n\t\t\t}\n\t\t},\n\t\targs == null ? args : args.concat(ref)\n\t);\n}\n\n/**\n * @param {() => any} factory\n * @param {any[]} args\n */\nexport function useMemo(factory, args) {\n\t/** @type {import('./internal').MemoHookState} */\n\tconst state = getHookState(currentIndex++, 7);\n\tif (argsChanged(state._args, args)) {\n\t\tstate._pendingValue = factory();\n\t\tstate._pendingArgs = args;\n\t\tstate._factory = factory;\n\t\treturn state._pendingValue;\n\t}\n\n\treturn state._value;\n}\n\n/**\n * @param {() => void} callback\n * @param {any[]} args\n */\nexport function useCallback(callback, args) {\n\tcurrentHook = 8;\n\treturn useMemo(() => callback, args);\n}\n\n/**\n * @param {import('./internal').PreactContext} context\n */\nexport function useContext(context) {\n\tconst provider = currentComponent.context[context._id];\n\t// We could skip this call here, but than we'd not call\n\t// `options._hook`. We need to do that in order to make\n\t// the devtools aware of this hook.\n\t/** @type {import('./internal').ContextHookState} */\n\tconst state = getHookState(currentIndex++, 9);\n\t// The devtools needs access to the context object to\n\t// be able to pull of the default value when no provider\n\t// is present in the tree.\n\tstate._context = context;\n\tif (!provider) return context._defaultValue;\n\t// This is probably not safe to convert to \"!\"\n\tif (state._value == null) {\n\t\tstate._value = true;\n\t\tprovider.sub(currentComponent);\n\t}\n\treturn provider.props.value;\n}\n\n/**\n * Display a custom label for a custom hook for the devtools panel\n * @type {<T>(value: T, cb?: (value: T) => string | number) => void}\n */\nexport function useDebugValue(value, formatter) {\n\tif (options.useDebugValue) {\n\t\toptions.useDebugValue(formatter ? formatter(value) : value);\n\t}\n}\n\n/**\n * @param {(error: any, errorInfo: import('preact').ErrorInfo) => void} cb\n */\nexport function useErrorBoundary(cb) {\n\t/** @type {import('./internal').ErrorBoundaryHookState} */\n\tconst state = getHookState(currentIndex++, 10);\n\tconst errState = useState();\n\tstate._value = cb;\n\tif (!currentComponent.componentDidCatch) {\n\t\tcurrentComponent.componentDidCatch = (err, errorInfo) => {\n\t\t\tif (state._value) state._value(err, errorInfo);\n\t\t\terrState[1](err);\n\t\t};\n\t}\n\treturn [\n\t\terrState[0],\n\t\t() => {\n\t\t\terrState[1](undefined);\n\t\t}\n\t];\n}\n\nexport function useId() {\n\tconst state = getHookState(currentIndex++, 11);\n\tif (!state._value) {\n\t\t// Grab either the root node or the nearest async boundary node.\n\t\t/** @type {import('./internal.d').VNode} */\n\t\tlet root = currentComponent._vnode;\n\t\twhile (root !== null && !root._mask && root._parent !== null) {\n\t\t\troot = root._parent;\n\t\t}\n\n\t\tlet mask = root._mask || (root._mask = [0, 0]);\n\t\tstate._value = 'P' + mask[0] + '-' + mask[1]++;\n\t}\n\n\treturn state._value;\n}\n/**\n * After paint effects consumer.\n */\nfunction flushAfterPaintEffects() {\n\tlet component;\n\twhile ((component = afterPaintEffects.shift())) {\n\t\tif (!component._parentDom || !component.__hooks) continue;\n\t\ttry {\n\t\t\tcomponent.__hooks._pendingEffects.forEach(invokeCleanup);\n\t\t\tcomponent.__hooks._pendingEffects.forEach(invokeEffect);\n\t\t\tcomponent.__hooks._pendingEffects = [];\n\t\t} catch (e) {\n\t\t\tcomponent.__hooks._pendingEffects = [];\n\t\t\toptions._catchError(e, component._vnode);\n\t\t}\n\t}\n}\n\nlet HAS_RAF = typeof requestAnimationFrame == 'function';\n\n/**\n * Schedule a callback to be invoked after the browser has a chance to paint a new frame.\n * Do this by combining requestAnimationFrame (rAF) + setTimeout to invoke a callback after\n * the next browser frame.\n *\n * Also, schedule a timeout in parallel to the the rAF to ensure the callback is invoked\n * even if RAF doesn't fire (for example if the browser tab is not visible)\n *\n * @param {() => void} callback\n */\nfunction afterNextFrame(callback) {\n\tconst done = () => {\n\t\tclearTimeout(timeout);\n\t\tif (HAS_RAF) cancelAnimationFrame(raf);\n\t\tsetTimeout(callback);\n\t};\n\tconst timeout = setTimeout(done, RAF_TIMEOUT);\n\n\tlet raf;\n\tif (HAS_RAF) {\n\t\traf = requestAnimationFrame(done);\n\t}\n}\n\n// Note: if someone used options.debounceRendering = requestAnimationFrame,\n// then effects will ALWAYS run on the NEXT frame instead of the current one, incurring a ~16ms delay.\n// Perhaps this is not such a big deal.\n/**\n * Schedule afterPaintEffects flush after the browser paints\n * @param {number} newQueueLength\n */\nfunction afterPaint(newQueueLength) {\n\tif (newQueueLength === 1 || prevRaf !== options.requestAnimationFrame) {\n\t\tprevRaf = options.requestAnimationFrame;\n\t\t(prevRaf || afterNextFrame)(flushAfterPaintEffects);\n\t}\n}\n\n/**\n * @param {import('./internal').EffectHookState} hook\n */\nfunction invokeCleanup(hook) {\n\t// A hook cleanup can introduce a call to render which creates a new root, this will call options.vnode\n\t// and move the currentComponent away.\n\tconst comp = currentComponent;\n\tlet cleanup = hook._cleanup;\n\tif (typeof cleanup == 'function') {\n\t\thook._cleanup = undefined;\n\t\tcleanup();\n\t}\n\n\tcurrentComponent = comp;\n}\n\n/**\n * Invoke a Hook's effect\n * @param {import('./internal').EffectHookState} hook\n */\nfunction invokeEffect(hook) {\n\t// A hook call can introduce a call to render which creates a new root, this will call options.vnode\n\t// and move the currentComponent away.\n\tconst comp = currentComponent;\n\thook._cleanup = hook._value();\n\tcurrentComponent = comp;\n}\n\n/**\n * @param {any[]} oldArgs\n * @param {any[]} newArgs\n */\nfunction argsChanged(oldArgs, newArgs) {\n\treturn (\n\t\t!oldArgs ||\n\t\toldArgs.length !== newArgs.length ||\n\t\tnewArgs.some((arg, index) => arg !== oldArgs[index])\n\t);\n}\n\nfunction invokeOrReturn(arg, f) {\n\treturn typeof f == 'function' ? f(arg) : f;\n}\n","export function formatWarning(message: string) {\n\t// prepend warning emoji\n\treturn '\\u26a0\\ufe0f ' + message;\n}\n","import { ComponentClass, ComponentType, createContext, FunctionComponent, h } from 'preact';\nimport { useContext } from 'preact/hooks';\n\nimport type { Intl } from './types';\nimport { formatWarning } from './utils';\n\nexport const FETCHING_LOCALE_STATE: Intl = {\n\tisLoading: true,\n\tt: () => ''\n};\n\nexport const LOCALE_FETCH_ERROR_STATE: Intl = {\n\tisLoading: false,\n\tt: () => formatWarning('LocaleFetchError')\n};\n\nexport const CONTEXT_MISSING_STATE: Intl = {\n\tisLoading: false,\n\tt: () => formatWarning('IntlContextMissing')\n};\n\nexport const IntlContext = createContext<Intl>(FETCHING_LOCALE_STATE);\n\n// Hook-style consumer:\n\nexport function useIntl(): Intl {\n\treturn useContext(IntlContext);\n}\n\n// HOC-style consumer:\n\nexport interface WithIntlProps {\n\treadonly intl: Intl;\n}\n\nexport function withIntl<TProps extends WithIntlProps>(component: FunctionComponent<TProps>): FunctionComponent<Omit<TProps, 'intl'>>;\nexport function withIntl<TProps extends WithIntlProps>(component: ComponentClass<TProps, any>): FunctionComponent<Omit<TProps, 'intl'>>;\nexport function withIntl(component: ComponentType<any>) {\n\treturn (props: any) => h(\n\t\tcomponent,\n\t\t{\n\t\t\t...props,\n\t\t\tintl: useContext(IntlContext)\n\t\t}\n\t);\n}\n","import { CachedTranslationProvider, Format, IntlError, TranslationProvider, Vars } from '@calmdownval/intl';\nimport { Component, h } from 'preact';\n\nimport { FETCHING_LOCALE_STATE, IntlContext, LOCALE_FETCH_ERROR_STATE } from './IntlContext';\nimport type { Intl, PassThroughPhrase, Phrase } from './types';\nimport { formatWarning } from './utils';\n\nexport interface IntlProviderProps {\n\treadonly fetchCredentials?: RequestInit['credentials'];\n\treadonly fetchHeaders?: RequestInit['headers'];\n\treadonly formats?: Record<string, Format<any>>;\n\treadonly onError?: (ex: Error) => void;\n\treadonly url: string;\n}\n\nexport class IntlProvider extends Component<IntlProviderProps, Intl> {\n\tpublic state = FETCHING_LOCALE_STATE;\n\tprivate pendingFetch?: AbortController;\n\n\tpublic componentDidMount() {\n\t\tvoid this.fetchLocale();\n\t}\n\n\tpublic componentDidUpdate(prev: IntlProviderProps) {\n\t\tconst next = this.props;\n\t\tif (prev.url !== next.url) {\n\t\t\tvoid this.fetchLocale();\n\t\t}\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tthis.pendingFetch?.abort();\n\t}\n\n\tpublic render() {\n\t\treturn h(IntlContext.Provider, {\n\t\t\tchildren: this.props.children,\n\t\t\tvalue: this.state\n\t\t});\n\t}\n\n\tprivate async fetchLocale() {\n\t\ttry {\n\t\t\tthis.setState(FETCHING_LOCALE_STATE);\n\t\t\tthis.pendingFetch = new AbortController();\n\n\t\t\tconst response = await fetch(this.props.url, {\n\t\t\t\tcredentials: this.props.fetchCredentials,\n\t\t\t\theaders: this.props.fetchHeaders,\n\t\t\t\tmethod: 'GET',\n\t\t\t\tsignal: this.pendingFetch.signal\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`unexpected HTTP response ${response.status} - ${response.statusText}`);\n\t\t\t}\n\n\t\t\tconst locale = await response.json();\n\t\t\tconst manager = CachedTranslationProvider.fromLocale(locale, this.props.formats);\n\n\t\t\tthis.setState({\n\t\t\t\tisLoading: false,\n\t\t\t\tt: translate.bind(null, manager)\n\t\t\t});\n\t\t}\n\t\tcatch (ex: any) {\n\t\t\tthis.setState(LOCALE_FETCH_ERROR_STATE);\n\t\t\tthis.props.onError?.(ex);\n\t\t}\n\t\tfinally {\n\t\t\tthis.pendingFetch = undefined;\n\t\t}\n\t}\n}\n\nfunction translate(provider: TranslationProvider, phrase: Phrase | string, varsOrFallbackText?: Vars | string, fallbackText?: string) {\n\tlet key;\n\tlet vars;\n\tlet fallback;\n\n\tif (typeof phrase === 'string') {\n\t\tkey = phrase;\n\t\tif (typeof varsOrFallbackText === 'string') {\n\t\t\tfallback = varsOrFallbackText;\n\t\t}\n\t\telse {\n\t\t\tvars = varsOrFallbackText;\n\t\t\tfallback = fallbackText;\n\t\t}\n\t}\n\telse {\n\t\tif (isPassThrough(phrase)) {\n\t\t\treturn phrase.text;\n\t\t}\n\n\t\tkey = phrase.key;\n\t\tvars = phrase.vars;\n\t\tfallback = phrase.fallbackText;\n\t}\n\n\ttry {\n\t\treturn provider.expand(key, vars);\n\t}\n\tcatch (ex) {\n\t\treturn fallback === undefined\n\t\t\t? formatWarning(IntlError.is(ex) ? ex.message : 'UnknownError')\n\t\t\t: fallback;\n\t}\n}\n\nfunction isPassThrough(phrase: Phrase): phrase is PassThroughPhrase {\n\treturn typeof (phrase as PassThroughPhrase).text === 'string';\n}\n","export function bem(componentName: string, modifiers: Record<string, boolean | null | undefined>) {\n\tlet classNames = componentName;\n\tfor (const modifier in modifiers) {\n\t\tif (modifiers[modifier]) {\n\t\t\tclassNames += ` ${componentName}--${modifier}`;\n\t\t}\n\t}\n\n\treturn classNames;\n}\n\nexport function cx(...classNames: (string | null | undefined)[]): string;\nexport function cx() {\n\tconst { length } = arguments;\n\n\tlet classNames = '';\n\tfor (let arg, i = 0; i < length; ++i) {\n\t\tif ((arg = arguments[i])) {\n\t\t\tclassNames += (classNames && ' ') + arg;\n\t\t}\n\t}\n\n\treturn classNames;\n}\n","import { h } from 'preact';\n\nimport { bem, cx } from '~/utils/style';\n\nimport './Button.css';\n\nexport interface ButtonProps extends h.JSX.HTMLAttributes<HTMLButtonElement> {\n\t// remove SignalLike from typing:\n\treadonly class?: string;\n\treadonly disabled?: boolean;\n\n\t// extras:\n\treadonly selected?: boolean;\n}\n\nexport const Button = (props: ButtonProps) => h(\n\t'button',\n\t{\n\t\t...props,\n\t\t'class': cx(bem('button', {\n\t\t\tdisabled: props.disabled,\n\t\t\tselected: props.selected\n\t\t}), props.class),\n\t\t'type': props.type ?? 'button'\n\t}\n);\n","import { ComponentChild, ComponentChildren, h } from 'preact';\n\nimport { bem, cx } from '~/utils/style';\n\nimport './Menu.css';\n\nexport enum Orientation {\n\tHorizontal = 'horizontal',\n\tVertical = 'vertical'\n}\n\nexport interface MenuItemRenderer<T> {\n\t(item: T, index: number): ComponentChild;\n}\n\nexport interface MenuProps<T> {\n\treadonly class?: string;\n\treadonly footer?: ComponentChildren;\n\treadonly header?: ComponentChildren;\n\treadonly itemRenderer: MenuItemRenderer<T>;\n\treadonly items: readonly T[];\n\treadonly orientation?: Orientation;\n\treadonly uniform?: boolean;\n}\n\nexport const Menu = <T,>({\n\tclass: customClass,\n\tfooter,\n\theader,\n\titemRenderer,\n\titems,\n\torientation = Orientation.Vertical,\n\tuniform = false\n}: MenuProps<T>) => {\n\tconst classes = cx(\n\t\tbem('menu', {\n\t\t\thorizontal: orientation === Orientation.Horizontal,\n\t\t\tvertical: orientation === Orientation.Vertical,\n\t\t\tuniform\n\t\t}),\n\t\tcustomClass\n\t);\n\n\treturn (\n\t\t<div class={classes}>\n\t\t\t{header}\n\t\t\t{items.map(itemRenderer)}\n\t\t\t{footer}\n\t\t</div>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { ComponentType, createContext, Fragment, h } from 'preact';\nimport { useContext, useState } from 'preact/hooks';\n\nimport { Button } from '~/components/Button';\nimport { Menu, Orientation } from '~/components/Menu';\n\nimport './AppRouter.css';\n\nexport interface RouteInfo {\n\treadonly path: string;\n\treadonly content: ComponentType;\n\treadonly visible?: boolean;\n}\n\nexport interface RouterContextType<TParams> {\n\treadonly route: RouteInfo;\n\treadonly params: TParams;\n\tnavigate(path: string, params?: any): void;\n}\n\nconst RouterContext = createContext<RouterContextType<any> | null>(null);\n\nexport function useRouter<TParams = any>(): RouterContextType<TParams> {\n\treturn useContext(RouterContext)!;\n}\n\ninterface CurrentRoute {\n\treadonly route: RouteInfo;\n\treadonly params: any;\n}\n\nexport interface AppRouterProps {\n\treadonly initialPath?: string;\n\treadonly routes: readonly RouteInfo[];\n}\n\nexport const AppRouter = ({ initialPath, routes }: AppRouterProps) => {\n\tconst { t } = useIntl();\n\tconst [ state, setState ] = useState<CurrentRoute>(() => {\n\t\tconst route = initialPath === undefined\n\t\t\t? undefined\n\t\t\t: routes.find(r => r.path === initialPath);\n\n\t\treturn {\n\t\t\troute: route ?? routes[0],\n\t\t\tparams: null\n\t\t};\n\t});\n\n\tconst navigate = (path: string, params?: any) => {\n\t\tconst route = routes.find(r => r.path === path);\n\t\tif (!route) {\n\t\t\tthrow new Error(`No route with path '${path}' exists.`);\n\t\t}\n\n\t\tsetState({\n\t\t\troute,\n\t\t\tparams\n\t\t});\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div class='app-router__content'>\n\t\t\t\t<div class='app-router__container'>\n\t\t\t\t\t<RouterContext.Provider\n\t\t\t\t\t\tvalue={{\n\t\t\t\t\t\t\t...state,\n\t\t\t\t\t\t\tnavigate\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{h(state.route.content, {})}\n\t\t\t\t\t</RouterContext.Provider>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class='app-router__menu'>\n\t\t\t\t<Menu\n\t\t\t\t\tclass='app-router__container'\n\t\t\t\t\torientation={Orientation.Horizontal}\n\t\t\t\t\titems={routes.filter(route => route.visible === true)}\n\t\t\t\t\titemRenderer={({ path }) => (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tkey={path}\n\t\t\t\t\t\t\tselected={path === state.route.path}\n\t\t\t\t\t\t\tchildren={t(`ui.route.${path}`)}\n\t\t\t\t\t\t\tonClick={() => navigate(path)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\tuniform\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</>\n\t);\n};\n","import type { StorageBackend } from './StateStorage';\n\nexport interface LocalStorageBackendArgs {\n\treadonly debounceMs?: number;\n\treadonly key: string;\n\treadonly storage?: Storage;\n}\n\nexport class LocalStorageBackend<T> implements StorageBackend<T> {\n\tprivate readonly debounceMs: number;\n\tprivate readonly key: string;\n\tprivate readonly storage: Storage;\n\tprivate debounceHandle?: number;\n\tprivate isInitialized = false;\n\tprivate state?: T;\n\n\tpublic constructor(args: LocalStorageBackendArgs) {\n\t\tthis.debounceMs = args.debounceMs ?? 100;\n\t\tthis.key = args.key;\n\t\tthis.storage = args.storage ?? window.localStorage;\n\t}\n\n\tpublic get() {\n\t\tif (!this.isInitialized) {\n\t\t\tconst json = this.storage.getItem(this.key);\n\t\t\tif (!json) {\n\t\t\t\tthrow new Error(`key '${this.key}' not found within the storage`);\n\t\t\t}\n\n\t\t\tthis.state = JSON.parse(json);\n\t\t\tthis.isInitialized = true;\n\t\t}\n\n\t\treturn this.state!;\n\t}\n\n\tpublic set(state: any, immediate = false) {\n\t\tif (this.debounceHandle !== undefined) {\n\t\t\tcancelIdleCallback(this.debounceHandle);\n\t\t}\n\n\t\tthis.state = state;\n\t\tconst onSet = () => {\n\t\t\tthis.debounceHandle = undefined;\n\t\t\ttry {\n\t\t\t\tthis.storage.setItem(this.key, JSON.stringify(state));\n\t\t\t\tthis.isInitialized = true;\n\t\t\t}\n\t\t\tcatch (ex) {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('Failed to store state:', ex);\n\t\t\t}\n\t\t};\n\n\t\tif (immediate) {\n\t\t\tonSet();\n\t\t}\n\t\telse {\n\t\t\tthis.debounceHandle = requestIdleCallback(onSet, { timeout: this.debounceMs });\n\t\t}\n\t}\n}\n","import type { StorageBackend } from './StateStorage';\n\nexport class ProxyStorageBackend<T> implements StorageBackend<T> {\n\tprivate readonly isProxyBackend = true;\n\n\tprivate constructor(\n\t\tprivate readonly backend: StorageBackend<any>,\n\t\tprivate readonly path: (keyof any)[]\n\t) {}\n\n\n\tpublic get(): T {\n\t\tlet current = this.backend.get();\n\t\tlet index = 0;\n\n\t\twhile (index < this.path.length) {\n\t\t\tif (typeof current !== 'object' || current === null) {\n\t\t\t\tthrow new Error('Primitive types cannot hold sub-states.');\n\t\t\t}\n\n\t\t\tconst key = this.path[index++];\n\t\t\tif (typeof key !== 'number' && Array.isArray(current)) {\n\t\t\t\tthrow new Error('Cannot access array sub-state under non-numeric keys.');\n\t\t\t}\n\n\t\t\tcurrent = current[key];\n\t\t}\n\n\t\treturn current;\n\t}\n\n\tpublic set(state: T, immediate?: boolean | undefined) {\n\t\tlet current = this.backend.get();\n\t\tlet index = 0;\n\n\t\tconst root = Array.isArray(current) ? current.slice() : { ...current };\n\t\tcurrent = root;\n\n\t\twhile (index < this.path.length) {\n\t\t\tif (typeof current !== 'object' || current === null) {\n\t\t\t\tthrow new Error('Primitive types cannot hold sub-states.');\n\t\t\t}\n\n\t\t\tconst key = this.path[index++];\n\t\t\tif (typeof key !== 'number' && Array.isArray(current)) {\n\t\t\t\tthrow new Error('Cannot access array sub-state under non-numeric keys.');\n\t\t\t}\n\n\t\t\tif (index === this.path.length) {\n\t\t\t\tcurrent[key] = state;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst next = current[key];\n\t\t\t\tconst clone = Array.isArray(next) ? next.slice() : { ...next };\n\t\t\t\tcurrent[key] = clone;\n\t\t\t\tcurrent = clone;\n\t\t\t}\n\t\t}\n\n\t\tthis.backend.set(root, immediate);\n\t}\n\n\n\tpublic static proxySubState<TState, TKey extends keyof TState>(\n\t\tbackend: StorageBackend<TState>,\n\t\tkey: TKey\n\t): ProxyStorageBackend<TState[TKey]> {\n\t\tif (ProxyStorageBackend.isProxy(backend)) {\n\t\t\treturn new ProxyStorageBackend(\n\t\t\t\tbackend.backend,\n\t\t\t\tbackend.path.concat(key)\n\t\t\t);\n\t\t}\n\n\t\treturn new ProxyStorageBackend(backend, [ key ]);\n\t}\n\n\tprivate static isProxy(backend: StorageBackend<any>): backend is ProxyStorageBackend<unknown> {\n\t\treturn (backend as ProxyStorageBackend<any>).isProxyBackend;\n\t}\n}\n","import { ProxyStorageBackend } from './ProxyStorageBackend';\nimport type { State } from './State';\n\nexport interface StorageBackend<T> {\n\tget(): T;\n\tset(state: T, immediate?: boolean): void;\n}\n\nexport class StateStorage<T> implements State<T> {\n\tpublic constructor(\n\t\tprivate readonly backend: StorageBackend<T>\n\t) {}\n\n\tpublic get current() {\n\t\treturn this.backend.get()!;\n\t}\n\n\tpublic init(state: T) {\n\t\ttry {\n\t\t\t// get throws when no state exists\n\t\t\tthis.backend.get();\n\t\t\treturn false;\n\t\t}\n\t\tcatch (_ex) {\n\t\t\tthis.set(state, true);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tpublic set(state: T, immediate?: boolean) {\n\t\tthis.backend.set(state, immediate);\n\t}\n\n\tpublic patch(patch: Partial<T>, immediate?: boolean) {\n\t\tthis.set({\n\t\t\t...this.current,\n\t\t\t...patch\n\t\t}, immediate);\n\t}\n\n\tpublic subState<TKey extends keyof T>(key: TKey): StateStorage<T[TKey]> {\n\t\treturn new StateStorage(\n\t\t\tProxyStorageBackend.proxySubState(this.backend, key)\n\t\t);\n\t}\n}\n","export interface RegistryEntry {\n\treadonly key: string;\n}\n\nexport class Registry<T extends RegistryEntry> {\n\tprivate readonly entries: { [K in string]?: T } = {};\n\n\tpublic get keys(): readonly string[] {\n\t\treturn Object.keys(this.entries);\n\t}\n\n\tpublic add(entry: T) {\n\t\tif (this.entries[entry.key]) {\n\t\t\tthrow new Error(`Entry with the key '${entry.key}' has already been registered.`);\n\t\t}\n\n\t\tthis.entries[entry.key] = entry;\n\t\treturn entry;\n\t}\n\n\tpublic get(key: string) {\n\t\tconst entry = this.entries[key];\n\t\tif (!entry) {\n\t\t\tthrow new Error(`Entry with the key '${key}' has not been registered.`);\n\t\t}\n\n\t\treturn entry;\n\t}\n}\n","import { XP_LOG_BASE, XP_SCALE } from '~/game/constants';\nimport type { State } from '~/game/storage/State';\n\nexport class Level {\n\tprivate _value?: number;\n\n\tpublic constructor(\n\t\tprivate readonly state: State<number>\n\t) {}\n\n\n\tpublic get xp() {\n\t\treturn this.state.current;\n\t}\n\n\tpublic set xp(value: number) {\n\t\tif (Number.isFinite(value) && value >= 0) {\n\t\t\tthis.state.set(value);\n\t\t\tthis._value = undefined;\n\t\t}\n\t}\n\n\tpublic get value() {\n\t\treturn (this._value ??= Level.getLevelByExperience(this.xp));\n\t}\n\n\tpublic get xpRequiredForNextLevel() {\n\t\treturn Level.getExperienceRequiredForLevel(this.value + 1) - Level.getExperienceRequiredForLevel(this.value);\n\t}\n\n\tpublic get xpThisLevel() {\n\t\treturn this.xp - Level.getExperienceRequiredForLevel(this.value);\n\t}\n\n\n\tpublic static getExperienceRequiredForLevel(level: number) {\n\t\treturn Math.ceil(\n\t\t\tXP_SCALE * (XP_LOG_BASE ** (Math.floor(level) - 1) - 1)\n\t\t);\n\t}\n\n\tpublic static getLevelByExperience(experience: number) {\n\t\treturn 1 + Math.floor(\n\t\t\tMath.log(\n\t\t\t\t1 + experience / XP_SCALE\n\t\t\t) / Math.log(XP_LOG_BASE)\n\t\t);\n\t}\n}\n","// the maximum number of heroes the player can have recruited at one time\nexport const MAX_HEROES = 10;\n\n// controls the XP progression curve\nexport const XP_LOG_BASE = 1.2;\nexport const XP_SCALE = 1000;\n","import type { ItemStack } from '~/game/items/ItemStack';\nimport { Registry, RegistryEntry } from '~/game/Registry';\nimport type { State } from '~/game/storage/State';\nimport type { TraderGame } from '~/game/TraderGame';\n\nimport { Level } from './Level';\n\n\nexport enum CrafterActivity {\n\tIDLE,\n\tCRAFT_PENDING,\n\tCRAFT_READY\n}\n\nexport interface CrafterActivityBase<TActivity extends CrafterActivity> {\n\treadonly kind: TActivity;\n}\n\nexport interface CrafterIdleActivity extends CrafterActivityBase<CrafterActivity.IDLE> {}\n\nexport interface CrafterCraftPendingActivity extends CrafterActivityBase<CrafterActivity.CRAFT_PENDING> {\n\treadonly elapsesAt: number;\n\treadonly recipeIndex: number;\n\treadonly quantity: number;\n}\n\nexport interface CrafterCraftReadyActivity extends CrafterActivityBase<CrafterActivity.CRAFT_READY> {\n\treadonly loot: ItemStack;\n\treadonly xp: number;\n}\n\n\nexport interface Recipe {\n\treadonly baseDurationMs: number;\n\treadonly minLevel: number;\n\treadonly materials: readonly ItemStack[];\n\treadonly result: ItemStack;\n}\n\nexport interface CrafterInfo extends RegistryEntry {\n\treadonly icon: string;\n\treadonly recipes: readonly Recipe[];\n}\n\nexport interface CrafterState {\n\treadonly key: string;\n\treadonly xp: number;\n\treadonly activity:\n\t| CrafterIdleActivity\n\t| CrafterCraftPendingActivity\n\t| CrafterCraftReadyActivity;\n}\n\n\nexport class Crafter {\n\tpublic readonly level: Level;\n\n\tpublic constructor(\n\t\tprivate readonly game: TraderGame,\n\t\tprivate readonly state: State<CrafterState>\n\t) {\n\t\tthis.level = new Level(\n\t\t\tstate.subState('xp')\n\t\t);\n\t}\n\n\n\tpublic get activity() {\n\t\treturn this.state.current.activity;\n\t}\n\n\tprivate get entry() {\n\t\treturn Crafter.registry.get(this.key);\n\t}\n\n\tpublic get icon() {\n\t\treturn this.entry.icon;\n\t}\n\n\tpublic get key() {\n\t\treturn this.state.current.key;\n\t}\n\n\tpublic get recipes() {\n\t\treturn this.entry.recipes;\n\t}\n\n\n\tpublic scheduleCraft(recipe: Recipe, quantity: number) {\n\t\tif (this.activity.kind !== CrafterActivity.IDLE) {\n\t\t\tthrow new Error('Cannot schedule a craft when the crafter is not IDLE.');\n\t\t}\n\n\t\tconst recipeIndex = this.entry.recipes.indexOf(recipe);\n\t\tif (recipeIndex === -1) {\n\t\t\tthrow new Error('Crafter can only craft its own recipes.');\n\t\t}\n\n\t\tthis.game.inventory.remove(recipe.materials.map(material => ({\n\t\t\t...material,\n\t\t\tquantity: material.quantity * quantity\n\t\t})));\n\n\t\tthis.state.patch({\n\t\t\tactivity: {\n\t\t\t\tkind: CrafterActivity.CRAFT_PENDING,\n\t\t\t\telapsesAt: this.game.clock.now + recipe.baseDurationMs * quantity,\n\t\t\t\trecipeIndex,\n\t\t\t\tquantity\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic completeCraft() {\n\t\tif (this.activity.kind !== CrafterActivity.CRAFT_PENDING || this.activity.elapsesAt > this.game.clock.now) {\n\t\t\tthrow new Error('Cannot complete a craft when it did not elapse.');\n\t\t}\n\n\t\tconst { result } = this.entry.recipes[this.activity.recipeIndex];\n\t\tthis.state.patch({\n\t\t\tactivity: {\n\t\t\t\tkind: CrafterActivity.CRAFT_READY,\n\t\t\t\tloot: {\n\t\t\t\t\t...result,\n\t\t\t\t\tquantity: result.quantity * this.activity.quantity,\n\t\t\t\t},\n\t\t\t\txp: 0 * this.activity.quantity // TODO\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic deliverCraft() {\n\t\tif (this.activity.kind !== CrafterActivity.CRAFT_READY) {\n\t\t\tthrow new Error('Cannot deliver a craft when not ready.');\n\t\t}\n\n\t\tthis.game.inventory.add([ this.activity.loot ]);\n\t\tthis.level.xp += this.activity.xp;\n\t\tthis.state.patch({\n\t\t\tactivity: {\n\t\t\t\tkind: CrafterActivity.IDLE\n\t\t\t}\n\t\t});\n\t}\n\n\n\tpublic static readonly registry = new Registry<CrafterInfo>();\n\n\tpublic static create(key: string): CrafterState {\n\t\treturn {\n\t\t\tkey,\n\t\t\txp: 0,\n\t\t\tactivity: {\n\t\t\t\tkind: CrafterActivity.IDLE\n\t\t\t}\n\t\t};\n\t}\n}\n","export enum EquipmentSlot {\n\tWEAPON,\n\tHEAD,\n\tCHEST,\n\tLEGS,\n\tFEET,\n\tRING\n}\n\nexport type Equipment = {\n\treadonly [K in EquipmentSlot]?: string\n};\n\nexport const equipmentSlotKeys = [\n\tEquipmentSlot.WEAPON,\n\tEquipmentSlot.HEAD,\n\tEquipmentSlot.CHEST,\n\tEquipmentSlot.LEGS,\n\tEquipmentSlot.FEET,\n\tEquipmentSlot.RING\n] as const;\n","export enum Attribute {\n\tAGILITY,\n\tINTELLECT,\n\tSTAMINA,\n\tSTRENGTH,\n\tPHYSICAL_DEFENSE,\n\tMAGIC_DEFENSE\n}\n\nexport type Attributes = {\n\t[K in Attribute]?: number;\n};\n","export interface EnumType {\n\treadonly key: string;\n}\n\nexport type EnumDefinition<TItem extends EnumType> = {\n\treadonly [K in string]?: TItem;\n};\n\ntype Mutable<T> = { -readonly [K in keyof T]: T[K] };\n\nexport function enumOf<T extends EnumType>() {\n\treturn <E extends Record<string, Omit<T, 'key'>>>(obj: E) => {\n\t\tObject.keys(obj).forEach(key => {\n\t\t\t(obj[key] as Mutable<T>).key ??= key;\n\t\t});\n\n\t\treturn obj as unknown as { [K in keyof E]: T };\n\t};\n}\n\nexport function enumGet<T extends EnumType>(enumObj: EnumDefinition<T>, key: string) {\n\tconst member = enumObj[key];\n\tif (typeof member !== 'object' || member.key !== key) {\n\t\tthrow new Error(`No enum member with the key '${key}' found.`);\n\t}\n\n\treturn member;\n}\n\nexport function enumMap<T extends EnumType>(enumObj: EnumDefinition<T>, callback: (value: T, key: string) => T): T[] {\n\tconst result: T[] = [];\n\tfor (const key in enumObj) {\n\t\tconst member = enumObj[key];\n\t\tif (typeof member === 'object' && member.key === key) {\n\t\t\tresult.push(callback(member, key));\n\t\t}\n\t}\n\n\treturn result;\n}\n\n// this function maps a regular type script enum rather than our java-like enums\nexport function tsEnumMap<T>(\n\tenumObj: Record<string | number, number | string>,\n\tcallback: (value: number, key: string) => T\n): T[] {\n\tconst result: T[] = [];\n\tfor (const key in enumObj) {\n\t\tconst value = enumObj[key];\n\t\tif (typeof value === 'string' && Object.prototype.hasOwnProperty.call(enumObj, value)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tresult.push(callback(value as number, key));\n\t}\n\n\treturn result;\n}\n","import { Attribute, Attributes } from '~/game/entities/Attributes';\nimport { enumOf, EnumType } from '~/utils/enum';\n\nimport { EquipmentSlot } from './EquipmentSlot';\n\nexport interface ItemKind extends EnumType {\n\treadonly icon: string;\n\treadonly maxStack: number;\n\treadonly sellPrice: number;\n\treadonly slot?: EquipmentSlot;\n\treadonly attributes?: Attributes;\n\treadonly healValue?: number;\n}\n\nexport const ItemKinds = enumOf<ItemKind>()({\n\n\t// looted\n\t// ---\n\tBONE: {\n\t\ticon: '🦴',\n\t\tsellPrice: 5,\n\t\tmaxStack: 20\n\t},\n\tSKULL: {\n\t\ticon: '💀',\n\t\tsellPrice: 8,\n\t\tmaxStack: 20\n\t},\n\tBROKEN_BOW: {\n\t\ticon: '🏹',\n\t\tsellPrice: 5,\n\t\tmaxStack: 20\n\t},\n\tWOODEN_LOG: {\n\t\ticon: '🪵',\n\t\tsellPrice: 1,\n\t\tmaxStack: 100\n\t},\n\tSTONE: {\n\t\ticon: '🗿',\n\t\tsellPrice: 1,\n\t\tmaxStack: 100\n\t},\n\tBERRY: {\n\t\ticon: '🫐',\n\t\tsellPrice: 3,\n\t\tmaxStack: 50\n\t},\n\tCOCA_LEAVES: {\n\t\ticon: '🌿',\n\t\tsellPrice: 30,\n\t\tmaxStack: 50\n\t},\n\n\t// crafted\n\t// ---\n\tSWORD: {\n\t\ticon: '🗡️',\n\t\tsellPrice: 15,\n\t\tmaxStack: 1,\n\t\tslot: EquipmentSlot.WEAPON,\n\t\tattributes: {\n\t\t\t[Attribute.STRENGTH]: 3\n\t\t}\n\t},\n\tSTAFF: {\n\t\ticon: '🍢',\n\t\tsellPrice: 15,\n\t\tmaxStack: 1,\n\t\tslot: EquipmentSlot.WEAPON,\n\t\tattributes: {\n\t\t\t[Attribute.INTELLECT]: 3\n\t\t}\n\t},\n\tHEALTH_POTION: {\n\t\ticon: '🧪',\n\t\tsellPrice: 10,\n\t\tmaxStack: 20,\n\t\thealValue: 20\n\t},\n\tCOCAINE: {\n\t\ticon: '❄️',\n\t\tsellPrice: 1000,\n\t\tmaxStack: 20,\n\t\thealValue: -20\n\t},\n\n\t// starter gear\n\t// ---\n\tCHAIN_HOOD: {\n\t\ticon: '🪖',\n\t\tsellPrice: 5,\n\t\tmaxStack: 1,\n\t\tslot: EquipmentSlot.HEAD,\n\t\tattributes: {\n\t\t\t[Attribute.PHYSICAL_DEFENSE]: 2\n\t\t}\n\t},\n\tCHAIN_VEST: {\n\t\ticon: '🎽',\n\t\tsellPrice: 5,\n\t\tmaxStack: 1,\n\t\tslot: EquipmentSlot.CHEST,\n\t\tattributes: {\n\t\t\t[Attribute.PHYSICAL_DEFENSE]: 2\n\t\t}\n\t},\n\tCHAIN_LEGGINGS: {\n\t\ticon: '👖',\n\t\tsellPrice: 5,\n\t\tmaxStack: 1,\n\t\tslot: EquipmentSlot.LEGS,\n\t\tattributes: {\n\t\t\t[Attribute.PHYSICAL_DEFENSE]: 2\n\t\t}\n\t},\n\tAPPRENTICE_RING: {\n\t\ticon: '💍',\n\t\tsellPrice: 5,\n\t\tmaxStack: 1,\n\t\tslot: EquipmentSlot.RING,\n\t\tattributes: {\n\t\t\t[Attribute.STAMINA]: 3\n\t\t}\n\t}\n});\n","/**\n * Iterates the given array and returns the sum of values selected by the\n * provided selector.\n */\nexport function sum<T>(iterable: Iterable<T>, selector: (item: T) => number): number {\n\tlet result = 0;\n\tfor (const item of iterable) {\n\t\tresult += selector(item);\n\t}\n\n\treturn result;\n}\n\nexport function min<T>(iterable: Iterable<T>, selector: (item: T) => number): number {\n\tlet result = Infinity;\n\tfor (const item of iterable) {\n\t\tresult = Math.min(result, selector(item));\n\t}\n\n\treturn result;\n}\n\nexport function times<T>(n: number, fn: (index: number) => T): T[] {\n\tconst items = new Array<T>(n);\n\tfor (let i = 0; i < n; ++i) {\n\t\titems[i] = fn(i);\n\t}\n\n\treturn items;\n}\n\nexport function first<T>(array: readonly T[]): T | undefined;\nexport function first<T>(array: readonly T[], count: number): T[];\nexport function first<T>(array: readonly T[], count?: number): T[] | T | undefined {\n\treturn count === undefined\n\t\t? array[0]\n\t\t: array.slice(0, Math.max(count, 0));\n}\n\nexport function last<T>(array: readonly T[]): T | undefined;\nexport function last<T>(array: readonly T[], count: number): T[];\nexport function last<T>(array: readonly T[], count?: number): T[] | T | undefined {\n\treturn count === undefined\n\t\t? array[array.length - 1]\n\t\t: array.slice(-Math.max(count, 0));\n}\n","/**\n * Clamps the given value between min and max. Both limits are *inclusive*.\n */\nexport function clamp(value: number, min = 0.0, max = 1.0) {\n\treturn value > max ? max : value < min ? min : value;\n}\n\n/**\n * Applies linear interpolation onto the given value so that its <0; 1> range\n * is projected onto <start; end>. Values may go beyond these ranges.\n */\nexport function interpolate(value: number, start: number, end: number) {\n\treturn (end - start) * value + start;\n}\n\n/**\n * Returns a random floating point value between min (inclusive) and max\n * (exclusive).\n */\nexport function randomFloat(min: number, max: number) {\n\treturn interpolate(Math.random(), min, max);\n}\n\n/**\n * Returns a random integer value between min (inclusive) and max (exclusive).\n */\nexport function randomInt(min: number, max: number) {\n\treturn Math.trunc(randomFloat(min, max));\n}\n\n/**\n * Returns one of the provided items at random.\n */\nexport function choose<T>(item0: T, item1: T, ...moreItems: T[]): T;\nexport function choose<T>(...items: T[]) {\n\treturn items[randomInt(0, items.length)];\n}\n","import { sum } from '~/utils/array';\nimport { randomFloat, randomInt } from '~/utils/math';\n\nimport { ItemStack } from './ItemStack';\n\nexport interface LootTableItem {\n\treadonly itemKey: string;\n\treadonly maxQuantity: number;\n\treadonly minQuantity: number;\n}\n\nexport interface LootTableRow {\n\treadonly items: readonly LootTableItem[];\n\treadonly probability: number;\n}\n\nexport class LootTable {\n\tpublic constructor(\n\t\tprivate readonly rows: readonly LootTableRow[]\n\t) {}\n\n\tpublic generateLoot(): ItemStack[] {\n\t\tconst row = this.chooseRow();\n\t\tconst items: ItemStack[] = [];\n\n\t\tfor (const item of row.items) {\n\t\t\tconst quantity = randomInt(item.minQuantity, item.maxQuantity + 1);\n\t\t\tif (quantity > 0) {\n\t\t\t\titems.push({\n\t\t\t\t\titemKey: item.itemKey,\n\t\t\t\t\tquantity\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tprivate chooseRow() {\n\t\tconst probabilitySum = sum(this.rows, row => row.probability);\n\n\t\tlet chance = randomFloat(0, probabilitySum);\n\t\tfor (const row of this.rows) {\n\t\t\tchance -= row.probability;\n\t\t\tif (chance <= 0) {\n\t\t\t\treturn row;\n\t\t\t}\n\t\t}\n\n\t\treturn LootTable.EMPTY_ROW;\n\t}\n\n\tprivate static readonly EMPTY_ROW: LootTableRow = {\n\t\titems: [],\n\t\tprobability: 0\n\t};\n\n\tpublic static generateLoot(rows: readonly LootTableRow[]) {\n\t\treturn new LootTable(rows).generateLoot();\n\t}\n}\n","import type { LootTableRow } from '~/game/items/LootTable';\nimport { Registry, RegistryEntry } from '~/game/Registry';\n\nexport interface Quest extends RegistryEntry {\n\treadonly baseDurationMs: number;\n\treadonly enemyKey: string;\n\treadonly levelRequirement: number;\n\treadonly lootTable: readonly LootTableRow[];\n\treadonly xpModifier: number;\n}\n\nexport const questRegistry = new Registry<Quest>();\n","import type { Attribute } from '~/game/entities/Attributes';\nimport type { AppliedEffect, Effect } from '~/game/entities/combat/Effect';\n\nimport type { LivingEntity } from './LivingEntity';\n\nexport enum CombatSide {\n\tGOOD,\n\tEVIL\n}\n\nexport enum SetMode {\n\tCONST,\n\tOFFSET,\n\tMULTIPLIER\n}\n\nexport interface Combatant {\n\treadonly entity: LivingEntity;\n\treadonly effects: readonly AppliedEffect[];\n\treadonly isAlive: boolean;\n\treadonly side: CombatSide;\n\treadonly health: number;\n\tdamage(value: number, defense?: Attribute): void;\n\theal(value: number): void;\n\taddEffect(effect: Effect, param?: number): void;\n\tremoveEffect(effect: AppliedEffect): void;\n\tgetAttribute(attribute: Attribute): number;\n\tsetAttribute(attribute: Attribute, value: number, mode?: SetMode): void;\n\ttickEffects(): void;\n}\n\nexport interface Participants {\n\treadonly evil: readonly Combatant[];\n\treadonly good: readonly Combatant[];\n}\n","import { Attribute } from '~/game/entities/Attributes';\nimport { enumOf, EnumType } from '~/utils/enum';\n\nimport { Combatant, SetMode } from './Combatant';\n\nexport enum EffectKind {\n\tPOSITIVE,\n\tNEGATIVE\n}\n\nexport interface Effect extends EnumType {\n\treadonly duration: number;\n\treadonly kind: EffectKind;\n\treadonly maxStackCount: number;\n\ttick(this: AppliedEffect, affected: Combatant): void;\n}\n\nexport interface MutableAppliedEffect {\n\treadonly effectKey: string;\n\treadonly source: Combatant;\n\treadonly param: number;\n\tremainingDuration: number;\n\tstackCount: number;\n}\n\nexport type AppliedEffect = Readonly<MutableAppliedEffect>;\n\nexport const Effects = enumOf<Effect>()({\n\tSUNDER: {\n\t\tkind: EffectKind.NEGATIVE,\n\t\tduration: 3,\n\t\tmaxStackCount: 5,\n\t\ttick(affected) {\n\t\t\taffected.setAttribute(Attribute.PHYSICAL_DEFENSE, 0.93 ** this.stackCount, SetMode.MULTIPLIER);\n\t\t}\n\t},\n\tIGNITE: {\n\t\t// does 50% of input damage (specified via param) spread over 3 turns\n\t\tkind: EffectKind.NEGATIVE,\n\t\tduration: 3,\n\t\tmaxStackCount: 0,\n\t\ttick(affected) {\n\t\t\taffected.damage(this.param / 6);\n\t\t}\n\t}\n});\n","import { first } from '~/utils/array';\n\nimport { Combatant, CombatSide, Participants } from './Combatant';\n\n/*\ncurrently:\nheroes:\t\tenemies:\n0\t\t\t0\n\nfuture:\nheroes:\t\tenemies:\n3, 0,\t\t0, 3,\n4, 1,\t\t1, 4,\n5, 2\t\t2, 5\n*/\n\ninterface SingleTargetFunction {\n\t(attacker: Combatant, participants: Participants): Combatant;\n}\n\n// interface MultiTargetFunction {\n// \t(attacker: Combatant, participants: Participants): readonly Combatant[];\n// }\n\nexport const directEnemy: SingleTargetFunction = (attacker, participants) => (\n\tfirst(getEnemies(attacker, participants))!\n);\n\n// export const directFriendly: SingleTargetFunction = (attacker, participants) => {\n// };\n\n// export const frontAOE: MultiTargetFunction = (attacker, participants) => {\n// };\n\n// export const backAOE: MultiTargetFunction = (attacker, participants) => {\n// };\n\n// export const globalAOE: MultiTargetFunction = (attacker, participants) => {\n// };\n\nfunction getFriendly(attacker: Combatant, participants: Participants) {\n\tswitch (attacker.side) {\n\t\tcase CombatSide.GOOD:\n\t\t\treturn participants.good;\n\n\t\tcase CombatSide.EVIL:\n\t\t\treturn participants.evil;\n\t}\n}\n\nfunction getEnemies(attacker: Combatant, participants: Participants) {\n\tswitch (attacker.side) {\n\t\tcase CombatSide.GOOD:\n\t\t\treturn participants.evil;\n\n\t\tcase CombatSide.EVIL:\n\t\t\treturn participants.good;\n\t}\n}\n","import { Attribute } from '~/game/entities/Attributes';\nimport { enumOf, EnumType } from '~/utils/enum';\nimport { randomFloat } from '~/utils/math';\n\nimport type { Combatant, Participants } from './Combatant';\nimport { Effects } from './Effect';\nimport { directEnemy } from './targeting';\n\nexport interface Attack extends EnumType {\n\texecute(this: Attack, attacker: Combatant, participants: Participants): void;\n}\n\n// we want each entity to have a set rotation of three attacks\nexport type AttackRotation = readonly [ string, string, string ];\n\nexport const Attacks = enumOf<Attack>()({\n\tNONE: {\n\t\texecute() {\n\t\t\t// do nothing\n\t\t}\n\t},\n\tLUNGE: {\n\t\texecute(attacker, participants) {\n\t\t\tconst defender = directEnemy(attacker, participants);\n\t\t\tconst damage = attacker.getAttribute(Attribute.STRENGTH) * randomFloat(0.9, 1.1);\n\n\t\t\tdefender.damage(damage, Attribute.PHYSICAL_DEFENSE);\n\t\t}\n\t},\n\tFIREBALL: {\n\t\texecute(attacker, participants) {\n\t\t\tconst defender = directEnemy(attacker, participants);\n\t\t\tconst damage = attacker.getAttribute(Attribute.INTELLECT) * randomFloat(0.9, 1.1);\n\n\t\t\tdefender.damage(damage, Attribute.MAGIC_DEFENSE);\n\t\t\tdefender.addEffect(Effects.IGNITE, damage);\n\t\t}\n\t},\n\tSUNDER: {\n\t\texecute(attacker, participants) {\n\t\t\tconst defender = directEnemy(attacker, participants);\n\t\t\tdefender.addEffect(Effects.SUNDER);\n\t\t}\n\t}\n});\n","import type { Effect } from '~/game/entities/combat/Effect';\n\nimport type { Combatant } from './Combatant';\n\nexport enum CombatEventKind {\n\tDIRECT_DAMAGE,\n\tDIRECT_HEAL,\n\tEFFECT_APPLIED,\n\tEFFECT_STACKED,\n\tEFFECT_FADED,\n\tEFFECT_REMOVED,\n\tPARTICIPANT_DIED,\n\tPARTICIPANT_REVIVED,\n\tROUND_START\n}\n\ninterface CombatEventBase<TKind extends CombatEventKind> {\n\treadonly kind: TKind;\n}\n\nexport interface DirectDamageOrHealEvent extends CombatEventBase<CombatEventKind.DIRECT_DAMAGE | CombatEventKind.DIRECT_HEAL> {\n\treadonly source: Combatant;\n\treadonly target: Combatant;\n\treadonly healthChange: number;\n}\n\nexport interface EffectAppliedEvent extends CombatEventBase<CombatEventKind.EFFECT_APPLIED> {\n\treadonly source: Combatant;\n\treadonly target: Combatant;\n\treadonly effectKey: string;\n}\n\nexport interface EffectStackedEvent extends CombatEventBase<CombatEventKind.EFFECT_STACKED> {\n\treadonly source: Combatant;\n\treadonly target: Combatant;\n\treadonly effectKey: string;\n\treadonly stackCount: number;\n}\n\nexport interface EffectFadedOrRemovedEvent extends CombatEventBase<CombatEventKind.EFFECT_FADED | CombatEventKind.EFFECT_REMOVED> {\n\treadonly target: Combatant;\n\treadonly effectKey: string;\n}\n\nexport interface ParticipantDiedEvent extends CombatEventBase<CombatEventKind.PARTICIPANT_DIED> {\n\treadonly target: Combatant;\n}\n\nexport interface ParticipantRevivedEvent extends CombatEventBase<CombatEventKind.PARTICIPANT_REVIVED> {\n\treadonly target: Combatant;\n\treadonly revivalHealth: number;\n}\n\nexport interface RoundStartEvent extends CombatEventBase<CombatEventKind.ROUND_START> {\n\treadonly round: number;\n}\n\nexport type CombatEvent =\n\t| DirectDamageOrHealEvent\n\t| EffectAppliedEvent\n\t| EffectStackedEvent\n\t| EffectFadedOrRemovedEvent\n\t| ParticipantDiedEvent\n\t| ParticipantRevivedEvent\n\t| RoundStartEvent;\n","import { Equipment, equipmentSlotKeys } from '~/game/items/EquipmentSlot';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport type { ItemStack } from '~/game/items/ItemStack';\nimport { LootTable } from '~/game/items/LootTable';\nimport { questRegistry } from '~/game/quests/Quest';\nimport { Registry, RegistryEntry } from '~/game/Registry';\nimport type { State } from '~/game/storage/State';\nimport type { TraderGame } from '~/game/TraderGame';\nimport { enumGet } from '~/utils/enum';\n\nimport type { Attribute, Attributes } from './Attributes';\nimport { AttackRotation } from './combat/Attack';\nimport { CombatSide } from './combat/Combatant';\nimport { CombatEvent } from './combat/CombatEvent';\nimport { ScopedCombatSimulator } from './combat/CombatSimulator';\nimport type { LivingEntity } from './combat/LivingEntity';\nimport { Enemy } from './Enemy';\nimport { Health } from './Health';\nimport { Level } from './Level';\n\n\nexport enum HeroActivity {\n\tIDLE,\n\tDEAD,\n\tQUEST_PENDING,\n\tQUEST_READY\n}\n\nexport interface HeroActivityBase<TKind extends HeroActivity> {\n\treadonly kind: TKind;\n}\n\nexport interface HeroIdleActivity extends HeroActivityBase<HeroActivity.IDLE> {}\n\nexport interface HeroDeadActivity extends HeroActivityBase<HeroActivity.DEAD> {\n\treadonly combatEvents: readonly CombatEvent[];\n}\n\nexport interface HeroQuestPendingActivity extends HeroActivityBase<HeroActivity.QUEST_PENDING> {\n\treadonly durationMs: number;\n\treadonly elapsesAt: number;\n\treadonly questKey: string;\n}\n\nexport interface HeroQuestReadyActivity extends HeroActivityBase<HeroActivity.QUEST_READY> {\n\treadonly combatEvents: readonly CombatEvent[];\n\treadonly loot: readonly ItemStack[];\n\treadonly xp: number;\n}\n\n\nexport interface HeroInfo extends RegistryEntry {\n\treadonly baseAttributes: Attributes;\n\treadonly icon: string;\n\treadonly levelAdvancement: Attributes;\n\treadonly rotation: AttackRotation;\n\treadonly startEquipment: Equipment;\n}\n\nexport interface HeroState {\n\treadonly equipment: Equipment;\n\treadonly healthDeficit: number;\n\treadonly key: string;\n\treadonly rotation: AttackRotation;\n\treadonly xp: number;\n\treadonly activity:\n\t| HeroIdleActivity\n\t| HeroDeadActivity\n\t| HeroQuestPendingActivity\n\t| HeroQuestReadyActivity;\n}\n\n\nexport class Hero implements LivingEntity {\n\tpublic readonly health: Health;\n\tpublic readonly level: Level;\n\n\tpublic constructor(\n\t\tprivate readonly game: TraderGame,\n\t\tprivate readonly state: State<HeroState>\n\t) {\n\t\tthis.health = new Health(\n\t\t\tthis,\n\t\t\tstate.subState('healthDeficit')\n\t\t);\n\n\t\tthis.level = new Level(\n\t\t\tstate.subState('xp')\n\t\t);\n\t}\n\n\n\tpublic get activity() {\n\t\treturn this.state.current.activity;\n\t}\n\n\tprivate get entry() {\n\t\treturn Hero.registry.get(this.key);\n\t}\n\n\tpublic get equipment() {\n\t\treturn this.state.current.equipment;\n\t}\n\n\tpublic get icon() {\n\t\treturn this.entry.icon;\n\t}\n\n\tpublic get key() {\n\t\treturn this.state.current.key;\n\t}\n\n\tpublic get rotation() {\n\t\treturn this.state.current.rotation;\n\t}\n\n\tpublic set rotation(rotation: AttackRotation) {\n\t\tthis.state.patch({ rotation });\n\t}\n\n\n\tpublic getAttribute(attribute: Attribute) {\n\t\tlet equipmentBonus = 0;\n\t\tfor (const slot of equipmentSlotKeys) {\n\t\t\tconst itemKey = this.equipment[slot];\n\t\t\tif (itemKey) {\n\t\t\t\tconst item = enumGet(ItemKinds, itemKey);\n\t\t\t\tequipmentBonus += item.attributes?.[attribute] ?? 0;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t(this.entry.baseAttributes[attribute] ?? 0) +\n\t\t\t(this.level.value - 1) * (this.entry.levelAdvancement[attribute] ?? 0) +\n\t\t\tequipmentBonus\n\t\t);\n\t}\n\n\tpublic scheduleQuest(questKey: string) {\n\t\tif (this.activity.kind !== HeroActivity.IDLE) {\n\t\t\tthrow new Error('Cannot schedule a quest when the hero is not IDLE.');\n\t\t}\n\n\t\tconst quest = questRegistry.get(questKey);\n\t\tif (quest.levelRequirement > this.level.value) {\n\t\t\tthrow new Error('Hero must meet the level requirement of a quest.');\n\t\t}\n\n\t\tconst levelDiff = quest.levelRequirement - this.level.value;\n\t\tconst durationMs = quest.baseDurationMs * (\n\t\t\tlevelDiff < 0\n\t\t\t\t? 0.75 / (1 - levelDiff / 3) + 0.25\n\t\t\t\t: 1 + Math.sqrt(levelDiff)\n\t\t);\n\n\t\tthis.state.patch({\n\t\t\tactivity: {\n\t\t\t\tkind: HeroActivity.QUEST_PENDING,\n\t\t\t\tdurationMs,\n\t\t\t\telapsesAt: this.game.clock.now + durationMs,\n\t\t\t\tquestKey\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic completeQuest() {\n\t\tif (this.activity.kind !== HeroActivity.QUEST_PENDING || this.activity.elapsesAt > this.game.clock.now) {\n\t\t\tthrow new Error('Cannot complete a quest when it did not elapse yet.');\n\t\t}\n\n\t\tconst quest = questRegistry.get(this.activity.questKey);\n\t\tconst simulator = ScopedCombatSimulator.create([\n\t\t\t{\n\t\t\t\tentity: this,\n\t\t\t\tside: CombatSide.GOOD\n\t\t\t},\n\t\t\t{\n\t\t\t\tentity: new Enemy(quest.enemyKey),\n\t\t\t\tside: CombatSide.EVIL\n\t\t\t}\n\t\t]);\n\n\t\t// TODO: combat events do not serialize correctly yet\n\t\tconst combatEvents: readonly CombatEvent[] = [];\n\t\tsimulator.run();\n\n\t\tif (this.health.isAlive) {\n\t\t\tconst levelDiff = quest.levelRequirement - this.level.value;\n\t\t\tconst xp = this.level.xpRequiredForNextLevel * quest.xpModifier * (\n\t\t\t\tlevelDiff < 0\n\t\t\t\t\t? 1 / (1 - levelDiff)\n\t\t\t\t\t: 1 + (levelDiff / 2) ** 2\n\t\t\t);\n\n\t\t\tthis.state.patch({\n\t\t\t\tactivity: {\n\t\t\t\t\tkind: HeroActivity.QUEST_READY,\n\t\t\t\t\tloot: LootTable.generateLoot(quest.lootTable),\n\t\t\t\t\tcombatEvents,\n\t\t\t\t\txp\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tthis.state.patch({\n\t\t\t\tactivity: {\n\t\t\t\t\tcombatEvents,\n\t\t\t\t\tkind: HeroActivity.DEAD\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic deliverQuest() {\n\t\tif (this.activity.kind !== HeroActivity.QUEST_READY) {\n\t\t\tthrow new Error('Cannot deliver quest loot when not ready.');\n\t\t}\n\n\t\tthis.game.inventory.add(this.activity.loot);\n\t\tthis.level.xp += this.activity.xp;\n\t\tthis.state.patch({\n\t\t\tactivity: {\n\t\t\t\tkind: HeroActivity.IDLE\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic revive() {\n\t\tif (this.activity.kind !== HeroActivity.DEAD) {\n\t\t\tthrow new Error('Cannot revive hero when not dead.');\n\t\t}\n\n\t\tthis.health.reset();\n\t\tthis.state.patch({\n\t\t\tactivity: {\n\t\t\t\tkind: HeroActivity.IDLE\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic equip(newItemKey: string) {\n\t\tconst newItem = enumGet(ItemKinds, newItemKey);\n\t\tif (newItem.slot === undefined) {\n\t\t\tthrow new Error('This item does not fit into any slots.');\n\t\t}\n\n\t\tthis.game.inventory.remove([\n\t\t\t{\n\t\t\t\titemKey: newItemKey,\n\t\t\t\tquantity: 1\n\t\t\t}\n\t\t]);\n\n\t\tconst oldItemKey = this.equipment[newItem.slot];\n\t\tif (oldItemKey) {\n\t\t\t// since all equipment is non-stackable, at least one slot is surely free\n\t\t\tthis.game.inventory.add([\n\t\t\t\t{\n\t\t\t\t\titemKey: oldItemKey,\n\t\t\t\t\tquantity: 1\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t\tthis.state.patch({\n\t\t\tequipment: {\n\t\t\t\t...this.equipment,\n\t\t\t\t[newItem.slot]: newItemKey\n\t\t\t}\n\t\t});\n\t}\n\n\n\tpublic static readonly registry = new Registry<HeroInfo>();\n\n\tpublic static create(key: string): HeroState {\n\t\tconst entry = Hero.registry.get(key);\n\t\treturn {\n\t\t\tkey,\n\t\t\tequipment: entry.startEquipment,\n\t\t\thealthDeficit: 0,\n\t\t\trotation: entry.rotation,\n\t\t\txp: 0,\n\t\t\tactivity: {\n\t\t\t\tkind: HeroActivity.IDLE\n\t\t\t}\n\t\t};\n\t}\n}\n","export enum PlayerErrorKind {\n\t// recruitment\n\tRECRUITMENT_LIMIT_REACHED,\n\tCRAFTER_ALREADY_RECRUITED,\n\n\t// inventory\n\tNOT_ENOUGH_INVENTORY_SPACE,\n\tMISSING_REQUIRED_ITEMS\n}\n\nexport class PlayerError extends Error {\n\tprivate readonly isPlayerError = true;\n\n\tpublic constructor(\n\t\tpublic readonly kind: PlayerErrorKind,\n\t\tmessage?: string\n\t) {\n\t\tsuper(`${PlayerErrorKind[kind]}${message ? `: ${message}` : ''}`);\n\t}\n\n\tpublic static isPlayerError(ex: unknown): ex is PlayerError {\n\t\treturn typeof ex === 'object' && ex !== null && (ex as PlayerError).isPlayerError;\n\t}\n}\n","import type { Attribute, Attributes } from '~/game/entities/Attributes';\nimport { AppliedEffect, Effect, MutableAppliedEffect } from '~/game/entities/combat/Effect';\n\nimport { Combatant, CombatSide, SetMode } from './Combatant';\nimport { CombatEventKind } from './CombatEvent';\nimport type { LivingEntity } from './LivingEntity';\nimport type { OngoingCombatSimulator } from './types';\n\nexport class CombatParticipant implements Combatant {\n\tprivate _effects: MutableAppliedEffect[] = [];\n\tprivate attributeOverrides: Attributes = {};\n\n\tpublic constructor(\n\t\tprivate readonly simulator: OngoingCombatSimulator,\n\t\tpublic readonly entity: LivingEntity,\n\t\tpublic readonly side: CombatSide\n\t) {}\n\n\tpublic get effects(): readonly AppliedEffect[] {\n\t\treturn this._effects;\n\t}\n\n\tpublic get health() {\n\t\treturn this.entity.health.value;\n\t}\n\n\tpublic get isAlive() {\n\t\treturn this.entity.health.isAlive;\n\t}\n\n\tpublic damage(value: number, defenseAttribute?: Attribute) {\n\t\tconst defense = defenseAttribute === undefined ? 0 : this.getAttribute(defenseAttribute);\n\n\t\tconst adjusted = Math.max(value, 0) * (1 / (1 + defense / 11));\n\t\tconst change = this.setHealth(-adjusted);\n\t\tif (change === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.simulator.report({\n\t\t\tkind: CombatEventKind.DIRECT_DAMAGE,\n\t\t\thealthChange: change,\n\t\t\tsource: this.simulator.currentAttacker,\n\t\t\ttarget: this\n\t\t});\n\n\t\tif (!this.isAlive) {\n\t\t\tthis._effects = [];\n\t\t\tthis.simulator.report({\n\t\t\t\tkind: CombatEventKind.PARTICIPANT_DIED,\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic heal(value: number) {\n\t\tconst isRevive = !this.isAlive;\n\t\tconst change = this.setHealth(Math.max(value, 0));\n\t\tif (change === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.simulator.report({\n\t\t\tkind: CombatEventKind.DIRECT_HEAL,\n\t\t\thealthChange: change,\n\t\t\tsource: this.simulator.currentAttacker,\n\t\t\ttarget: this\n\t\t});\n\n\t\tif (isRevive) {\n\t\t\tthis.simulator.report({\n\t\t\t\tkind: CombatEventKind.PARTICIPANT_REVIVED,\n\t\t\t\trevivalHealth: change,\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic getAttribute(attribute: Attribute) {\n\t\treturn this.attributeOverrides[attribute] ?? this.entity.getAttribute(attribute);\n\t}\n\n\tpublic setAttribute(attribute: Attribute, value: number, mode: SetMode = SetMode.CONST) {\n\t\tlet override;\n\t\tswitch (mode) {\n\t\t\tcase SetMode.CONST:\n\t\t\t\toverride = value;\n\t\t\t\tbreak;\n\n\t\t\tcase SetMode.OFFSET:\n\t\t\t\toverride = this.getAttribute(attribute) + value;\n\t\t\t\tbreak;\n\n\t\t\tcase SetMode.MULTIPLIER:\n\t\t\t\toverride = this.getAttribute(attribute) * value;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.attributeOverrides[attribute] = override;\n\t}\n\n\tpublic addEffect(effect: Effect, param = 0) {\n\t\tif (!this.isAlive) {\n\t\t\treturn;\n\t\t}\n\n\t\t// try increase stack if enabled\n\t\tif (effect.maxStackCount > 0) {\n\t\t\tconst applied = this._effects.find(e => (\n\t\t\t\te.effectKey === effect.key &&\n\t\t\t\te.source === this.simulator.currentAttacker\n\t\t\t));\n\n\t\t\tif (applied) {\n\t\t\t\tapplied.remainingDuration = effect.duration;\n\t\t\t\tapplied.stackCount = Math.min(applied.stackCount + 1, effect.maxStackCount);\n\t\t\t\tthis.simulator.report({\n\t\t\t\t\tkind: CombatEventKind.EFFECT_STACKED,\n\t\t\t\t\teffectKey: effect.key,\n\t\t\t\t\tsource: this.simulator.currentAttacker,\n\t\t\t\t\ttarget: this,\n\t\t\t\t\tstackCount: applied.stackCount\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._effects.push({\n\t\t\teffectKey: effect.key,\n\t\t\tparam,\n\t\t\tsource: this.simulator.currentAttacker,\n\t\t\tremainingDuration: effect.duration,\n\t\t\tstackCount: 1\n\t\t});\n\n\t\tthis.simulator.report({\n\t\t\tkind: CombatEventKind.EFFECT_APPLIED,\n\t\t\teffectKey: effect.key,\n\t\t\tsource: this.simulator.currentAttacker,\n\t\t\ttarget: this\n\t\t});\n\t}\n\n\tpublic removeEffect(effect: AppliedEffect) {\n\t\tconst index = this._effects.indexOf(effect);\n\t\tif (index !== -1) {\n\t\t\tconst existing = this._effects[index];\n\t\t\tthis._effects.splice(index, 1);\n\t\t\tthis.simulator.report({\n\t\t\t\tkind: CombatEventKind.EFFECT_REMOVED,\n\t\t\t\teffectKey: existing.effectKey,\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic tickEffects() {\n\t\tthis.attributeOverrides = {};\n\n\t\tlet i = 0;\n\t\twhile (i < this._effects.length) {\n\t\t\tconst applied = this._effects[i];\n\t\t\tif (applied.remainingDuration === 0) {\n\t\t\t\tthis._effects.splice(i, 1);\n\t\t\t\tthis.simulator.report({\n\t\t\t\t\tkind: CombatEventKind.EFFECT_FADED,\n\t\t\t\t\teffectKey: applied.effectKey,\n\t\t\t\t\ttarget: this\n\t\t\t\t});\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t--applied.remainingDuration;\n\t\t\tthis.simulator.runEffect(this, applied);\n\t\t\t++i;\n\t\t}\n\t}\n\n\tprivate setHealth(offset: number) {\n\t\tconst oldHealth = this.entity.health.value;\n\t\tthis.entity.health.value = oldHealth + offset;\n\n\t\t// the underlying health property has setter logic, re-read the value after setting\n\t\tconst newHealth = this.entity.health.value;\n\t\tconst healthChange = newHealth - oldHealth;\n\t\tif (Math.abs(healthChange) < Number.EPSILON) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn healthChange;\n\t}\n}\n","import { enumGet } from '~/utils/enum';\n\nimport { Attacks } from './Attack';\nimport { Combatant, CombatSide } from './Combatant';\nimport { CombatEvent, CombatEventKind } from './CombatEvent';\nimport { CombatParticipant } from './CombatParticipant';\nimport { AppliedEffect, Effects } from './Effect';\nimport type { LivingEntity } from './LivingEntity';\nimport { CombatParticipants, CombatSimulator, OngoingCombatSimulator } from './types';\n\nexport interface CombatParticipantInit {\n\treadonly entity: LivingEntity;\n\treadonly side: CombatSide;\n}\n\nexport class ScopedCombatSimulator implements OngoingCombatSimulator, CombatSimulator {\n\tpublic readonly participants: CombatParticipants;\n\n\tprivate readonly events: CombatEvent[] = [];\n\tprivate readonly allParticipants: readonly CombatParticipant[];\n\tprivate _currentAttacker!: Combatant;\n\n\tprivate constructor(participantsInit: readonly CombatParticipantInit[]) {\n\t\tthis.allParticipants = participantsInit.map(init => new CombatParticipant(this, init.entity, init.side));\n\n\t\tconst evil = [];\n\t\tconst good = [];\n\t\tfor (const participant of this.allParticipants) {\n\t\t\tswitch (participant.side) {\n\t\t\t\tcase CombatSide.GOOD:\n\t\t\t\t\tgood.push(participant);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase CombatSide.EVIL:\n\t\t\t\t\tevil.push(participant);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis.participants = {\n\t\t\tevil,\n\t\t\tgood\n\t\t};\n\t}\n\n\n\tpublic get currentAttacker() {\n\t\treturn this._currentAttacker;\n\t}\n\n\n\tpublic run() {\n\t\t// run the simulation until members of one side are all dead\n\t\tlet round = 0;\n\t\tlet goodGuysAlive;\n\t\tdo {\n\t\t\tthis.report({\n\t\t\t\tkind: CombatEventKind.ROUND_START,\n\t\t\t\tround: (round + 1)\n\t\t\t});\n\n\t\t\tfor (const participant of this.allParticipants) {\n\t\t\t\tif (!participant.isAlive) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst { rotation } = participant.entity;\n\t\t\t\tconst attack = rotation[round % rotation.length];\n\n\t\t\t\tthis.runAttack(participant, attack);\n\t\t\t\tparticipant.tickEffects();\n\t\t\t}\n\n\t\t\tif (++round === 100) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\twhile ((goodGuysAlive = this.participants.good.some(isAlive)) && this.participants.evil.some(isAlive));\n\n\t\t// tick effects for good guys\n\t\tif (goodGuysAlive) {\n\t\t\tlet pendingEffects = this.participants.good.some(hasEffects);\n\t\t\twhile (pendingEffects) {\n\t\t\t\tthis.report({\n\t\t\t\t\tkind: CombatEventKind.ROUND_START,\n\t\t\t\t\tround: (round + 1)\n\t\t\t\t});\n\n\t\t\t\tpendingEffects = false;\n\t\t\t\tfor (const participant of this.participants.good) {\n\t\t\t\t\tif (hasEffects(participant)) {\n\t\t\t\t\t\tparticipant.tickEffects();\n\t\t\t\t\t\tpendingEffects = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (++round === 150) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.events;\n\t}\n\n\tpublic runAttack(attacker: Combatant, attackKey: string) {\n\t\tconst attack = enumGet(Attacks, attackKey);\n\t\tthis._currentAttacker = attacker;\n\t\tattack.execute(attacker, this.participants);\n\t}\n\n\tpublic runEffect(combatant: Combatant, applied: AppliedEffect) {\n\t\tconst effect = enumGet(Effects, applied.effectKey);\n\t\tthis._currentAttacker = applied.source;\n\t\teffect.tick.call(applied, combatant);\n\t}\n\n\tpublic report(event: CombatEvent) {\n\t\tthis.events.push(event);\n\t}\n\n\n\tpublic static create(participantsInit: readonly CombatParticipantInit[]): CombatSimulator {\n\t\treturn new ScopedCombatSimulator(participantsInit);\n\t}\n}\n\nfunction isAlive(participant: Combatant) {\n\treturn participant.isAlive;\n}\n\nfunction hasEffects(participant: Combatant) {\n\treturn participant.isAlive && participant.effects.length > 0;\n}\n","import type { StorageBackend } from './StateStorage';\n\nexport class NoOpStorageBackend<T> implements StorageBackend<T> {\n\tpublic constructor(\n\t\tprivate state: T\n\t) {}\n\n\tpublic get(): T {\n\t\treturn this.state;\n\t}\n\n\tpublic set(state: T) {\n\t\tthis.state = state;\n\t}\n}\n","import type { State } from '~/game/storage/State';\nimport { clamp } from '~/utils/math';\n\nimport { Attribute } from './Attributes';\nimport type { LivingEntity } from './combat/LivingEntity';\n\nexport class Health {\n\tpublic constructor(\n\t\tprivate readonly owner: LivingEntity,\n\t\tprivate readonly state: State<number>\n\t) {}\n\n\n\tpublic get value() {\n\t\treturn this.maxHealth - this.state.current;\n\t}\n\n\tpublic set value(value: number) {\n\t\tthis.state.set(\n\t\t\tclamp(this.maxHealth - value, 0, this.maxHealth)\n\t\t);\n\t}\n\n\tpublic get isAlive() {\n\t\treturn this.value > 0;\n\t}\n\n\tpublic get maxHealth() {\n\t\treturn 100 + this.owner.getAttribute(Attribute.STAMINA) * 5;\n\t}\n\n\n\tpublic reset() {\n\t\tthis.state.set(0);\n\t}\n}\n","import { Registry, RegistryEntry } from '~/game/Registry';\nimport { NoOpStorageBackend } from '~/game/storage/NoOpStorageBackend';\nimport { StateStorage } from '~/game/storage/StateStorage';\n\nimport type { Attribute, Attributes } from './Attributes';\nimport { AttackRotation } from './combat/Attack';\nimport type { LivingEntity } from './combat/LivingEntity';\nimport { Health } from './Health';\n\nexport interface EnemyInfo extends RegistryEntry {\n\treadonly attributes: Attributes;\n\treadonly icon: string;\n\treadonly rotation: AttackRotation;\n}\n\nexport class Enemy implements LivingEntity {\n\tpublic readonly health: Health;\n\n\tprivate readonly info: EnemyInfo;\n\n\tpublic constructor(\n\t\tpublic readonly key: string\n\t) {\n\t\tthis.info = Enemy.registry.get(key);\n\t\tthis.health = new Health(\n\t\t\tthis,\n\t\t\tnew StateStorage(\n\t\t\t\tnew NoOpStorageBackend(0)\n\t\t\t)\n\t\t);\n\t}\n\n\tpublic get rotation() {\n\t\treturn this.info.rotation;\n\t}\n\n\tpublic getAttribute(attribute: Attribute) {\n\t\treturn this.info.attributes[attribute] ?? 0;\n\t}\n\n\n\tpublic static readonly registry = new Registry<EnemyInfo>();\n}\n","import { PlayerError, PlayerErrorKind } from '~/game/PlayerError';\nimport { State } from '~/game/storage/State';\nimport { sum } from '~/utils/array';\nimport { enumGet } from '~/utils/enum';\n\nimport { ItemKinds } from './ItemKind';\nimport type { ItemStack } from './ItemStack';\n\nexport interface InventoryState {\n\treadonly capacity: number;\n\treadonly contents: readonly ItemStack[];\n}\n\nexport class Inventory {\n\tpublic constructor(\n\t\tprivate readonly state: State<InventoryState>\n\t) {}\n\n\tpublic get capacity() {\n\t\treturn this.state.current.capacity;\n\t}\n\n\tpublic set capacity(value: number) {\n\t\tif (value < this.state.current.contents.length) {\n\t\t\tthrow new Error('Cannot reduce capacity below currently occupied space.');\n\t\t}\n\n\t\tthis.state.patch({\n\t\t\tcapacity: value\n\t\t});\n\t}\n\n\tpublic get contents(): readonly ItemStack[] {\n\t\treturn this.state.current.contents;\n\t}\n\n\tpublic add(items: readonly ItemStack[]) {\n\t\tconst contents = this.contents.slice();\n\t\tfor (const item of items) {\n\t\t\tconst kind = enumGet(ItemKinds, item.itemKey);\n\n\t\t\tlet remaining = item.quantity;\n\t\t\tfor (let i = 0; i < contents.length && remaining > 0; ++i) {\n\t\t\t\tconst slot = contents[i];\n\t\t\t\tif (item.itemKey !== slot.itemKey) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst toAdd = Math.min(remaining, kind.maxStack - slot.quantity);\n\t\t\t\tcontents[i] = {\n\t\t\t\t\t...slot,\n\t\t\t\t\tquantity: slot.quantity + toAdd\n\t\t\t\t};\n\n\t\t\t\tremaining -= toAdd;\n\t\t\t}\n\n\t\t\twhile (remaining > 0) {\n\t\t\t\tif (contents.length === this.capacity) {\n\t\t\t\t\tthrow new PlayerError(PlayerErrorKind.NOT_ENOUGH_INVENTORY_SPACE);\n\t\t\t\t}\n\n\t\t\t\tcontents.push({\n\t\t\t\t\titemKey: item.itemKey,\n\t\t\t\t\tquantity: Math.min(remaining, kind.maxStack)\n\t\t\t\t});\n\n\t\t\t\tremaining -= kind.maxStack;\n\t\t\t}\n\t\t}\n\n\t\tthis.state.patch({ contents });\n\t}\n\n\tpublic remove(items: readonly ItemStack[]) {\n\t\tconst contents = this.contents.slice();\n\t\tfor (const item of items) {\n\t\t\tlet remaining = item.quantity;\n\t\t\tfor (let i = contents.length - 1; i >= 0 && remaining > 0; --i) {\n\t\t\t\tconst slot = contents[i];\n\t\t\t\tif (item.itemKey !== slot.itemKey) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (slot.quantity <= remaining) {\n\t\t\t\t\tcontents.splice(i, 1);\n\t\t\t\t\tremaining -= slot.quantity;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcontents[i] = {\n\t\t\t\t\t\t...slot,\n\t\t\t\t\t\tquantity: slot.quantity - remaining\n\t\t\t\t\t};\n\n\t\t\t\t\tremaining = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (remaining > 0) {\n\t\t\t\tthrow new PlayerError(PlayerErrorKind.MISSING_REQUIRED_ITEMS);\n\t\t\t}\n\t\t}\n\n\t\tthis.state.patch({ contents });\n\t}\n\n\tpublic count(itemKey: string) {\n\t\treturn sum(this.contents, slot => slot.itemKey === itemKey ? slot.quantity : 0);\n\t}\n}\n","export function ArrayBackend() {\n\tthis.$handlers = [];\n}\n\nArrayBackend.prototype.$snapshot = null;\n\nArrayBackend.prototype.$getSnapshot = function () {\n\tif (!this.$snapshot) {\n\t\tthis.$snapshot = this.$handlers.slice();\n\t}\n\n\treturn this.$snapshot;\n};\n\nArrayBackend.prototype.$add = function (handler) {\n\tthis.$handlers.push(handler);\n\tthis.$snapshot = null;\n};\n\nArrayBackend.prototype.$clear = function () {\n\tif (this.$handlers.length === 0) {\n\t\treturn false;\n\t}\n\n\tthis.$handlers = [];\n\tthis.$snapshot = null;\n\treturn true;\n};\n\nArrayBackend.prototype.$count = function () {\n\treturn this.$handlers.length;\n};\n\nArrayBackend.prototype.$delete = function (handler) {\n\tconst { $handlers } = this;\n\n\tlet index = $handlers.length - 1;\n\tlet current;\n\n\twhile (index >= 0) {\n\t\tcurrent = $handlers[index];\n\t\tif (current === handler || current.$once === handler) {\n\t\t\tbreak;\n\t\t}\n\n\t\t--index;\n\t}\n\n\tif (index === -1) {\n\t\treturn false;\n\t}\n\n\tthis.$handlers.splice(index, 1);\n\tthis.$snapshot = null;\n\treturn true;\n};\n\nArrayBackend.prototype.$deleteWrapped = function (handler) {\n\tconst index = this.$handlers.lastIndexOf(handler);\n\tif (index !== -1) {\n\t\tthis.$handlers.splice(index, 1);\n\t\tthis.$snapshot = null;\n\t}\n};\n","export function SetBackend() {\n\t// We use Set for all persistent handlers, but we must use an array for\n\t// 'once' handlers. We assume this array will be empty most of the time.\n\tthis.$persistent = new Set();\n\tthis.$oneshot = [];\n}\n\nSetBackend.prototype.$snapshot = null;\n\nSetBackend.prototype.$getSnapshot = function () {\n\tif (!this.$snapshot) {\n\t\tthis.$snapshot = Array.from(this.$persistent.values()).concat(this.$oneshot);\n\t}\n\n\treturn this.$snapshot;\n};\n\nSetBackend.prototype.$add = function (handler) {\n\tif (handler.$once) {\n\t\tif (this.$persistent.has(handler.$once)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$oneshot.push(handler);\n\t}\n\telse {\n\t\tthis.$persistent.add(handler);\n\t\tthis.$deleteOneshot(handler);\n\t}\n\n\tthis.$snapshot = null;\n};\n\nSetBackend.prototype.$clear = function () {\n\tif (this.$count()) {\n\t\tthis.$persistent.clear();\n\t\tthis.$oneshot = [];\n\t\tthis.$snapshot = null;\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\nSetBackend.prototype.$count = function () {\n\treturn this.$persistent.size + this.$oneshot.length;\n};\n\nSetBackend.prototype.$delete = function (handler) {\n\tif (this.$persistent.delete(handler)) {\n\t\tthis.$snapshot = null;\n\t\treturn true;\n\t}\n\n\treturn this.$deleteOneshot(handler);\n};\n\nSetBackend.prototype.$deleteWrapped = function (handler) {\n\tconst index = this.$oneshot.lastIndexOf(handler);\n\tif (index !== -1) {\n\t\tthis.$oneshot.splice(index, 1);\n\t\tthis.$snapshot = null;\n\t}\n};\n\nSetBackend.prototype.$deleteOneshot = function (handler) {\n\tlet index = this.$oneshot.length - 1;\n\twhile (index >= 0) {\n\t\tif (this.$oneshot[index].$once === handler) {\n\t\t\tthis.$oneshot.splice(index, 1);\n\t\t\tthis.$snapshot = null;\n\t\t\treturn true;\n\t\t}\n\n\t\t--index;\n\t}\n\n\treturn false;\n};\n","import type { AsyncSignalOptions, SignalBackend, WrappedSignalHandler } from '~/types';\n\nfunction isThennable(obj: any): obj is Promise<any> {\n\treturn obj && typeof obj.then === 'function';\n}\n\nfunction dispatchInParallel<T>(thisArg: any, snapshot: readonly WrappedSignalHandler<T>[], event: T) {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tconst { length } = snapshot;\n\t\tlet pending = 0;\n\n\t\tconst onHandlerResolved = () => {\n\t\t\tif (--pending === 0) {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t};\n\n\t\tfor (let index = 0; index < length; ++index) {\n\t\t\tconst result = snapshot[index].call(thisArg, event);\n\t\t\tif (isThennable(result)) {\n\t\t\t\t++pending;\n\t\t\t\tresult.then(onHandlerResolved, reject);\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction dispatchInSeries<T>(thisArg: any, snapshot: readonly WrappedSignalHandler<T>[], event: T) {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tconst { length } = snapshot;\n\t\tlet index = 0;\n\n\t\tconst next = () => {\n\t\t\tif (index >= length) {\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result = snapshot[index++].call(thisArg, event);\n\t\t\tif (isThennable(result)) {\n\t\t\t\tresult.then(next, reject);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tnext();\n\t\t\t}\n\t\t};\n\n\t\tnext();\n\t});\n}\n\nexport function createAsyncDispatcher<T = void>(backend: SignalBackend<T>, options?: AsyncSignalOptions) {\n\tconst run = options?.parallel ? dispatchInParallel : dispatchInSeries;\n\treturn function (this: any, event?: T) {\n\t\treturn run(this, backend.$getSnapshot(), event!);\n\t};\n}\n","import { ArrayBackend } from './backend/ArrayBackend';\nimport { SetBackend } from './backend/SetBackend';\nimport { createAsyncDispatcher } from './dispatcher/asyncDispatcher';\nimport { createSyncDispatcher } from './dispatcher/syncDispatcher';\nimport type {\n\tAsyncSignal,\n\tAsyncSignalOptions,\n\tSignal,\n\tSignalBackend,\n\tSignalBackendType,\n\tSignalHandler,\n\tSignalHandlerOptions,\n\tSignalOptions,\n\tSyncSignal,\n\tSyncSignalOptions\n} from './types';\n\nconst BACKEND_MAP: Record<SignalBackendType, (new <T>() => SignalBackend<T>) | undefined> = {\n\tarray: ArrayBackend,\n\tset: SetBackend\n};\n\n/**\n * Creates a new synchronous Signal instance.\n */\nexport function create<T = void>(options?: SyncSignalOptions): SyncSignal<T>;\n\n/**\n * Creates a new asynchronous Signal instance.\n */\nexport function create<T = void>(options?: AsyncSignalOptions): AsyncSignal<T>;\n\n/**\n * Creates a new Signal instance.\n */\nexport function create<T = void>(options?: SignalOptions): Signal<T>;\nexport function create<T = void>(options: SignalOptions = {}): Signal<T> {\n\tconst backend = new (BACKEND_MAP[options.backend!] ?? ArrayBackend)<T>();\n\tconst isAsync = options.async === true;\n\tconst dispatcher: any = isAsync\n\t\t? createAsyncDispatcher(backend, options)\n\t\t: createSyncDispatcher(backend, options as SyncSignalOptions);\n\n\tdispatcher.$backend = backend;\n\tdispatcher.isAsync = isAsync;\n\n\treturn dispatcher;\n}\n\n/**\n * Removes all handlers from the Signal.\n *\n * Returns a boolean indicating whether any handlers have been removed.\n */\nexport function off<T>(signal: Signal<T>): boolean;\n\n/**\n * Attempts to remove the given handler from the Signal.\n *\n * Returns a boolean indicating whether the handler has been removed.\n */\nexport function off<T>(signal: Signal<T>, handler: SignalHandler<T>): boolean;\nexport function off<T>(signal: Signal<T>, handler?: SignalHandler<T>): boolean {\n\treturn handler\n\t\t? signal.$backend.$delete(handler)\n\t\t: signal.$backend.$clear();\n}\n\n/**\n * Attaches a handler to a Signal that is automatically removed after its first\n * invocation.\n */\nexport function once<T>(signal: Signal<T>, handler: SignalHandler<T>): void {\n\tlet wasTriggered = false;\n\tconst wrapped = function (this: any, event?: T) {\n\t\tif (wasTriggered) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tsignal.$backend.$deleteWrapped(wrapped);\n\t\twasTriggered = true;\n\n\t\treturn handler.call(this, event!);\n\t};\n\n\twrapped.$once = handler;\n\tsignal.$backend.$add(wrapped);\n}\n\n/**\n * Attaches a handler to a Signal.\n */\nexport function on<T>(signal: Signal<T>, handler: SignalHandler<T>, options?: SignalHandlerOptions): void {\n\tif (options?.once) {\n\t\tonce(signal, handler);\n\t}\n\telse {\n\t\tsignal.$backend.$add(handler);\n\t}\n}\n\n/**\n * Attaches a handler to a Signal and returns a function that detaches it when\n * called.\n */\nexport function subscribe<T>(signal: Signal<T>, handler: SignalHandler<T>, options?: SignalHandlerOptions): () => void {\n\ton(signal, handler, options);\n\treturn () => off(signal, handler);\n}\n\n/**\n * Checks whether a signal has any handlers attached and triggers it providing\n * return value of the `lazyEvent` callback as the event data. This is a no-op\n * when the signal has no handlers attached.\n *\n * Returns (sync signals) or resolves to (async signals) a boolean indicating\n * whether the signal was triggered.\n */\nexport function lazy<T>(signal: SyncSignal<T>, lazyEvent: () => T): boolean;\nexport function lazy<T>(signal: AsyncSignal<T>, lazyEvent: () => T): Promise<boolean>;\nexport function lazy<T>(this: any, signal: Signal<T>, lazyEvent: () => T) {\n\tif (signal.$backend.$count()) {\n\t\tconst call = (signal as any).call(this, lazyEvent());\n\t\treturn signal.isAsync\n\t\t\t? (call as Promise<void>).then(() => true)\n\t\t\t: true;\n\t}\n\n\treturn signal.isAsync\n\t\t? Promise.resolve(false)\n\t\t: false;\n}\n","import * as Signal from '@calmdownval/signal';\n\nexport interface TimeSource {\n\tnow(): number;\n}\n\nexport interface ClockChangedEvent {\n\treadonly oldTime: number;\n\treadonly newTime: number;\n}\n\nexport class Clock {\n\tpublic readonly changed = Signal.create<ClockChangedEvent>();\n\n\tprivate offset: number;\n\n\tpublic constructor(\n\t\tpublic readonly timeSource: TimeSource = performance\n\t) {\n\t\t// set the correct time initially...\n\t\tthis.offset = Date.now() - timeSource.now();\n\t}\n\n\n\tpublic get now() {\n\t\treturn this.offset + this.timeSource.now();\n\t}\n\n\tpublic set now(newTime: number) {\n\t\tconst now = this.timeSource.now();\n\t\tconst oldTime = this.offset + now;\n\n\t\tthis.offset = newTime - now;\n\t\tthis.changed({\n\t\t\toldTime,\n\t\t\tnewTime\n\t\t});\n\t}\n}\n","import type { SignalBackend, SyncSignalOptions } from '~/types';\n\nexport function createSyncDispatcher<T = void>(backend: SignalBackend<T>, _options?: SyncSignalOptions) {\n\treturn function (this: any, event?: T) {\n\t\tconst snapshot = backend.$getSnapshot();\n\t\tconst { length } = snapshot;\n\n\t\tfor (let i = 0; i < length; ++i) {\n\t\t\tvoid snapshot[i].call(this, event!);\n\t\t}\n\t};\n}\n","import * as Signal from '@calmdownval/signal';\n\nimport { first } from '~/utils/array';\nimport { clamp } from '~/utils/math';\nimport { binarySearch } from '~/utils/order';\n\nimport type { Clock } from './Clock';\n\nexport interface TimerCallback {\n\t(now: number): void;\n}\n\ninterface Timer {\n\treadonly callback: TimerCallback;\n\treadonly handle: number;\n\treadonly interval?: number;\n\treadonly timestamp: number;\n}\n\nfunction compareTimers(a: Timer, b: Timer) {\n\treturn a.timestamp - b.timestamp;\n}\n\nexport class Scheduler {\n\tprivate handle?: number;\n\tprivate handleCounter = 0;\n\tprivate queue: Timer[] = [];\n\n\tpublic constructor(\n\t\tpublic readonly clock: Clock,\n\t\tprivate readonly maxTimeoutMs = 30_000\n\t) {\n\t\tSignal.on(clock.changed, this.scheduleNextTick);\n\t}\n\n\tpublic dispose() {\n\t\tSignal.off(this.clock.changed, this.scheduleNextTick);\n\t}\n\n\tpublic setTimeout(callback: TimerCallback, delay: number) {\n\t\treturn this.insertAndSchedule(callback, delay, false);\n\t}\n\n\tpublic setInterval(callback: TimerCallback, delay: number) {\n\t\treturn this.insertAndSchedule(callback, delay, true);\n\t}\n\n\tpublic scheduleCallbackAt(callback: TimerCallback, clockTimestamps: readonly number[]) {\n\t\tconst handle = ++this.handleCounter;\n\t\tfor (let i = 0; i < clockTimestamps.length; ++i) {\n\t\t\tthis.insert({\n\t\t\t\tcallback,\n\t\t\t\thandle,\n\t\t\t\ttimestamp: clockTimestamps[i]\n\t\t\t});\n\t\t}\n\n\t\treturn handle;\n\t}\n\n\tpublic clear(handle: number) {\n\t\tthis.queue = this.queue.filter(timer => timer.handle !== handle);\n\t\tthis.scheduleNextTick();\n\t}\n\n\tprivate insertAndSchedule(callback: TimerCallback, delay: number, isRecurring: boolean) {\n\t\tconst timer: Timer = {\n\t\t\tcallback,\n\t\t\thandle: ++this.handleCounter,\n\t\t\tinterval: isRecurring ? delay : undefined,\n\t\t\ttimestamp: this.clock.now + delay,\n\t\t};\n\n\t\tthis.insert(timer);\n\t\tthis.scheduleNextTick();\n\t\treturn timer.handle;\n\t}\n\n\tprivate insert(timer: Timer) {\n\t\tlet index = binarySearch(this.queue, timer, compareTimers);\n\t\tif (index < 0) {\n\t\t\tindex = -index - 1;\n\t\t}\n\t\telse {\n\t\t\tdo {\n\t\t\t\t++index;\n\t\t\t}\n\t\t\twhile (index < this.queue.length && compareTimers(this.queue[index], timer) === 0);\n\t\t}\n\n\t\tthis.queue.splice(index, 0, timer);\n\t}\n\n\tprivate readonly scheduleNextTick = () => {\n\t\tconst timestamp = first(this.queue)?.timestamp;\n\t\tif (timestamp === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cancelTick();\n\n\t\tconst delayMs = clamp(timestamp - this.clock.now, 0, this.maxTimeoutMs);\n\t\tthis.handle = setTimeout(this.tick, delayMs);\n\t};\n\n\tprivate cancelTick() {\n\t\tif (this.handle !== undefined) {\n\t\t\tclearTimeout(this.handle);\n\t\t\tthis.handle = undefined;\n\t\t}\n\t}\n\n\tprivate readonly tick = () => {\n\t\tconst { now } = this.clock;\n\t\tlet count = 0;\n\t\twhile (count < this.queue.length) {\n\t\t\tif (this.queue[count].timestamp > now) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t++count;\n\t\t}\n\n\t\tconst elapsed = this.queue.splice(0, count);\n\t\ttry {\n\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\tconst timer = elapsed[i];\n\t\t\t\ttimer.callback(now);\n\n\t\t\t\tif (timer.interval) {\n\t\t\t\t\tthis.insert({\n\t\t\t\t\t\t...timer,\n\t\t\t\t\t\ttimestamp: now + timer.interval\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tthis.handle = undefined;\n\t\t\tthis.scheduleNextTick();\n\t\t}\n\t};\n}\n","/**\n * Represents a comparison function typically used for sorting. The return value\n * indicates the order:\n *\n * - Values <0 indicate A precedes B\n * - Values >0 indicate B precedes A\n * - Value of 0 indicates A = B\n */\nexport interface Compare<T> {\n\t(a: T, b: T): number;\n}\n\n/**\n * Searches for an item within a sorted array using the binary search algorithm.\n * The array is assumed to be sorted in ascending order according to the compare\n * function, otherwise the behavior of this function is undefined.\n *\n * If an equal item is found, its index is returned. Otherwise the insertion\n * index is returned as `-index - 1`.\n *\n * If multiple equal items are present, there is no guarantee which index will\n * be returned.\n * @param array The sorted array of items\n * @param compare The compare function\n */\nexport function binarySearch<T>(sortedArray: readonly T[], item: T, compare: Compare<T>) {\n\tlet min = 0;\n\tlet max = sortedArray.length;\n\tlet mid;\n\tlet test;\n\n\twhile (min < max) {\n\t\tmid = (min + max) >>> 1;\n\t\ttest = compare(item, sortedArray[mid]);\n\n\t\tif (test > 0) {\n\t\t\tmin = mid + 1;\n\t\t}\n\t\telse if (test < 0) {\n\t\t\tmax = mid;\n\t\t}\n\t\telse {\n\t\t\treturn mid;\n\t\t}\n\t}\n\n\treturn -min - 1;\n}\n","import { Crafter } from '~/game/entities/Crafter';\nimport { ItemKinds } from '~/game/items/ItemKind';\n\nCrafter.registry.add({\n\tkey: 'HERBALIST',\n\ticon: '⚗️',\n\trecipes: [\n\t\t{\n\t\t\tresult: {\n\t\t\t\titemKey: ItemKinds.HEALTH_POTION.key,\n\t\t\t\tquantity: 1\n\t\t\t},\n\t\t\tminLevel: 1,\n\t\t\tbaseDurationMs: 5 * 1000,\n\t\t\tmaterials: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.BERRY.key,\n\t\t\t\t\tquantity: 2\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\tresult: {\n\t\t\t\titemKey: ItemKinds.COCAINE.key,\n\t\t\t\tquantity: 1\n\t\t\t},\n\t\t\tminLevel: 1,\n\t\t\tbaseDurationMs: 10 * 1000,\n\t\t\tmaterials: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.COCA_LEAVES.key,\n\t\t\t\t\tquantity: 2\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t]\n});\n","import { Crafter } from '~/game/entities/Crafter';\nimport { ItemKinds } from '~/game/items/ItemKind';\n\nCrafter.registry.add({\n\tkey: 'BLACKSMITH',\n\ticon: '🔨',\n\trecipes: [\n\t\t{\n\t\t\tresult: {\n\t\t\t\titemKey: ItemKinds.SWORD.key,\n\t\t\t\tquantity: 1\n\t\t\t},\n\t\t\tminLevel: 1,\n\t\t\tbaseDurationMs: 5 * 1000,\n\t\t\tmaterials: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.STONE.key,\n\t\t\t\t\tquantity: 3\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.WOODEN_LOG.key,\n\t\t\t\t\tquantity: 2\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t]\n});\n","import { Crafter } from '~/game/entities/Crafter';\nimport { ItemKinds } from '~/game/items/ItemKind';\n\nCrafter.registry.add({\n\tkey: 'CARVER',\n\ticon: '🪵',\n\trecipes: [\n\t\t{\n\t\t\tresult: {\n\t\t\t\titemKey: ItemKinds.STAFF.key,\n\t\t\t\tquantity: 1\n\t\t\t},\n\t\t\tminLevel: 1,\n\t\t\tbaseDurationMs: 5 * 1000,\n\t\t\tmaterials: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.WOODEN_LOG.key,\n\t\t\t\t\tquantity: 2\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.SKULL.key,\n\t\t\t\t\tquantity: 1\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t]\n});\n","import { Attribute } from '~/game/entities/Attributes';\nimport { Attacks } from '~/game/entities/combat/Attack';\nimport { Enemy } from '~/game/entities/Enemy';\n\nEnemy.registry.add({\n\tkey: 'GATHERING_BUSH',\n\ticon: '🌳',\n\tattributes: {\n\t\t[Attribute.STAMINA]: 10\n\t},\n\trotation: [\n\t\tAttacks.NONE.key,\n\t\tAttacks.NONE.key,\n\t\tAttacks.NONE.key\n\t]\n});\n","import { Attribute } from '../Attributes';\nimport { Attacks } from '../combat/Attack';\nimport { Enemy } from '../Enemy';\n\nEnemy.registry.add({\n\tkey: 'IRON_GOLEM',\n\ticon: '🗿',\n\tattributes: {\n\t\t[Attribute.STRENGTH]: 50,\n\t\t[Attribute.STAMINA]: 50\n\t},\n\trotation: [\n\t\tAttacks.LUNGE.key,\n\t\tAttacks.LUNGE.key,\n\t\tAttacks.LUNGE.key\n\t]\n});\n","import { Attribute } from '~/game/entities/Attributes';\nimport { Attacks } from '~/game/entities/combat/Attack';\nimport { Enemy } from '~/game/entities/Enemy';\n\nEnemy.registry.add({\n\tkey: 'SKELETON',\n\ticon: '💀',\n\tattributes: {\n\t\t[Attribute.STAMINA]: 5,\n\t\t[Attribute.STRENGTH]: 5,\n\t\t[Attribute.MAGIC_DEFENSE]: 15,\n\t\t[Attribute.PHYSICAL_DEFENSE]: 5\n\t},\n\trotation: [\n\t\tAttacks.LUNGE.key,\n\t\tAttacks.LUNGE.key,\n\t\tAttacks.LUNGE.key\n\t]\n});\n","import { Attribute } from '../Attributes';\nimport { Attacks } from '../combat/Attack';\nimport { Enemy } from '../Enemy';\n\nEnemy.registry.add({\n\tkey: 'STONER',\n\ticon: '🗿',\n\tattributes: {\n\t\t[Attribute.STAMINA]: 10,\n\t\t[Attribute.STRENGTH]: 5,\n\t\t[Attribute.MAGIC_DEFENSE]: 5,\n\t\t[Attribute.PHYSICAL_DEFENSE]: 15\n\t},\n\trotation: [\n\t\tAttacks.LUNGE.key,\n\t\tAttacks.LUNGE.key,\n\t\tAttacks.LUNGE.key\n\t]\n});\n","import { Attribute } from '../Attributes';\nimport { Attacks } from '../combat/Attack';\nimport { Enemy } from '../Enemy';\n\nEnemy.registry.add({\n\tkey: 'TREE_GUY',\n\ticon: '🌲',\n\tattributes: {\n\t\t[Attribute.STAMINA]: 5,\n\t\t[Attribute.INTELLECT]: 5,\n\t\t[Attribute.MAGIC_DEFENSE]: 10,\n\t\t[Attribute.PHYSICAL_DEFENSE]: 10\n\t},\n\trotation: [\n\t\tAttacks.FIREBALL.key,\n\t\tAttacks.FIREBALL.key,\n\t\tAttacks.FIREBALL.key\n\t]\n});\n","import { Attribute } from '~/game/entities/Attributes';\nimport { Attacks } from '~/game/entities/combat/Attack';\nimport { Enemy } from '~/game/entities/Enemy';\n\nEnemy.registry.add({\n\tkey: 'COCA_PLANT',\n\ticon: '🪴',\n\tattributes: {\n\t\t[Attribute.STAMINA]: 30\n\t},\n\trotation: [\n\t\tAttacks.NONE.key,\n\t\tAttacks.NONE.key,\n\t\tAttacks.NONE.key\n\t]\n});\n","import { Attribute } from '~/game/entities/Attributes';\nimport { Attacks } from '~/game/entities/combat/Attack';\nimport { Hero } from '~/game/entities/Hero';\nimport { EquipmentSlot } from '~/game/items/EquipmentSlot';\nimport { ItemKinds } from '~/game/items/ItemKind';\n\nHero.registry.add({\n\tkey: 'MAGE',\n\ticon: '🧙',\n\tbaseAttributes: {\n\t\t[Attribute.STAMINA]: 15,\n\t\t[Attribute.INTELLECT]: 10,\n\t\t[Attribute.MAGIC_DEFENSE]: 20\n\t},\n\tlevelAdvancement: {\n\t\t[Attribute.STAMINA]: 2,\n\t\t[Attribute.INTELLECT]: 2,\n\t\t[Attribute.MAGIC_DEFENSE]: 5\n\t},\n\trotation: [\n\t\tAttacks.FIREBALL.key,\n\t\tAttacks.FIREBALL.key,\n\t\tAttacks.FIREBALL.key\n\t],\n\tstartEquipment: {\n\t\t[EquipmentSlot.WEAPON]: ItemKinds.STAFF.key\n\t\t// [EquipmentSlot.HEAD]:\n\t\t// [EquipmentSlot.CHEST]:\n\t\t// [EquipmentSlot.LEGS]:\n\t\t// [EquipmentSlot.FEET]:\n\t\t// [EquipmentSlot.RING]:\n\t}\n});\n","import { Attribute } from '~/game/entities/Attributes';\nimport { Attacks } from '~/game/entities/combat/Attack';\nimport { Hero } from '~/game/entities/Hero';\nimport { EquipmentSlot } from '~/game/items/EquipmentSlot';\nimport { ItemKinds } from '~/game/items/ItemKind';\n\nHero.registry.add({\n\tkey: 'WARRIOR',\n\ticon: '🧝',\n\tbaseAttributes: {\n\t\t[Attribute.STAMINA]: 20,\n\t\t[Attribute.STRENGTH]: 10,\n\t\t[Attribute.PHYSICAL_DEFENSE]: 20\n\t},\n\tlevelAdvancement: {\n\t\t[Attribute.STAMINA]: 5,\n\t\t[Attribute.STRENGTH]: 2,\n\t\t[Attribute.PHYSICAL_DEFENSE]: 5\n\t},\n\trotation: [\n\t\tAttacks.SUNDER.key,\n\t\tAttacks.LUNGE.key,\n\t\tAttacks.LUNGE.key\n\t],\n\tstartEquipment: {\n\t\t[EquipmentSlot.WEAPON]: ItemKinds.SWORD.key,\n\t\t[EquipmentSlot.HEAD]: ItemKinds.CHAIN_HOOD.key,\n\t\t[EquipmentSlot.CHEST]: ItemKinds.CHAIN_VEST.key,\n\t\t[EquipmentSlot.LEGS]: ItemKinds.CHAIN_LEGGINGS.key,\n\t\t// [EquipmentSlot.FEET]:\n\t\t[EquipmentSlot.RING]: ItemKinds.APPRENTICE_RING.key\n\t}\n});\n","import { ItemKinds } from '~/game/items/ItemKind';\nimport { questRegistry } from '~/game/quests/Quest';\n\nquestRegistry.add({\n\tkey: 'GATHERING_1',\n\tenemyKey: 'GATHERING_BUSH',\n\tbaseDurationMs: 10 * 1000,\n\txpModifier: 0.333,\n\tlevelRequirement: 1,\n\tlootTable: [\n\t\t{\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.BERRY.key,\n\t\t\t\t\tmaxQuantity: 5,\n\t\t\t\t\tminQuantity: 2\n\t\t\t\t}\n\t\t\t],\n\t\t\tprobability: 100\n\t\t}\n\t]\n});\n\nquestRegistry.add({\n\tkey: 'STONER',\n\tenemyKey: 'STONER',\n\tbaseDurationMs: 15 * 1000,\n\txpModifier: 0.2,\n\tlevelRequirement: 2,\n\tlootTable: [\n\t\t{\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.STONE.key,\n\t\t\t\t\tmaxQuantity: 5,\n\t\t\t\t\tminQuantity: 2\n\t\t\t\t}\n\t\t\t],\n\t\t\tprobability: 100\n\t\t}\n\t]\n});\n\nquestRegistry.add({\n\tkey: 'TREE_GUY',\n\tenemyKey: 'TREE_GUY',\n\tbaseDurationMs: 15 * 1000,\n\txpModifier: 0.2,\n\tlevelRequirement: 2,\n\tlootTable: [\n\t\t{\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.WOODEN_LOG.key,\n\t\t\t\t\tmaxQuantity: 5,\n\t\t\t\t\tminQuantity: 2\n\t\t\t\t}\n\t\t\t],\n\t\t\tprobability: 100\n\t\t}\n\t]\n});\n\nquestRegistry.add({\n\tkey: 'SKELETON',\n\tenemyKey: 'SKELETON',\n\tbaseDurationMs: 30 * 1000,\n\txpModifier: 0.3,\n\tlevelRequirement: 3,\n\tlootTable: [\n\t\t{\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.BONE.key,\n\t\t\t\t\tmaxQuantity: 3,\n\t\t\t\t\tminQuantity: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprobability: 75\n\t\t},\n\t\t{\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.BONE.key,\n\t\t\t\t\tmaxQuantity: 2,\n\t\t\t\t\tminQuantity: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.SKULL.key,\n\t\t\t\t\tmaxQuantity: 1,\n\t\t\t\t\tminQuantity: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprobability: 25\n\t\t}\n\t]\n});\n\nquestRegistry.add({\n\tenemyKey: 'IRON_GOLEM',\n\tkey: 'IRON_GOLEM',\n\tbaseDurationMs: 5 * 60 * 1000,\n\txpModifier: 1,\n\tlevelRequirement: 5,\n\tlootTable: []\n});\n\nquestRegistry.add({\n\tenemyKey: 'COCA_PLANT',\n\tkey: 'GATHERING_2',\n\tbaseDurationMs: 20 * 1000,\n\txpModifier: 0.2,\n\tlevelRequirement: 5,\n\tlootTable: [\n\t\t{\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\titemKey: ItemKinds.COCA_LEAVES.key,\n\t\t\t\t\tmaxQuantity: 5,\n\t\t\t\t\tminQuantity: 2\n\t\t\t\t}\n\t\t\t],\n\t\t\tprobability: 100\n\t\t}\n\t]\n});\n","import { MAX_HEROES } from '~/game/constants';\nimport { Crafter, CrafterState } from '~/game/entities/Crafter';\nimport { Hero, HeroState } from '~/game/entities/Hero';\nimport { Inventory, InventoryState } from '~/game/items/Inventory';\nimport { PlayerError, PlayerErrorKind } from '~/game/PlayerError';\nimport { StateStorage } from '~/game/storage/StateStorage';\nimport { Clock } from '~/game/time/Clock';\nimport { Scheduler } from '~/game/time/Scheduler';\n\nimport '~/game/entities/crafters';\nimport '~/game/entities/enemies';\nimport '~/game/entities/heroes';\nimport '~/game/quests';\n\nexport interface TraderGameState {\n\treadonly crafters: CrafterState[];\n\treadonly heroes: HeroState[];\n\treadonly inventory: InventoryState;\n}\n\nexport class TraderGame {\n\tpublic readonly clock: Clock;\n\tpublic readonly scheduler: Scheduler;\n\tpublic readonly inventory: Inventory;\n\n\tprivate readonly _crafters: Crafter[];\n\tprivate readonly _heroes: Hero[];\n\n\tpublic constructor(\n\t\tprivate readonly state: StateStorage<TraderGameState>\n\t) {\n\t\tthis.clock = new Clock();\n\t\tthis.scheduler = new Scheduler(this.clock);\n\n\t\tstate.init({\n\t\t\tcrafters: [\n\t\t\t\tCrafter.create('BLACKSMITH'),\n\t\t\t\tCrafter.create('CARVER'),\n\t\t\t\tCrafter.create('HERBALIST')\n\t\t\t],\n\t\t\theroes: [ Hero.create('WARRIOR') ],\n\t\t\tinventory: {\n\t\t\t\tcapacity: 40,\n\t\t\t\tcontents: []\n\t\t\t}\n\t\t});\n\n\t\tconst cs = state.subState('crafters');\n\t\tthis._crafters = state.current.crafters.map((_, index) => new Crafter(this, cs.subState(index)));\n\n\t\tconst hs = state.subState('heroes');\n\t\tthis._heroes = state.current.heroes.map((_, index) => new Hero(this, hs.subState(index)));\n\n\t\tthis.inventory = new Inventory(\n\t\t\tstate.subState('inventory')\n\t\t);\n\t}\n\n\n\tpublic get crafters(): readonly Crafter[] {\n\t\treturn this._crafters;\n\t}\n\n\tpublic get heroes(): readonly Hero[] {\n\t\treturn this._heroes;\n\t}\n\n\n\tpublic recruitHero(key: string) {\n\t\tconst { heroes } = this.state.current;\n\t\tif (heroes.length === MAX_HEROES) {\n\t\t\tthrow new PlayerError(PlayerErrorKind.RECRUITMENT_LIMIT_REACHED);\n\t\t}\n\n\t\tthis.state.patch({\n\t\t\theroes: [\n\t\t\t\t...heroes,\n\t\t\t\tHero.create(key)\n\t\t\t]\n\t\t});\n\n\t\tthis._heroes.push(new Hero(\n\t\t\tthis,\n\t\t\tthis.state\n\t\t\t\t.subState('heroes')\n\t\t\t\t.subState(heroes.length)\n\t\t));\n\t}\n\n\tpublic recruitCrafter(key: string) {\n\t\tconst { crafters } = this.state.current;\n\t\tif (crafters.some(crafter => crafter.key === key)) {\n\t\t\tthrow new PlayerError(PlayerErrorKind.CRAFTER_ALREADY_RECRUITED);\n\t\t}\n\n\t\tthis.state.patch({\n\t\t\tcrafters: [\n\t\t\t\t...crafters,\n\t\t\t\tCrafter.create(key)\n\t\t\t]\n\t\t});\n\n\t\tthis._crafters.push(new Crafter(\n\t\t\tthis,\n\t\t\tthis.state\n\t\t\t\t.subState('crafters')\n\t\t\t\t.subState(crafters.length)\n\t\t));\n\t}\n}\n","export const CRAFTERS = 'CRAFTERS';\nexport const CRAFTER_RECRUIT = 'CRAFTER_RECRUIT';\nexport const CRAFTING_LIST = 'CRAFTING_LIST';\nexport const CRAFTING_RECIPE = 'CRAFTING_RECIPE';\nexport const CRAFTING_END = 'CRAFTING_END';\n\nexport const INVENTORY = 'INVENTORY';\n\nexport const SHOP = 'SHOP';\n\nexport const HEROES = 'HEROES';\nexport const HERO_RECRUIT = 'HERO_RECRUIT';\nexport const HERO_EDIT = 'HERO_EDIT';\nexport const HERO_EQUIP_ITEM = 'HERO_EQUIP_ITEM';\nexport const HERO_DEATH = 'HERO_DEATH';\nexport const HERO_HEAL_SCREEN = 'HERO_HEAL_SCREEN';\nexport const QUEST_SELECT = 'QUEST_SELECT';\nexport const QUEST_START = 'QUEST_START';\nexport const QUEST_END = 'QUEST_END';\n","import { ComponentChildren, h, RenderableProps } from 'preact';\n\nimport { cx } from '~/utils/style';\n\nimport './FlatLayout.css';\n\nexport interface FlatLayoutProps {\n\treadonly class?: string;\n\treadonly header?: ComponentChildren;\n}\n\nexport const FlatLayout = ({ class: customClass, children }: RenderableProps<FlatLayoutProps>) => (\n\t<div class={cx('flat-layout', customClass)}>\n\t\t{children}\n\t</div>\n);\n","import { h, RenderableProps } from 'preact';\n\nimport { bem, cx } from '~/utils/style';\n\nimport './Typography.css';\n\ninterface TypographyProps {\n\treadonly class?: string;\n}\n\nexport const MainHeader = ({ class: customClass, children }: RenderableProps<TypographyProps>) => (\n\t<h2 class={cx(bem('typography-header', { main: true }), customClass)}>\n\t\t{children}\n\t</h2>\n);\n\nexport const SubHeader = ({ class: customClass, children }: RenderableProps<TypographyProps>) => (\n\t<h3 class={cx(bem('typography-header', { sub: true }), customClass)}>\n\t\t{children}\n\t</h3>\n);\n","import { useReducer } from 'preact/hooks';\n\nfunction flipReducer(state: boolean) {\n\treturn !state;\n}\n\nexport function useForceUpdate() {\n\treturn useReducer(flipReducer, false)[1] as () => void;\n}\n","import { useEffect } from 'preact/hooks';\n\nimport { Scheduler } from '~/game/time/Scheduler';\n\nimport { useForceUpdate } from './useForceUpdate';\n\nexport function useScheduledUpdates(scheduler: Scheduler, timestamps: readonly number[]) {\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tif (timestamps.length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst handle = scheduler.scheduleCallbackAt(forceUpdate, timestamps);\n\t\treturn () => scheduler.clear(handle);\n\t}, timestamps);\n}\n","import { Phrase, useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport type { Scheduler } from '~/game/time/Scheduler';\nimport { usePeriodicUpdates } from '~/hooks/usePeriodicUpdates';\n\nexport interface CountdownProps {\n\treadonly scheduler: Scheduler;\n\treadonly timestamp: number;\n}\n\nexport const Countdown = ({ scheduler, timestamp }: CountdownProps) => {\n\tconst { t } = useIntl();\n\tconst remainingMs = timestamp - scheduler.clock.now;\n\tusePeriodicUpdates(scheduler, remainingMs > 0 ? 1000 : undefined);\n\n\treturn (\n\t\t<span class='countdown'>\n\t\t\t{t(formatTimeRemainder(remainingMs))}\n\t\t</span>\n\t);\n};\n\nconst units = [\n\t{\n\t\tkey: 'ui.time.days',\n\t\tms: 86_400_000\n\t},\n\t{\n\t\tkey: 'ui.time.hours',\n\t\tms: 3_600_000\n\t},\n\t{\n\t\tkey: 'ui.time.minutes',\n\t\tms: 60_000\n\t},\n\t{\n\t\tkey: 'ui.time.seconds',\n\t\tms: 1_000\n\t}\n];\n\nfunction formatTimeRemainder(remainingMs: number): Phrase {\n\tfor (const unit of units) {\n\t\tconst remaining = Math.floor(remainingMs / unit.ms);\n\t\tif (remaining >= 1) {\n\t\t\treturn {\n\t\t\t\tkey: unit.key,\n\t\t\t\tvars: { remaining }\n\t\t\t};\n\t\t}\n\t}\n\n\treturn { text: '' };\n}\n","import { useEffect } from 'preact/hooks';\n\nimport { Scheduler } from '~/game/time/Scheduler';\n\nimport { useForceUpdate } from './useForceUpdate';\n\nexport function usePeriodicUpdates(scheduler: Scheduler, interval?: number) {\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tif (interval === undefined || interval < 1) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst handle = scheduler.setInterval(forceUpdate, interval);\n\t\treturn () => scheduler.clear(handle);\n\t}, [ interval ]);\n}\n","import { h } from 'preact';\n\nimport { cx } from '~/utils/style';\n\nimport './Icon.css';\n\nexport interface IconProps {\n\treadonly class?: string;\n\treadonly icon?: string;\n\treadonly onClick?: () => void;\n\treadonly quantity?: number;\n}\n\nexport const Icon = ({\n\tclass: customClass,\n\ticon,\n\tonClick,\n\tquantity\n}: IconProps) => (\n\t<div\n\t\tclass={cx('icon', customClass)}\n\t\tonClick={onClick}\n\t>\n\t\t<svg viewBox='0 0 100 100'>\n\t\t\t<text\n\t\t\t\tstyle='font-size: 80'\n\t\t\t\talignment-baseline='middle'\n\t\t\t\ttext-anchor='middle'\n\t\t\t\tx={50}\n\t\t\t\ty={60}\n\t\t\t>\n\t\t\t\t{icon}\n\t\t\t</text>\n\t\t</svg>\n\t\t{icon && quantity && (\n\t\t\t<span class='icon__quantity'>\n\t\t\t\t{quantity}\n\t\t\t</span>\n\t\t)}\n\t</div>\n);\n","import { ComponentChildren, h, RenderableProps } from 'preact';\n\nimport { Button } from '~/components/Button';\nimport { Icon } from '~/components/Icon';\nimport { SubHeader } from '~/components/Typography';\nimport { bem, cx } from '~/utils/style';\n\nimport './EntryCard.css';\n\nexport interface EntryCardProps {\n\treadonly action?: () => void;\n\treadonly actionContent?: ComponentChildren;\n\treadonly actionDisabled?: boolean;\n\treadonly class?: string;\n\treadonly icon?: string;\n\treadonly quantity?: number;\n\treadonly secondaryAction?: () => void;\n\treadonly title?: string;\n}\n\nexport const EntryCard = ({\n\taction,\n\tactionContent = '➡️',\n\tactionDisabled = false,\n\tchildren,\n\tclass: customClass,\n\ticon,\n\tquantity,\n\tsecondaryAction,\n\ttitle\n}: RenderableProps<EntryCardProps>) => (\n\t<div class={cx(bem('entry-card', { 'has-action': Boolean(action) }), customClass)}>\n\t\t<Icon\n\t\t\tclass='entry-card__icon'\n\t\t\ticon={icon}\n\t\t\tquantity={quantity}\n\t\t\tonClick={secondaryAction}\n\t\t/>\n\t\t<div class='entry-card__meta'>\n\t\t\t{title && (\n\t\t\t\t<SubHeader>\n\t\t\t\t\t{title}\n\t\t\t\t</SubHeader>\n\t\t\t)}\n\t\t\t{children}\n\t\t</div>\n\t\t{action && (\n\t\t\t<Button\n\t\t\t\tclass='entry-card__action'\n\t\t\t\tdisabled={actionDisabled}\n\t\t\t\tonClick={() => action()}\n\t\t\t>\n\t\t\t\t{actionContent}\n\t\t\t</Button>\n\t\t)}\n\t</div>\n);\n","import { h } from 'preact';\nimport { useLayoutEffect, useRef } from 'preact/hooks';\n\nimport { cx } from '~/utils/style';\n\nimport './ProgressBar.css';\n\nexport interface ProgressBarProps {\n\treadonly class?: string;\n\treadonly formatValue?: (value: number) => string;\n\treadonly hideLabel?: boolean;\n\treadonly maxValue: number;\n\treadonly title?: string;\n\treadonly value: number;\n}\n\nexport function toIntString(value: number) {\n\treturn Math.trunc(value).toString();\n}\n\nexport const ProgressBar = ({\n\tclass: customClass,\n\tformatValue = toIntString,\n\thideLabel,\n\tmaxValue,\n\ttitle,\n\tvalue\n}: ProgressBarProps) => {\n\tconst wrapperRef = useRef<HTMLElement>();\n\tuseLayoutEffect(() => {\n\t\twrapperRef.current?.style.setProperty('--progress', '' + (value / maxValue));\n\t}, [ value, maxValue ]);\n\n\treturn (\n\t\t<div\n\t\t\tclass={cx('progress-bar', customClass)}\n\t\t\tref={wrapperRef as any}\n\t\t>\n\t\t\t<div class='progress-bar__indicator' />\n\t\t\t{!hideLabel && (\n\t\t\t\t<span class='progress-bar__label'>\n\t\t\t\t\t{`${title ? `${title}: ` : ''}${formatValue(value)} / ${formatValue(maxValue)}`}\n\t\t\t\t</span>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","import { CrafterActivity } from '~/game/entities/Crafter';\n\nimport { CrafterCraftPendingEntryRenderer } from './CrafterCraftPendingEntryRenderer';\nimport { CrafterCraftReadyEntryRenderer } from './CrafterCraftReadyEntryRenderer';\nimport { CrafterIdleEntryRenderer } from './CrafterIdleEntryRenderer';\nimport type { CrafterEntryRenderer, CrafterEntryRendererArgs } from './types';\n\nconst activityMap: Record<CrafterActivity, CrafterEntryRenderer<any>> = {\n\t[CrafterActivity.IDLE]: CrafterIdleEntryRenderer,\n\t[CrafterActivity.CRAFT_PENDING]: CrafterCraftPendingEntryRenderer,\n\t[CrafterActivity.CRAFT_READY]: CrafterCraftReadyEntryRenderer,\n};\n\nexport const renderCrafterEntry = (args: CrafterEntryRendererArgs) => (\n\tactivityMap[args.crafter.activity.kind](args.crafter.activity, args)\n);\n","import { h } from 'preact';\n\nimport { EntryCard } from '~/components/EntryCard';\nimport { ProgressBar } from '~/components/ProgressBar';\nimport type { CrafterIdleActivity } from '~/game/entities/Crafter';\nimport * as Route from '~/routes';\n\nimport type { CrafterEntryRenderer } from './types';\n\nexport const CrafterIdleEntryRenderer: CrafterEntryRenderer<CrafterIdleActivity> = (_activity, {\n\tcrafter,\n\trouter,\n\tt,\n\t...rest\n}) => (\n\t<EntryCard\n\t\t{...rest}\n\t\taction={() => router.navigate(Route.CRAFTING_LIST, { crafter })}\n\t>\n\t\t<ProgressBar\n\t\t\tvalue={crafter.level.xpThisLevel}\n\t\t\tmaxValue={crafter.level.xpRequiredForNextLevel}\n\t\t/>\n\t</EntryCard>\n);\n","import { h } from 'preact';\n\nimport { Countdown } from '~/components/Countdown';\nimport { EntryCard } from '~/components/EntryCard';\nimport { SubHeader } from '~/components/Typography';\nimport type { CrafterCraftPendingActivity } from '~/game/entities/Crafter';\nimport * as Route from '~/routes';\n\nimport type { CrafterEntryRenderer } from './types';\n\nexport const CrafterCraftPendingEntryRenderer: CrafterEntryRenderer<CrafterCraftPendingActivity> = (activity, {\n\tgame,\n\tcrafter,\n\trouter,\n\tt,\n\t...rest\n}) => {\n\tconst remainingTimeMs = activity.elapsesAt - game.clock.now;\n\treturn (\n\t\t<EntryCard\n\t\t\t{...rest}\n\t\t\taction={() => {\n\t\t\t\tcrafter.completeCraft();\n\t\t\t\trouter.navigate(Route.CRAFTING_END, { crafter });\n\t\t\t}}\n\t\t\tactionDisabled={remainingTimeMs > 0}\n\t\t\tactionContent={remainingTimeMs > 0\n\t\t\t\t? (\n\t\t\t\t\t<Countdown\n\t\t\t\t\t\tscheduler={game.scheduler}\n\t\t\t\t\t\ttimestamp={activity.elapsesAt}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t\t: undefined\n\t\t\t}\n\t\t>\n\t\t\t<SubHeader>\n\t\t\t\t{t(`ui.crafter-state.${remainingTimeMs > 0 ? 'CRAFT_PENDING' : 'CRAFT_READY'}`)}\n\t\t\t</SubHeader>\n\t\t</EntryCard>\n\t);\n};\n","import { h } from 'preact';\n\nimport { EntryCard } from '~/components/EntryCard';\nimport { SubHeader } from '~/components/Typography';\nimport type { CrafterCraftReadyActivity } from '~/game/entities/Crafter';\nimport * as Route from '~/routes';\n\nimport type { CrafterEntryRenderer } from './types';\n\nexport const CrafterCraftReadyEntryRenderer: CrafterEntryRenderer<CrafterCraftReadyActivity> = (_activity, {\n\tcrafter,\n\trouter,\n\tt,\n\t...rest\n}) => (\n\t<EntryCard\n\t\t{...rest}\n\t\taction={() => router.navigate(Route.CRAFTING_END, { crafter })}\n\t>\n\t\t<SubHeader>\n\t\t\t{t('ui.crafter-state.CRAFT_READY')}\n\t\t</SubHeader>\n\t</EntryCard>\n);\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { Menu } from '~/components/Menu';\nimport { MainHeader } from '~/components/Typography';\nimport { CrafterActivity, CrafterCraftPendingActivity } from '~/game/entities/Crafter';\nimport { useScheduledUpdates } from '~/hooks/useScheduledUpdates';\nimport * as Route from '~/routes';\nimport type { ScreenType } from '~/screens/ScreenType';\n\nimport { renderCrafterEntry } from './entries';\n\nexport const CraftersScreen: ScreenType = ({ game }) => {\n\tconst { t } = useIntl();\n\tconst router = useRouter();\n\n\t// refresh this screen when a quest finishes\n\tuseScheduledUpdates(\n\t\tgame.scheduler,\n\t\tgame.crafters\n\t\t\t.filter(crafter => crafter.activity.kind === CrafterActivity.CRAFT_PENDING)\n\t\t\t.map(crafter => (crafter.activity as CrafterCraftPendingActivity).elapsesAt)\n\t);\n\n\tconst header = (\n\t\t<MainHeader>\n\t\t\t{t('ui.title.crafters')}\n\t\t</MainHeader>\n\t);\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<Menu\n\t\t\t\theader={header}\n\t\t\t\titems={game.crafters}\n\t\t\t\titemRenderer={crafter => renderCrafterEntry({\n\t\t\t\t\tgame,\n\t\t\t\t\tcrafter,\n\t\t\t\t\trouter,\n\t\t\t\t\tt,\n\t\t\t\t\ticon: crafter.icon,\n\t\t\t\t\ttitle: t(`entity.${crafter.key}`),\n\t\t\t\t\tquantity: crafter.level.value\n\t\t\t\t})}\n\t\t\t/>\n\t\t</FlatLayout>\n\t);\n};\n","import { h, RenderableProps } from 'preact';\n\nimport { cx } from '~/utils/style';\n\nimport './ButtonGroup.css';\n\nexport interface ButtonGroupProps {\n\treadonly class?: string;\n}\n\nexport const ButtonGroup = ({ class: customClass, children }: RenderableProps<ButtonGroupProps>) => (\n\t<div class={cx('button-group', customClass)}>\n\t\t{children}\n\t</div>\n);\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { Button } from '~/components/Button';\nimport { ButtonGroup } from '~/components/ButtonGroup';\nimport { EntryCard } from '~/components/EntryCard';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { Crafter, CrafterCraftReadyActivity } from '~/game/entities/Crafter';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport * as Route from '~/routes';\nimport { enumGet } from '~/utils/enum';\n\nimport { ScreenType } from '../ScreenType';\n\ninterface CraftingEndScreenParams {\n\treadonly crafter: Crafter;\n}\n\nexport const CraftingEndScreen: ScreenType = () => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<CraftingEndScreenParams>();\n\tconst { crafter } = router.params;\n\tconst { loot } = crafter.activity as CrafterCraftReadyActivity;\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<EntryCard\n\t\t\t\ticon={enumGet(ItemKinds, loot.itemKey).icon}\n\t\t\t\tquantity={loot.quantity}\n\t\t\t\ttitle={t(`item.${loot.itemKey}`)}\n\t\t\t/>\n\t\t\t<ButtonGroup>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tcrafter.deliverCraft();\n\t\t\t\t\t\trouter.navigate(Route.CRAFTERS);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{t('ui.label.end-task')}\n\t\t\t\t</Button>\n\t\t\t</ButtonGroup>\n\t\t</FlatLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { EntryCard } from '~/components/EntryCard';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { Menu } from '~/components/Menu';\nimport { MainHeader } from '~/components/Typography';\nimport type { Crafter } from '~/game/entities/Crafter';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport * as Route from '~/routes';\nimport type { ScreenType } from '~/screens/ScreenType';\nimport { enumGet } from '~/utils/enum';\n\ninterface CraftingListScreenParams {\n\treadonly crafter: Crafter;\n}\n\nexport const CraftingListScreen: ScreenType = () => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<CraftingListScreenParams>();\n\tconst { crafter } = router.params;\n\n\tconst header = (\n\t\t<MainHeader>\n\t\t\t{t('ui.title.recipes')}\n\t\t</MainHeader>\n\t);\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<Menu\n\t\t\t\theader={header}\n\t\t\t\titems={crafter.recipes}\n\t\t\t\titemRenderer={recipe => (\n\t\t\t\t\t<EntryCard\n\t\t\t\t\t\ticon={enumGet(ItemKinds, recipe.result.itemKey).icon}\n\t\t\t\t\t\ttitle={t(`item.${recipe.result.itemKey}`)}\n\t\t\t\t\t\tactionDisabled={crafter.level.value < recipe.minLevel}\n\t\t\t\t\t\taction={() => {\n\t\t\t\t\t\t\trouter.navigate(\n\t\t\t\t\t\t\t\tRoute.CRAFTING_RECIPE,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcrafter,\n\t\t\t\t\t\t\t\t\trecipe\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t/>\n\t\t</FlatLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\nimport { useState } from 'preact/hooks';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { Button } from '~/components/Button';\nimport { EntryCard } from '~/components/EntryCard';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { Menu } from '~/components/Menu';\nimport { MainHeader } from '~/components/Typography';\nimport { Crafter, Recipe } from '~/game/entities/Crafter';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport * as Route from '~/routes';\nimport { ScreenType } from '~/screens/ScreenType';\nimport { min } from '~/utils/array';\nimport { enumGet } from '~/utils/enum';\n\nimport './CraftingRecipeScreen.css';\n\ninterface CraftingRecipeScreenParams {\n\treadonly crafter: Crafter;\n\treadonly recipe: Recipe;\n}\n\nexport const CraftingRecipeScreen: ScreenType = ({ game }) => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<CraftingRecipeScreenParams>();\n\tconst [ quantity, setQuantity ] = useState(1);\n\tconst { crafter, recipe } = router.params;\n\n\tconst header = (\n\t\t<MainHeader>\n\t\t\t{t('ui.title.craft-item', { item: t(`item.${recipe.result.itemKey}`) })}\n\t\t</MainHeader>\n\t);\n\n\tconst { maxStack } = enumGet(ItemKinds, recipe.result.itemKey);\n\tconst maxQuantity = Math.min(maxStack, Math.floor(min(recipe.materials, material => (\n\t\tgame.inventory.count(material.itemKey) / material.quantity\n\t))));\n\n\tconst decreaseDisabled = maxQuantity <= 1 || quantity === 1;\n\tconst increaseDisabled = maxQuantity <= 1 || quantity === maxQuantity;\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<Menu\n\t\t\t\theader={header}\n\t\t\t\titems={recipe.materials}\n\t\t\t\titemRenderer={material => (\n\t\t\t\t\t<EntryCard\n\t\t\t\t\t\ticon={enumGet(ItemKinds, material.itemKey).icon}\n\t\t\t\t\t\tquantity={material.quantity * quantity}\n\t\t\t\t\t\ttitle={t(`item.${material.itemKey}`)}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t/>\n\t\t\t<div class='crafting-recipe__controls'>\n\t\t\t\t<Button\n\t\t\t\t\tclass='crafting-recipe__quantity-min'\n\t\t\t\t\tdisabled={decreaseDisabled}\n\t\t\t\t\tonClick={() => setQuantity(1)}\n\t\t\t\t>\n\t\t\t\t\t{t('ui.label.minimum')}\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tclass='crafting-recipe__quantity-decrease'\n\t\t\t\t\tdisabled={decreaseDisabled}\n\t\t\t\t\tonClick={() => setQuantity(quantity - 1)}\n\t\t\t\t>\n\t\t\t\t\t{t('ui.label.minus')}\n\t\t\t\t</Button>\n\t\t\t\t<span class='crafting-recipe__quantity-value'>\n\t\t\t\t\t{quantity}\n\t\t\t\t</span>\n\t\t\t\t<Button\n\t\t\t\t\tclass='crafting-recipe__quantity-increase'\n\t\t\t\t\tdisabled={increaseDisabled}\n\t\t\t\t\tonClick={() => setQuantity(quantity + 1)}\n\t\t\t\t>\n\t\t\t\t\t{t('ui.label.plus')}\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tclass='crafting-recipe__quantity-max'\n\t\t\t\t\tdisabled={increaseDisabled}\n\t\t\t\t\tonClick={() => setQuantity(maxQuantity)}\n\t\t\t\t>\n\t\t\t\t\t{t('ui.label.maximum')}\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tclass='crafting-recipe__start-button'\n\t\t\t\t\tdisabled={maxQuantity === 0}\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tcrafter.scheduleCraft(recipe, quantity);\n\t\t\t\t\t\trouter.navigate(Route.CRAFTERS);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{t('ui.label.start-task')}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</FlatLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { EntryCard } from '~/components/EntryCard';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { MainHeader } from '~/components/Typography';\nimport { Hero } from '~/game/entities/Hero';\nimport * as Route from '~/routes';\n\nimport { ScreenType } from '../ScreenType';\n\ninterface HeroDeathScreenParams {\n\treadonly hero: Hero;\n}\n\nexport const HeroDeathScreen: ScreenType = () => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<HeroDeathScreenParams>();\n\tconst { hero } = router.params;\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<MainHeader>\n\t\t\t\t{t('ui.title.hero-death')}\n\t\t\t</MainHeader>\n\t\t\t<EntryCard\n\t\t\t\ticon={hero.icon}\n\t\t\t\ttitle={t(`entity.${hero.key}`)}\n\t\t\t\taction={() => {\n\t\t\t\t\thero.revive();\n\t\t\t\t\trouter.navigate(Route.HEROES);\n\t\t\t\t}}\n\t\t\t/>\n\t\t</FlatLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { EntryCard } from '~/components/EntryCard';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { Menu } from '~/components/Menu';\nimport { ProgressBar } from '~/components/ProgressBar';\nimport { MainHeader } from '~/components/Typography';\nimport { Hero } from '~/game/entities/Hero';\nimport { equipmentSlotKeys } from '~/game/items/EquipmentSlot';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport * as Route from '~/routes';\nimport { enumGet } from '~/utils/enum';\n\nimport { ScreenType } from '../ScreenType';\n\n\ninterface HeroEditScreenParams {\n\treadonly hero: Hero;\n}\n\nexport const HeroEditScreen: ScreenType = () => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<HeroEditScreenParams>();\n\tconst { hero } = router.params;\n\n\tconst header = (\n\t\t<header class='edit-hero-screen__header'>\n\t\t\t<MainHeader>\n\t\t\t\t{t('ui.title.equipment')}\n\t\t\t</MainHeader>\n\t\t</header>\n\t);\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<EntryCard\n\t\t\t\ticon={hero.icon}\n\t\t\t\tquantity={hero.level.value}\n\t\t\t\taction={() => {\n\t\t\t\t\trouter.navigate(Route.HERO_HEAL_SCREEN, { hero });\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{t(`entity.${hero.key}`)}\n\t\t\t\t<ProgressBar\n\t\t\t\t\ttitle={t('ui.label.hp')}\n\t\t\t\t\tvalue={hero.health.value}\n\t\t\t\t\tmaxValue={hero.health.maxHealth}\n\t\t\t\t/>\n\t\t\t\t<ProgressBar\n\t\t\t\t\ttitle={t('ui.label.xp')}\n\t\t\t\t\tvalue={hero.level.xpThisLevel}\n\t\t\t\t\tmaxValue={hero.level.xpRequiredForNextLevel}\n\t\t\t\t/>\n\t\t\t</EntryCard>\n\t\t\t<Menu\n\t\t\t\theader={header}\n\t\t\t\titems={equipmentSlotKeys}\n\t\t\t\titemRenderer={slot => {\n\t\t\t\t\tconst itemKey = hero.equipment[slot];\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<EntryCard\n\t\t\t\t\t\t\ticon={itemKey ? enumGet(ItemKinds, itemKey).icon : undefined}\n\t\t\t\t\t\t\ttitle={itemKey && t(`item.${itemKey}`)}\n\t\t\t\t\t\t\taction={() => {\n\t\t\t\t\t\t\t\trouter.navigate(Route.HERO_EQUIP_ITEM, {\n\t\t\t\t\t\t\t\t\thero,\n\t\t\t\t\t\t\t\t\tslot\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t/>\n\t\t</FlatLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { EntryCard } from '~/components/EntryCard';\nimport { Menu } from '~/components/Menu';\nimport { MainHeader } from '~/components/Typography';\nimport { Hero } from '~/game/entities/Hero';\nimport { EquipmentSlot } from '~/game/items/EquipmentSlot';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport * as Route from '~/routes';\nimport { enumGet } from '~/utils/enum';\n\nimport { ScreenType } from '../ScreenType';\n\nexport interface HeroEquipItemParams {\n\thero: Hero;\n\tslot: EquipmentSlot;\n}\n\nexport const HeroEquipItem: ScreenType = ({ game }) => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<HeroEquipItemParams>();\n\tconst { hero, slot } = router.params;\n\n\tconst header = (\n\t\t<header class='hero-equip-item__header'>\n\t\t\t<MainHeader>\n\t\t\t\t{t('ui.title.hero-equip-item')}\n\t\t\t\t<br />\n\t\t\t\t{t(`entity.${hero.key}`)}\n\t\t\t</MainHeader>\n\t\t</header>\n\t);\n\n\tconst available = game.inventory.contents.filter(stack => enumGet(ItemKinds, stack.itemKey).slot === slot);\n\treturn (\n\t\t<Menu\n\t\t\theader={header}\n\t\t\titems={available}\n\t\t\titemRenderer={stack => (\n\t\t\t\t<EntryCard\n\t\t\t\t\ticon={enumGet(ItemKinds, stack.itemKey).icon}\n\t\t\t\t\ttitle={t(`item.${stack.itemKey}`)}\n\t\t\t\t\taction={() => {\n\t\t\t\t\t\thero.equip(stack.itemKey);\n\t\t\t\t\t\trouter.navigate(Route.HERO_EDIT, { hero });\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t)}\n\t\t/>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { EntryCard } from '~/components/EntryCard';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { Menu } from '~/components/Menu';\nimport { ProgressBar } from '~/components/ProgressBar';\nimport { MainHeader } from '~/components/Typography';\nimport { Hero } from '~/game/entities/Hero';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport { useForceUpdate } from '~/hooks/useForceUpdate';\nimport { enumGet } from '~/utils/enum';\n\nimport { ScreenType } from '../ScreenType';\n\ninterface HeroHealScreenParams {\n\treadonly hero: Hero;\n}\n\nexport const HeroHealScreen: ScreenType = ({ game }) => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<HeroHealScreenParams>();\n\tconst { hero } = router.params;\n\n\tconst header = (\n\t\t<header class='hero-heal__header'>\n\t\t\t<MainHeader>\n\t\t\t\t{t('ui.title.hero-heal')}\n\t\t\t\t<br />\n\t\t\t\t{t(`entity.${hero.key}`)}\n\t\t\t</MainHeader>\n\t\t</header>\n\t);\n\n\tconst available = game.inventory.contents.filter(stack => enumGet(ItemKinds, stack.itemKey).healValue !== undefined);\n\tconst forceUpdate = useForceUpdate();\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<EntryCard\n\t\t\t\ticon={hero.icon}\n\t\t\t>\n\t\t\t\t<ProgressBar\n\t\t\t\t\tvalue={hero.health.value}\n\t\t\t\t\tmaxValue={hero.health.maxHealth}\n\t\t\t\t\ttitle={t('ui.label.hp')}\n\t\t\t\t/>\n\t\t\t</EntryCard>\n\t\t\t<Menu\n\t\t\t\theader={header}\n\t\t\t\titems={available}\n\t\t\t\titemRenderer={stack => (\n\t\t\t\t\t<EntryCard\n\t\t\t\t\t\ticon={enumGet(ItemKinds, stack.itemKey).icon}\n\t\t\t\t\t\ttitle={t(`item.${stack.itemKey}`)}\n\t\t\t\t\t\tquantity={stack.quantity}\n\t\t\t\t\t\taction={() => {\n\t\t\t\t\t\t\tif (hero.health.value !== hero.health.maxHealth) {\n\t\t\t\t\t\t\t\thero.health.value += enumGet(ItemKinds, stack.itemKey).healValue!;\n\t\t\t\t\t\t\t\tgame.inventory.remove([\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\titemKey: stack.itemKey,\n\t\t\t\t\t\t\t\t\t\tquantity: 1\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\t\tforceUpdate();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t/>\n\t\t</FlatLayout>\n\t);\n};\n","import { ComponentChildren, h, RenderableProps } from 'preact';\n\nimport { cx } from '~/utils/style';\n\nimport './StickyLayout.css';\n\nexport interface StickyLayoutProps {\n\treadonly class?: string;\n\treadonly header?: ComponentChildren;\n}\n\nexport const StickyLayout = ({\n\tclass: customClass,\n\tchildren,\n\theader\n}: RenderableProps<StickyLayoutProps>) => (\n\t<div class={cx('sticky-layout', customClass)}>\n\t\t{header && (\n\t\t\t<header class='sticky-layout__header'>\n\t\t\t\t{header}\n\t\t\t</header>\n\t\t)}\n\t\t{children}\n\t</div>\n);\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\nimport { useState } from 'preact/hooks';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { Button } from '~/components/Button';\nimport { EntryCard } from '~/components/EntryCard';\nimport { Menu } from '~/components/Menu';\nimport { StickyLayout } from '~/components/StickyLayout';\nimport { MainHeader } from '~/components/Typography';\nimport { Hero } from '~/game/entities/Hero';\nimport * as Route from '~/routes';\nimport type { ScreenType } from '~/screens/ScreenType';\n\nexport const HeroRecruitScreen: ScreenType = ({ game }) => {\n\tconst { t } = useIntl();\n\tconst router = useRouter();\n\tconst [ selectedKey, setSelectedKey ] = useState<string | null>(null);\n\tconst selectedHero = selectedKey ? Hero.registry.get(selectedKey) : null;\n\tconst header = (\n\t\t<header class='recruit-screen__header'>\n\t\t\t<MainHeader>\n\t\t\t\t{t('ui.title.recruit-hero')}\n\t\t\t</MainHeader>\n\t\t\t<EntryCard\n\t\t\t\ticon={selectedHero?.icon}\n\t\t\t\ttitle={selectedHero ? t(`entity.${selectedHero.key}`) : undefined}\n\t\t\t\tactionDisabled={!selectedHero}\n\t\t\t\taction={() => {\n\t\t\t\t\tgame.recruitHero(selectedKey!);\n\t\t\t\t\trouter.navigate(Route.HEROES);\n\t\t\t\t}}\n\t\t\t/>\n\t\t</header>\n\t);\n\n\treturn (\n\t\t<StickyLayout header={header}>\n\t\t\t<Menu\n\t\t\t\titems={Hero.registry.keys}\n\t\t\t\titemRenderer={key => (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tkey={key}\n\t\t\t\t\t\tselected={key === selectedKey}\n\t\t\t\t\t\tonClick={() => setSelectedKey(key)}\n\t\t\t\t\t\tchildren={t(`entity.${key}`)}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t/>\n\t\t</StickyLayout>\n\t);\n};\n","import { HeroActivity } from '~/game/entities/Hero';\n\nimport { HeroDeadEntryRenderer } from './HeroDeadEntryRenderer';\nimport { HeroIdleEntryRenderer } from './HeroIdleEntryRenderer';\nimport { HeroQuestPendingEntryRenderer } from './HeroQuestPendingEntryRenderer';\nimport { HeroQuestReadyEntryRenderer } from './HeroQuestReadyEntryRenderer';\nimport type { HeroEntryRenderer, HeroEntryRendererArgs } from './types';\n\nconst activityMap: Record<HeroActivity, HeroEntryRenderer<any>> = {\n\t[HeroActivity.DEAD]: HeroDeadEntryRenderer,\n\t[HeroActivity.IDLE]: HeroIdleEntryRenderer,\n\t[HeroActivity.QUEST_PENDING]: HeroQuestPendingEntryRenderer,\n\t[HeroActivity.QUEST_READY]: HeroQuestReadyEntryRenderer\n};\n\nexport const renderHeroEntry = (args: HeroEntryRendererArgs) => (\n\tactivityMap[args.hero.activity.kind](args.hero.activity, args)\n);\n","import { h } from 'preact';\n\nimport { EntryCard } from '~/components/EntryCard';\nimport { ProgressBar } from '~/components/ProgressBar';\nimport { SubHeader } from '~/components/Typography';\nimport { HeroDeadActivity } from '~/game/entities/Hero';\nimport * as Route from '~/routes';\n\nimport type { HeroEntryRenderer } from './types';\n\nexport const HeroDeadEntryRenderer: HeroEntryRenderer<HeroDeadActivity> = (_activity, { hero, router, t, ...rest }) => (\n\t<EntryCard\n\t\t{...rest}\n\t\ticon='💀'\n\t\taction={() => router.navigate(Route.HERO_DEATH, { hero })}\n\t>\n\t\t<ProgressBar\n\t\t\tvalue={0}\n\t\t\tmaxValue={hero.health.maxHealth}\n\t\t\ttitle={t('ui.label.hp')}\n\t\t/>\n\t\t<SubHeader>\n\t\t\t{t('ui.hero-state.died')}\n\t\t</SubHeader>\n\t</EntryCard>\n);\n","import { h } from 'preact';\n\nimport { EntryCard } from '~/components/EntryCard';\nimport { ProgressBar } from '~/components/ProgressBar';\nimport type { HeroIdleActivity } from '~/game/entities/Hero';\nimport * as Route from '~/routes';\n\nimport type { HeroEntryRenderer } from './types';\n\nexport const HeroIdleEntryRenderer: HeroEntryRenderer<HeroIdleActivity> = (_activity, { hero, router, t, ...rest }) => (\n\t<EntryCard\n\t\t{...rest}\n\t\taction={() => router.navigate(Route.QUEST_SELECT, { hero })}\n\t>\n\t\t<ProgressBar\n\t\t\tvalue={hero.health.value}\n\t\t\tmaxValue={hero.health.maxHealth}\n\t\t\ttitle={t('ui.label.hp')}\n\t\t/>\n\t</EntryCard>\n);\n","import { h } from 'preact';\n\nimport { Countdown } from '~/components/Countdown';\nimport { EntryCard } from '~/components/EntryCard';\nimport { SubHeader } from '~/components/Typography';\nimport { HeroQuestPendingActivity } from '~/game/entities/Hero';\nimport * as Route from '~/routes';\n\nimport type { HeroEntryRenderer } from './types';\n\nexport const HeroQuestPendingEntryRenderer: HeroEntryRenderer<HeroQuestPendingActivity> = (activity, {\n\tgame,\n\thero,\n\trouter,\n\tt,\n\t...rest\n}) => {\n\tconst remainingTimeMs = activity.elapsesAt - game.clock.now;\n\treturn (\n\t\t<EntryCard\n\t\t\t{...rest}\n\t\t\taction={() => {\n\t\t\t\thero.completeQuest();\n\t\t\t\tif (hero.health.isAlive) {\n\t\t\t\t\trouter.navigate(Route.QUEST_END, { hero });\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\trouter.navigate(Route.HERO_DEATH, { hero });\n\t\t\t\t}\n\t\t\t}}\n\t\t\tactionDisabled={remainingTimeMs > 0}\n\t\t\tactionContent={remainingTimeMs > 0\n\t\t\t\t? (\n\t\t\t\t\t<Countdown\n\t\t\t\t\t\tscheduler={game.scheduler}\n\t\t\t\t\t\ttimestamp={activity.elapsesAt}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t\t: undefined\n\t\t\t}\n\t\t>\n\t\t\t<SubHeader>\n\t\t\t\t{t(`ui.hero-state.${remainingTimeMs > 0 ? 'quest-pending' : 'quest-ready'}`)}\n\t\t\t</SubHeader>\n\t\t</EntryCard>\n\t);\n};\n","import { h } from 'preact';\n\nimport { EntryCard } from '~/components/EntryCard';\nimport { SubHeader } from '~/components/Typography';\nimport { HeroQuestReadyActivity } from '~/game/entities/Hero';\nimport * as Route from '~/routes';\n\nimport type { HeroEntryRenderer } from './types';\n\nexport const HeroQuestReadyEntryRenderer: HeroEntryRenderer<HeroQuestReadyActivity> = (_activity, {\n\thero,\n\trouter,\n\tt,\n\t...rest\n}) => (\n\t<EntryCard\n\t\t{...rest}\n\t\taction={() => router.navigate(Route.QUEST_END, { hero })}\n\t>\n\t\t<SubHeader>\n\t\t\t{t('ui.hero-state.quest-ready')}\n\t\t</SubHeader>\n\t</EntryCard>\n);\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { Button } from '~/components/Button';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { Menu } from '~/components/Menu';\nimport { MainHeader } from '~/components/Typography';\nimport { MAX_HEROES } from '~/game/constants';\nimport { HeroActivity, HeroQuestPendingActivity } from '~/game/entities/Hero';\nimport { useScheduledUpdates } from '~/hooks/useScheduledUpdates';\nimport * as Route from '~/routes';\nimport type { ScreenType } from '~/screens/ScreenType';\n\nimport { renderHeroEntry } from './entries';\n\nexport const HeroesScreen: ScreenType = ({ game }) => {\n\tconst { t } = useIntl();\n\tconst router = useRouter();\n\n\t// refresh this screen when a quest finishes\n\tuseScheduledUpdates(\n\t\tgame.scheduler,\n\t\tgame.heroes\n\t\t\t.filter(hero => hero.activity.kind === HeroActivity.QUEST_PENDING)\n\t\t\t.map(hero => (hero.activity as HeroQuestPendingActivity).elapsesAt)\n\t);\n\n\tconst header = (\n\t\t<MainHeader>\n\t\t\t{t('ui.title.heroes')}\n\t\t</MainHeader>\n\t);\n\n\tconst footer = (\n\t\t<Button\n\t\t\tdisabled={game.heroes.length >= MAX_HEROES}\n\t\t\tonClick={() => router.navigate(Route.HERO_RECRUIT)}\n\t\t>\n\t\t\t{t('ui.label.recruit-hero')}\n\t\t</Button>\n\t);\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<Menu\n\t\t\t\theader={header}\n\t\t\t\tfooter={footer}\n\t\t\t\titems={game.heroes}\n\t\t\t\titemRenderer={hero => renderHeroEntry({\n\t\t\t\t\tgame,\n\t\t\t\t\thero,\n\t\t\t\t\trouter,\n\t\t\t\t\tt,\n\t\t\t\t\ticon: hero.icon,\n\t\t\t\t\ttitle: t(`entity.${hero.key}`),\n\t\t\t\t\tquantity: hero.level.value,\n\t\t\t\t\tsecondaryAction: () => router.navigate(Route.HERO_EDIT, { hero })\n\t\t\t\t})}\n\t\t\t/>\n\t\t</FlatLayout>\n\t);\n};\n","import { h } from 'preact';\n\nimport { Icon } from '~/components/Icon';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport { ItemStack } from '~/game/items/ItemStack';\nimport { enumGet } from '~/utils/enum';\nimport { cx } from '~/utils/style';\n\nimport './ItemGrid.css';\n\nexport interface ItemGridProps {\n\treadonly class?: string;\n\treadonly content: readonly (ItemStack | null)[];\n\treadonly onClickItem?: (stack: ItemStack | null, index: number) => void;\n}\n\nexport const ItemGrid = ({\n\tclass: customClass,\n\tcontent,\n\tonClickItem\n}: ItemGridProps) => (\n\t<div class={cx('item-grid', customClass)}>\n\t\t{content.map((itemStack, index) => (\n\t\t\t<Icon\n\t\t\t\tkey={index}\n\t\t\t\tquantity={itemStack?.quantity}\n\t\t\t\ticon={itemStack ? enumGet(ItemKinds, itemStack.itemKey).icon : undefined}\n\t\t\t\tonClick={() => onClickItem?.(itemStack, index)}\n\t\t\t/>\n\t\t))}\n\t</div>\n);\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { Fragment, h } from 'preact';\nimport { useState } from 'preact/hooks';\n\nimport { EntryCard } from '~/components/EntryCard';\nimport { ItemGrid } from '~/components/ItemGrid';\nimport { StickyLayout } from '~/components/StickyLayout';\nimport { MainHeader } from '~/components/Typography';\nimport { ItemKinds } from '~/game/items/ItemKind';\nimport { ItemStack } from '~/game/items/ItemStack';\nimport type { ScreenType } from '~/screens/ScreenType';\nimport { enumGet } from '~/utils/enum';\n\nexport const InventoryScreen: ScreenType = ({ game }) => {\n\tconst { t } = useIntl();\n\tconst [ selectedIndex, setSelectedIndex ] = useState(-1);\n\n\tconst { capacity, contents } = game.inventory;\n\tconst slots = new Array<ItemStack | null>(capacity);\n\tfor (let i = 0; i < capacity; ++i) {\n\t\tslots[i] = i < contents.length ? contents[i] : null;\n\t}\n\n\tconst selectedStack = slots[selectedIndex];\n\tconst header = (\n\t\t<>\n\t\t\t<MainHeader>\n\t\t\t\t{t('ui.title.inventory')}\n\t\t\t</MainHeader>\n\t\t\t<EntryCard\n\t\t\t\tclass='item-grid__detail'\n\t\t\t\ticon={selectedStack ? enumGet(ItemKinds, selectedStack.itemKey).icon : undefined}\n\t\t\t\tquantity={selectedStack?.quantity}\n\t\t\t\ttitle={selectedStack ? t(`item.${selectedStack.itemKey}`) : undefined}\n\t\t\t/>\n\t\t</>\n\t);\n\n\treturn (\n\t\t<StickyLayout header={header}>\n\t\t\t<ItemGrid\n\t\t\t\tcontent={slots}\n\t\t\t\tonClickItem={(_, index) => setSelectedIndex(index)}\n\t\t\t/>\n\t\t</StickyLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { Button } from '~/components/Button';\nimport { ButtonGroup } from '~/components/ButtonGroup';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { ItemGrid } from '~/components/ItemGrid';\nimport { MainHeader } from '~/components/Typography';\nimport { Hero, HeroQuestReadyActivity } from '~/game/entities/Hero';\nimport * as Route from '~/routes';\nimport type { ScreenType } from '~/screens/ScreenType';\n\ninterface QuestEndScreenParams {\n\treadonly hero: Hero;\n}\n\nexport const QuestEndScreen: ScreenType = () => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<QuestEndScreenParams>();\n\tconst { hero } = router.params;\n\tconst { loot } = hero.activity as HeroQuestReadyActivity;\n\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<MainHeader>\n\t\t\t\t{t('ui.title.quest-loot')}\n\t\t\t</MainHeader>\n\t\t\t<ItemGrid content={loot} />\n\t\t\t<ButtonGroup>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\thero.deliverQuest();\n\t\t\t\t\t\trouter.navigate(Route.HEROES);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{t('ui.label.end-quest')}\n\t\t\t\t</Button>\n\t\t\t</ButtonGroup>\n\t\t</FlatLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { EntryCard } from '~/components/EntryCard';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { Menu } from '~/components/Menu';\nimport { MainHeader } from '~/components/Typography';\nimport { Enemy } from '~/game/entities/Enemy';\nimport type { Hero } from '~/game/entities/Hero';\nimport { questRegistry } from '~/game/quests/Quest';\nimport * as Route from '~/routes';\nimport type { ScreenType } from '~/screens/ScreenType';\n\ninterface QuestSelectScreenParams {\n\treadonly hero: Hero;\n}\n\nexport const QuestSelectScreen: ScreenType = () => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<QuestSelectScreenParams>();\n\tconst { hero } = router.params;\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<Menu\n\t\t\t\theader={\n\t\t\t\t\t<MainHeader>\n\t\t\t\t\t\t{t('ui.title.quest-select')}\n\t\t\t\t\t</MainHeader>\n\t\t\t\t}\n\t\t\t\titems={questRegistry.keys}\n\t\t\t\titemRenderer={questKey => {\n\t\t\t\t\tconst quest = questRegistry.get(questKey);\n\t\t\t\t\tconst enemy = Enemy.registry.get(quest.enemyKey);\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<EntryCard\n\t\t\t\t\t\t\ticon={enemy.icon}\n\t\t\t\t\t\t\tquantity={quest.levelRequirement}\n\t\t\t\t\t\t\ttitle={t(`quest.${quest.key}.name`)}\n\t\t\t\t\t\t\tactionDisabled={quest.levelRequirement > hero.level.value}\n\t\t\t\t\t\t\taction={() => router.navigate(Route.QUEST_START, {\n\t\t\t\t\t\t\t\thero,\n\t\t\t\t\t\t\t\tquest\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class='quest-select__description'>\n\t\t\t\t\t\t\t\t{t(`quest.${quest.key}.desc`)}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</EntryCard>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t/>\n\t\t</FlatLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { Fragment, h } from 'preact';\n\nimport { ProgressBar } from '~/components/ProgressBar';\nimport { MainHeader, SubHeader } from '~/components/Typography';\nimport { Attribute } from '~/game/entities/Attributes';\nimport type { Enemy } from '~/game/entities/Enemy';\nimport type { Hero } from '~/game/entities/Hero';\nimport { tsEnumMap } from '~/utils/enum';\nimport { cx } from '~/utils/style';\n\nimport './EntityDetail.css';\n\nexport interface EntityDetailProps {\n\treadonly class?: string;\n\treadonly entity: Hero | Enemy;\n}\n\nexport const EntityDetail = (props: EntityDetailProps) => {\n\tconst { t } = useIntl();\n\tconst { entity } = props;\n\treturn (\n\t\t<div class={cx('entity-detail', props.class)}>\n\t\t\t<MainHeader>\n\t\t\t\t{t(`entity.${entity.key}`)}\n\t\t\t</MainHeader>\n\t\t\t<ProgressBar\n\t\t\t\tmaxValue={entity.health.maxHealth}\n\t\t\t\tvalue={entity.health.value}\n\t\t\t\ttitle={t('ui.label.hp')}\n\t\t\t/>\n\n\t\t\t<SubHeader>\n\t\t\t\t{t('ui.label.stats')}\n\t\t\t</SubHeader>\n\t\t\t<dl class='entity-detail__attributes'>\n\t\t\t\t{tsEnumMap(Attribute, (attribute, key) => (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<dt>\n\t\t\t\t\t\t\t{t(`attribute.${key}`)}\n\t\t\t\t\t\t</dt>\n\t\t\t\t\t\t<dd>\n\t\t\t\t\t\t\t{entity.getAttribute(attribute)}\n\t\t\t\t\t\t</dd>\n\t\t\t\t\t</>\n\t\t\t\t))}\n\t\t\t</dl>\n\n\t\t\t<SubHeader>\n\t\t\t\t{t('ui.label.rotation')}\n\t\t\t</SubHeader>\n\t\t\t<ol class='entity-detail__rotation'>\n\t\t\t\t{entity.rotation.map((attackKey, index) => (\n\t\t\t\t\t<li key={index}>\n\t\t\t\t\t\t<em>\n\t\t\t\t\t\t\t{t(`attack.${attackKey}`)}\n\t\t\t\t\t\t</em>\n\t\t\t\t\t</li>\n\t\t\t\t))}\n\t\t\t</ol>\n\t\t</div>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { useRouter } from '~/components/AppRouter';\nimport { Button } from '~/components/Button';\nimport { EntityDetail } from '~/components/EntityDetail';\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { MainHeader } from '~/components/Typography';\nimport { Enemy } from '~/game/entities/Enemy';\nimport type { Hero } from '~/game/entities/Hero';\nimport type { Quest } from '~/game/quests/Quest';\nimport * as Route from '~/routes';\nimport type { ScreenType } from '~/screens/ScreenType';\n\nimport './QuestStartScreen.css';\n\ninterface QuestStartScreenParams {\n\treadonly hero: Hero;\n\treadonly quest: Quest;\n}\n\nexport const QuestStartScreen: ScreenType = () => {\n\tconst { t } = useIntl();\n\tconst router = useRouter<QuestStartScreenParams>();\n\tconst { hero, quest } = router.params;\n\treturn (\n\t\t<FlatLayout class='quest-start'>\n\t\t\t<MainHeader class='quest-start__header'>\n\t\t\t\t{t('ui.title.quest-start')}\n\t\t\t</MainHeader>\n\t\t\t<EntityDetail\n\t\t\t\tclass='quest-start__hero-detail'\n\t\t\t\tentity={hero}\n\t\t\t/>\n\t\t\t<div class='quest-start__quest-prompt'>\n\t\t\t\t<span class='quest-start__versus'>\n\t\t\t\t\t{t('ui.label.versus')}\n\t\t\t\t</span>\n\t\t\t\t<Button\n\t\t\t\t\tclass='quest-start__start-button'\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\thero.scheduleQuest(quest.key);\n\t\t\t\t\t\trouter.navigate(Route.HEROES);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{t('ui.label.start-quest')}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t\t<EntityDetail\n\t\t\t\tclass='quest-start__enemy-detail'\n\t\t\t\tentity={new Enemy(quest.enemyKey)}\n\t\t\t/>\n\t\t</FlatLayout>\n\t);\n};\n","import { useIntl } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\n\nimport { FlatLayout } from '~/components/FlatLayout';\nimport { MainHeader } from '~/components/Typography';\nimport type { ScreenType } from '~/screens/ScreenType';\n\nexport const ShopScreen: ScreenType = () => {\n\tconst { t } = useIntl();\n\treturn (\n\t\t<FlatLayout>\n\t\t\t<MainHeader>\n\t\t\t\t{t('ui.title.shop')}\n\t\t\t</MainHeader>\n\t\t</FlatLayout>\n\t);\n};\n","import { IntlProvider } from '@calmdownval/intl-preact';\nimport { h } from 'preact';\nimport { useMemo } from 'preact/hooks';\n\nimport { AppRouter } from '~/components/AppRouter';\nimport { LocalStorageBackend } from '~/game/storage/LocalStorageBackend';\nimport { StateStorage } from '~/game/storage/StateStorage';\nimport { TraderGame } from '~/game/TraderGame';\nimport * as Route from '~/routes';\nimport { CraftersScreen } from '~/screens/crafters';\nimport { CraftingEndScreen } from '~/screens/crafting-end';\nimport { CraftingListScreen } from '~/screens/crafting-list';\nimport { CraftingRecipeScreen } from '~/screens/crafting-recipe';\nimport { HeroDeathScreen } from '~/screens/hero-death';\nimport { HeroEditScreen } from '~/screens/hero-edit';\nimport { HeroEquipItem } from '~/screens/hero-equip-item';\nimport { HeroHealScreen } from '~/screens/hero-heal';\nimport { HeroRecruitScreen } from '~/screens/hero-recruit';\nimport { HeroesScreen } from '~/screens/heroes';\nimport { InventoryScreen } from '~/screens/inventory';\nimport { QuestEndScreen } from '~/screens/quest-end';\nimport { QuestSelectScreen } from '~/screens/quest-select';\nimport { QuestStartScreen } from '~/screens/quest-start';\nimport { ScreenType } from '~/screens/ScreenType';\nimport { ShopScreen } from '~/screens/shop';\n\nexport const App = () => {\n\tconst routes = useMemo(initializeGameAndRoutes, []);\n\treturn (\n\t\t<IntlProvider url='./locale/en.json'>\n\t\t\t<AppRouter\n\t\t\t\tinitialPath={Route.CRAFTERS}\n\t\t\t\troutes={routes}\n\t\t\t/>\n\t\t</IntlProvider>\n\t);\n};\n\nfunction initializeGameAndRoutes() {\n\tconst state = new StateStorage(\n\t\tnew LocalStorageBackend({\n\t\t\tkey: 'game-state'\n\t\t})\n\t);\n\n\tconst game = new TraderGame(state);\n\tconst bind = (screen: ScreenType) => () => screen({ game });\n\n\t// register debug utils\n\t(window as any).tickFiveMins = () => {\n\t\tgame.clock.now += 5 * 60 * 1000;\n\t};\n\n\treturn [\n\t\t{\n\t\t\tpath: Route.CRAFTERS,\n\t\t\tcontent: bind(CraftersScreen),\n\t\t\tvisible: true\n\t\t},\n\t\t{\n\t\t\tpath: Route.CRAFTING_LIST,\n\t\t\tcontent: bind(CraftingListScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.CRAFTING_RECIPE,\n\t\t\tcontent: bind(CraftingRecipeScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.CRAFTING_END,\n\t\t\tcontent: bind(CraftingEndScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.INVENTORY,\n\t\t\tcontent: bind(InventoryScreen),\n\t\t\tvisible: true\n\t\t},\n\t\t{\n\t\t\tpath: Route.SHOP,\n\t\t\tcontent: bind(ShopScreen),\n\t\t\tvisible: true\n\t\t},\n\t\t{\n\t\t\tpath: Route.HEROES,\n\t\t\tcontent: bind(HeroesScreen),\n\t\t\tvisible: true\n\t\t},\n\t\t{\n\t\t\tpath: Route.HERO_RECRUIT,\n\t\t\tcontent: bind(HeroRecruitScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.HERO_EDIT,\n\t\t\tcontent: bind(HeroEditScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.HERO_EQUIP_ITEM,\n\t\t\tcontent: bind(HeroEquipItem)\n\t\t},\n\t\t{\n\t\t\tpath: Route.HERO_DEATH,\n\t\t\tcontent: bind(HeroDeathScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.HERO_HEAL_SCREEN,\n\t\t\tcontent: bind(HeroHealScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.QUEST_SELECT,\n\t\t\tcontent: bind(QuestSelectScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.QUEST_START,\n\t\t\tcontent: bind(QuestStartScreen)\n\t\t},\n\t\t{\n\t\t\tpath: Route.QUEST_END,\n\t\t\tcontent: bind(QuestEndScreen)\n\t\t}\n\t];\n}\n","import { EMPTY_OBJ } from './constants';\nimport { commitRoot, diff } from './diff/index';\nimport { createElement, Fragment } from './create-element';\nimport options from './options';\nimport { slice } from './util';\n\n/**\n * Render a Preact virtual node into a DOM element\n * @param {import('./internal').ComponentChild} vnode The virtual node to render\n * @param {import('./internal').PreactElement} parentDom The DOM element to\n * render into\n * @param {import('./internal').PreactElement | object} [replaceNode] Optional: Attempt to re-use an\n * existing DOM tree rooted at `replaceNode`\n */\nexport function render(vnode, parentDom, replaceNode) {\n\tif (options._root) options._root(vnode, parentDom);\n\n\t// We abuse the `replaceNode` parameter in `hydrate()` to signal if we are in\n\t// hydration mode or not by passing the `hydrate` function instead of a DOM\n\t// element..\n\tlet isHydrating = typeof replaceNode === 'function';\n\n\t// To be able to support calling `render()` multiple times on the same\n\t// DOM node, we need to obtain a reference to the previous tree. We do\n\t// this by assigning a new `_children` property to DOM nodes which points\n\t// to the last rendered tree. By default this property is not present, which\n\t// means that we are mounting a new tree for the first time.\n\tlet oldVNode = isHydrating\n\t\t? null\n\t\t: (replaceNode && replaceNode._children) || parentDom._children;\n\n\tvnode = (\n\t\t(!isHydrating && replaceNode) ||\n\t\tparentDom\n\t)._children = createElement(Fragment, null, [vnode]);\n\n\t// List of effects that need to be called after diffing.\n\tlet commitQueue = [];\n\tdiff(\n\t\tparentDom,\n\t\t// Determine the new vnode tree and store it on the DOM element on\n\t\t// our custom `_children` property.\n\t\tvnode,\n\t\toldVNode || EMPTY_OBJ,\n\t\tEMPTY_OBJ,\n\t\tparentDom.ownerSVGElement !== undefined,\n\t\t!isHydrating && replaceNode\n\t\t\t? [replaceNode]\n\t\t\t: oldVNode\n\t\t\t? null\n\t\t\t: parentDom.firstChild\n\t\t\t? slice.call(parentDom.childNodes)\n\t\t\t: null,\n\t\tcommitQueue,\n\t\t!isHydrating && replaceNode\n\t\t\t? replaceNode\n\t\t\t: oldVNode\n\t\t\t? oldVNode._dom\n\t\t\t: parentDom.firstChild,\n\t\tisHydrating\n\t);\n\n\t// Flush all queued effects\n\tcommitRoot(commitQueue, vnode);\n}\n\n/**\n * Update an existing DOM element with data from a Preact virtual node\n * @param {import('./internal').ComponentChild} vnode The virtual node to render\n * @param {import('./internal').PreactElement} parentDom The DOM element to\n * update\n */\nexport function hydrate(vnode, parentDom) {\n\trender(vnode, parentDom, hydrate);\n}\n","import { h, render } from 'preact';\n\nimport { App } from './App';\n\nimport './index.css';\n\nrender(\n\t<App />,\n\tdocument.getElementById('root')!\n);\n"],"names":["slice","options","vnodeId","inEvent","rerenderQueue","prevDebounce","microTick","i","EMPTY_OBJ","EMPTY_ARR","IS_NON_DIMENSIONAL","assign","obj","props","removeNode","node","parentNode","removeChild","createElement","type","children","key","ref","normalizedProps","arguments","length","call","defaultProps","createVNode","original","vnode","__k","__","__b","__e","__d","__c","__h","constructor","undefined","__v","Fragment","setStyle","style","value","setProperty","test","dom","name","oldValue","isSvg","useCapture","o","cssText","replace","toLowerCase","l","addEventListener","eventProxyCapture","eventProxy","removeEventListener","e","indexOf","removeAttribute","setAttribute","this","event","Component","context","getDomSibling","childIndex","sibling","updateParentDomPointers","child","base","defer","cb","setTimeout","enqueueRender","c","push","process","__r","debounceRendering","renderQueueLength","component","commitQueue","oldVNode","oldDom","parentDom","sort","a","b","shift","__P","diff","ownerSVGElement","commitRoot","diffChildren","renderResult","newParentVNode","oldParentVNode","globalContext","excessDomChildren","isHydrating","j","childVNode","newDom","firstChildDom","refs","oldChildren","oldChildrenLength","Array","isArray","reorderChildren","placeChild","getLastDom","nextSibling","unmount","applyRef","tmp","nextDom","sibDom","outer","appendChild","insertBefore","lastDom","newVNode","isNew","oldProps","oldState","snapshot","clearProcessingException","newProps","provider","componentContext","renderHook","count","newType","contextType","__E","prototype","render","doRender","sub","state","_sb","__s","getDerivedStateFromProps","componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","forEach","componentWillUpdate","componentDidUpdate","getChildContext","getSnapshotBeforeUpdate","oldHtml","newHtml","nodeType","localName","document","createTextNode","createElementNS","is","data","childNodes","dangerouslySetInnerHTML","attributes","__html","innerHTML","hydrate","diffProps","checked","diffElementNodes","diffed","root","some","current","parentVNode","skipRemove","r","componentWillUnmount","createContext","defaultValue","contextId","Consumer","contextValue","Provider","subs","ctx","_props","old","splice","error","errorInfo","ctor","handled","getDerivedStateFromError","setState","componentDidCatch","update","callback","s","forceUpdate","Promise","then","bind","resolve","Error","code","isIntlError","message","super","static","flattenTranslationMapInto","source","destination","prefix","startsWith","flattenTranslationMap","map","mapObjectValuesNotNull","result","Object","hasOwnProperty","getFormatName","placeholder","expand","vars","varName","assertParamsValid","validators","formatName","IntlError","INVALID_PARAMETER","paramIndex","fail","expected","PARTS","y","date","getFullYear","pad","M","monthsLong","monthsShort","m","getMonth","assertConfigured","notSupported","d","getDate","E","weekdaysLong","weekdaysShort","getDay","_length","dayPeriod","getHours","h","H","getMinutes","getSeconds","X","z","getTimezoneOffset","Math","floor","abs","FORMAT_UNAVAILABLE","n","padStart","formatDateTime","sequence","translations","Date","part","parseDateTimeFormat","pattern","index","anchor","isEscaped","cc","charCodeAt","addLiteral","str","commit","formatter","next","paramTypes","DateTimeFormat","config","formats","format","assertMessages","isObject","getAnyValue","BUILTIN_FORMATS","select","interpreter","optionsAST","other","interpret","variable","time","ParseError","input","at","PARSE_ERROR","toString","trimStart","max","lastIndexOf","trimEnd","snippet","repeat","stack","isWhitespace","skipWhitespace","offset","parseIdentifier","char","parseText","isWithinPlaceholder","text","parseMessages","firstKey","messages","ast","parseAST","parseMessagesWithAttributes","parsePlaceholder","id","parse","DefaultInterpreter","formatProvider","octothorpeParam","interpretElement","placeholders","formatAndJoin","element","getFormat","MappedFormatProvider","formatMap","CacheMode","Eager","Lazy","Off","CachedTranslationProvider","cacheMode","expansions","phrase","KEY_NOT_FOUND","locale","factory","$format","currentIndex","currentComponent","previousComponent","prevRaf","currentHook","afterPaintEffects","EMPTY","oldBeforeDiff","oldBeforeRender","oldAfterDiff","oldCommit","oldBeforeUnmount","getHookState","hooks","__H","__V","useState","initialState","useReducer","invokeOrReturn","reducer","init","hookState","_reducer","action","currentValue","__N","nextValue","_hasScuFromHooks","prevScu","p","stateHooks","filter","x","every","shouldUpdate","hookItem","useEffect","args","argsChanged","_pendingArgs","useMemo","useContext","flushAfterPaintEffects","invokeCleanup","invokeEffect","requestAnimationFrame","afterNextFrame","hasErrored","HAS_RAF","raf","done","clearTimeout","timeout","cancelAnimationFrame","hook","comp","cleanup","oldArgs","newArgs","arg","f","formatWarning","FETCHING_LOCALE_STATE","isLoading","t","LOCALE_FETCH_ERROR_STATE","IntlContext","useIntl","IntlProvider","pendingFetch","fetchLocale","prev","url","abort","async","AbortController","response","fetch","credentials","fetchCredentials","headers","fetchHeaders","method","signal","ok","status","statusText","json","manager","fromLocale","translate","ex","onError","varsOrFallbackText","fallbackText","fallback","bem","componentName","modifiers","classNames","modifier","cx","Button","class","disabled","selected","Orientation","Menu","customClass","footer","header","itemRenderer","items","orientation","Vertical","uniform","horizontal","Horizontal","vertical","RouterContext","useRouter","AppRouter","initialPath","routes","route","find","path","params","navigate","content","visible","onClick","LocalStorageBackend","debounceMs","storage","debounceHandle","isInitialized","window","localStorage","get","getItem","JSON","set","immediate","cancelIdleCallback","onSet","setItem","stringify","console","requestIdleCallback","ProxyStorageBackend","backend","isProxyBackend","clone","isProxy","concat","StateStorage","_ex","patch","subState","proxySubState","Registry","entries","keys","add","entry","Level","_value","xp","Number","isFinite","getLevelByExperience","xpRequiredForNextLevel","getExperienceRequiredForLevel","xpThisLevel","level","ceil","experience","log","CrafterActivity","EquipmentSlot","Crafter","game","activity","registry","icon","recipes","scheduleCraft","recipe","quantity","kind","IDLE","recipeIndex","inventory","remove","materials","material","CRAFT_PENDING","elapsesAt","clock","now","baseDurationMs","completeCraft","CRAFT_READY","loot","deliverCraft","equipmentSlotKeys","WEAPON","HEAD","CHEST","LEGS","FEET","RING","Attribute","enumOf","enumGet","enumObj","member","ItemKinds","BONE","sellPrice","maxStack","SKULL","BROKEN_BOW","WOODEN_LOG","STONE","BERRY","COCA_LEAVES","SWORD","slot","STRENGTH","STAFF","INTELLECT","HEALTH_POTION","healValue","COCAINE","CHAIN_HOOD","PHYSICAL_DEFENSE","CHAIN_VEST","CHAIN_LEGGINGS","APPRENTICE_RING","STAMINA","sum","iterable","selector","item","first","array","clamp","min","randomFloat","random","start","randomInt","trunc","LootTable","rows","generateLoot","row","chooseRow","minQuantity","maxQuantity","itemKey","chance","probability","EMPTY_ROW","questRegistry","CombatSide","SetMode","EffectKind","Effects","SUNDER","NEGATIVE","duration","maxStackCount","tick","affected","stackCount","MULTIPLIER","IGNITE","damage","param","directEnemy","attacker","participants","side","GOOD","evil","EVIL","good","getEnemies","Attacks","NONE","execute","LUNGE","defender","getAttribute","FIREBALL","MAGIC_DEFENSE","addEffect","CombatEventKind","HeroActivity","PlayerErrorKind","CombatParticipant","simulator","entity","_effects","attributeOverrides","effects","health","isAlive","defenseAttribute","defense","adjusted","change","setHealth","report","DIRECT_DAMAGE","healthChange","currentAttacker","target","PARTICIPANT_DIED","heal","isRevive","DIRECT_HEAL","PARTICIPANT_REVIVED","revivalHealth","attribute","mode","CONST","override","OFFSET","effect","applied","effectKey","remainingDuration","EFFECT_STACKED","EFFECT_APPLIED","removeEffect","existing","EFFECT_REMOVED","tickEffects","runEffect","EFFECT_FADED","oldHealth","EPSILON","ScopedCombatSimulator","events","allParticipants","_currentAttacker","participantsInit","participant","run","goodGuysAlive","round","ROUND_START","rotation","attack","runAttack","pendingEffects","hasEffects","attackKey","combatant","NoOpStorageBackend","Health","owner","maxHealth","reset","Enemy","info","Hero","equipment","equipmentBonus","baseAttributes","levelAdvancement","scheduleQuest","questKey","quest","levelRequirement","levelDiff","durationMs","sqrt","QUEST_PENDING","completeQuest","combatEvents","create","enemyKey","xpModifier","QUEST_READY","lootTable","DEAD","deliverQuest","revive","equip","newItemKey","newItem","oldItemKey","startEquipment","healthDeficit","PlayerError","isPlayerError","Inventory","capacity","contents","remaining","toAdd","NOT_ENOUGH_INVENTORY_SPACE","MISSING_REQUIRED_ITEMS","ArrayBackend","$handlers","SetBackend","$persistent","Set","$oneshot","isThennable","dispatchInParallel","thisArg","reject","pending","onHandlerResolved","dispatchInSeries","$snapshot","$getSnapshot","$add","handler","$clear","$count","$delete","$once","$deleteWrapped","from","values","has","$deleteOneshot","clear","size","delete","BACKEND_MAP","Clock","timeSource","changed","isAsync","dispatcher","parallel","createAsyncDispatcher","_options","$backend","Signal.create","performance","newTime","oldTime","compareTimers","timestamp","Scheduler","maxTimeoutMs","handle","handleCounter","queue","on","once","wasTriggered","wrapped","subscribe","Signal.on","scheduleNextTick","dispose","Signal.off","delay","insertAndSchedule","setInterval","scheduleCallbackAt","clockTimestamps","insert","timer","isRecurring","interval","sortedArray","compare","mid","binarySearch","cancelTick","delayMs","elapsed","minLevel","TraderGame","scheduler","_crafters","_heroes","crafters","heroes","cs","_","hs","recruitHero","RECRUITMENT_LIMIT_REACHED","recruitCrafter","crafter","CRAFTER_ALREADY_RECRUITED","CRAFTERS","CRAFTING_LIST","CRAFTING_RECIPE","CRAFTING_END","HEROES","HERO_RECRUIT","HERO_EDIT","HERO_EQUIP_ITEM","HERO_DEATH","HERO_HEAL_SCREEN","QUEST_SELECT","QUEST_START","QUEST_END","FlatLayout","MainHeader","main","SubHeader","flipReducer","useForceUpdate","useScheduledUpdates","timestamps","Countdown","remainingMs","usePeriodicUpdates","unit","units","ms","formatTimeRemainder","Icon","viewBox","EntryCard","actionContent","actionDisabled","secondaryAction","title","Boolean","toIntString","ProgressBar","formatValue","hideLabel","maxValue","wrapperRef","initialValue","useRef","useLayoutEffect","activityMap","_activity","router","rest","Route.CRAFTING_LIST","remainingTimeMs","Route.CRAFTING_END","CraftersScreen","renderCrafterEntry","ButtonGroup","CraftingEndScreen","Route.CRAFTERS","CraftingListScreen","Route.CRAFTING_RECIPE","CraftingRecipeScreen","setQuantity","Infinity","decreaseDisabled","increaseDisabled","HeroDeathScreen","hero","Route.HEROES","HeroEditScreen","Route.HERO_HEAL_SCREEN","Route.HERO_EQUIP_ITEM","HeroEquipItem","available","Route.HERO_EDIT","HeroHealScreen","StickyLayout","HeroRecruitScreen","selectedKey","setSelectedKey","selectedHero","Route.HERO_DEATH","Route.QUEST_SELECT","Route.QUEST_END","HeroesScreen","Route.HERO_RECRUIT","renderHeroEntry","ItemGrid","onClickItem","itemStack","InventoryScreen","selectedIndex","setSelectedIndex","slots","selectedStack","QuestEndScreen","QuestSelectScreen","enemy","Route.QUEST_START","EntityDetail","tsEnumMap","QuestStartScreen","ShopScreen","initializeGameAndRoutes","screen","tickFiveMins","replaceNode","firstChild","getElementById"],"mappings":"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"}